<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>BattleBillions — 3illions</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#000; --ink:#eef1f5; --ink2:#c7cdd6; --ink3:#969eaa;
    --panel:#0b0d10; --card:#121418;
    --b1:rgba(255,255,255,.12); --b2:rgba(255,255,255,.16); --pill:rgba(255,255,255,.06);
    --shadow:0 10px 30px rgba(0,0,0,.55);
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  html,body{height:100%;margin:0}
  body{background:var(--bg);color:var(--ink);font-family:'Orbitron',system-ui,sans-serif;overflow:hidden}

  /* HUD */
  .hud{
    position:fixed;left:0;right:0;top:0;height:64px;z-index:50;
    display:flex;align-items:center;justify-content:space-between;
    padding:env(safe-area-inset-top) 12px 0 12px;
    background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0));
  }
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:34px;height:34px;border-radius:10px;border:1px solid var(--b1);background:linear-gradient(#1a1c21,#0d0f13)}
  .pill{border:1px solid var(--b1);background:var(--pill);color:var(--ink2);padding:7px 12px;border-radius:999px;font-size:12px;letter-spacing:.08em;text-transform:uppercase}
  .timer{position:relative;width:42px;height:42px;display:grid;place-items:center}
  .timer svg{transform:rotate(-90deg)}
  .tspan{position:absolute;font-size:11px}

  /* Grid containers */
  .grid{position:relative;height:100vh;width:100vw;overflow-y:auto;scroll-snap-type:y mandatory;scroll-snap-stop:always;padding-top:64px;touch-action:none;background:var(--bg)}
  .row{height:calc(100vh - 64px);scroll-snap-align:start;display:flex;flex-direction:column;gap:10px;padding:10px}
  .row-title{font-size:12px;color:var(--ink3);letter-spacing:.12em}
  .slides{flex:1;display:flex;gap:10px;overflow-x:auto;scroll-snap-type:x mandatory;scroll-snap-stop:always;-webkit-overflow-scrolling:touch}

  /* Battle slide — 2-up card */
  .slide{
    flex:0 0 100vw;height:100%;
    border:1px solid var(--b1);border-radius:16px;overflow:hidden;background:var(--card);
    display:grid;grid-template-columns:1fr 1fr;position:relative;box-shadow:var(--shadow)
  }
  .pane{
    position:relative;overflow:hidden;background:linear-gradient(150deg,#0f1216,#07090c);display:flex;align-items:flex-end;justify-content:flex-start
  }
  .pane::before{ /* placeholder label so you see something immediately */
    content:attr(data-bg);position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#6e7480;font-size:16px;letter-spacing:.08em
  }
  .overlay{position:absolute;inset:0;background:radial-gradient(80% 100% at 50% 50%, transparent 40%, rgba(0,0,0,.55) 100%)}
  .chip{position:absolute;top:10px;left:10px;display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--b1);background:rgba(0,0,0,.45);backdrop-filter:blur(6px);font-size:12px}
  .vote{position:absolute;bottom:10px;left:10px;padding:8px 14px;border-radius:999px;border:1px solid var(--b2);background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04));color:var(--ink);font-size:12px}
  .aud{position:absolute;bottom:10px;right:10px;font-size:12px;color:var(--ink3)}
  .vs{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-weight:700;font-size:18px;color:var(--ink2);opacity:.85;letter-spacing:.12em}

  /* optional: light grain to avoid banding on OLED */
  .grain{position:fixed;inset:0;pointer-events:none;opacity:.08;mix-blend-mode:overlay;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="220"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".85" numOctaves="2"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity=".35"/></svg>');animation:drift 24s linear infinite}
  @keyframes drift{from{transform:translate3d(0,0,0)}to{transform:translate3d(-220px,-220px,0)}}
</style>
</head>
<body>
  <div class="grain" aria-hidden="true"></div>

  <!-- HUD -->
  <header class="hud">
    <div class="brand"><div class="logo"></div><div>3illions</div></div>
    <div class="pill" id="catPill">ALL</div>
    <div class="timer" aria-live="polite">
      <svg width="42" height="42" viewBox="0 0 40 40">
        <circle cx="20" cy="20" r="18" stroke="rgba(255,255,255,.15)" stroke-width="3" fill="none"/>
        <circle id="tArc" cx="20" cy="20" r="18" stroke="#fff" stroke-opacity=".9" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="113.097" stroke-dashoffset="0"/>
      </svg>
      <span class="tspan" id="tTxt">60</span>
    </div>
  </header>

  <!-- GRID -->
  <main class="grid" id="grid"></main>

<script>
/* =========================
   DATA (replace with your API)
   ========================= */
const FEED = [
  { category:'ALL', slides:[
    {L:'USER 1', l:'@Alpha', la:239, R:'USER 2', r:'@Omega', ra:221},
    {L:'NOVA', l:'@Nova', la:198, R:'VEX', r:'@Vex', ra:204},
    {L:'RAZE', l:'@Raze', la:176, R:'MYTH', r:'@Myth', ra:182},
  ]},
  { category:'ART', slides:[
    {L:'BRUSH', l:'@BrushKing', la:97, R:'CANVAS', r:'@CanvasQueen', ra:105},
    {L:'INK', l:'@InkSoul', la:112, R:'MUSE', r:'@NeoMuse', ra:109},
  ]},
  { category:'FASHION', slides:[
    {L:'STYLE', l:'@StyleIcon', la:155, R:'THREAD', r:'@ThreadQueen', ra:144},
    {L:'RUNWAY', l:'@Runway', la:138, R:'TAILOR', r:'@Tailor', ra:141},
  ]},
  { category:'RAP BATTLE', slides:[
    {L:'FLAME', l:'@MicFlame', la:312, R:'LYRIC', r:'@LyricBeast', ra:333},
    {L:'CIPHER', l:'@Cipher', la:301, R:'8-BAR', r:'@EightBar', ra:289},
    {L:'HOOK', l:'@Hooksmith', la:295, R:'METRE', r:'@Metre', ra:284},
  ]},
];

/* =========================
   BUILD
   ========================= */
const grid = document.getElementById('grid');
const catPill = document.getElementById('catPill');

function el(t,a={},kids=[]){const n=document.createElement(t);for(const[k,v]of Object.entries(a)){if(k==='class')n.className=v;else if(k==='dataset')Object.entries(v).forEach(([dk,dv])=>n.dataset[dk]=dv);else if(k==='html')n.innerHTML=v;else n.setAttribute(k,v)}kids.forEach(c=>n.appendChild(c));return n;}

function pane(label, handle, aud){
  const p = el('div',{class:'pane','data-bg':label},[ el('div',{class:'overlay'}) ]);
  const chip = el('div',{class:'chip',html:handle});
  const vote = el('button',{class:'vote',html:'Vote'});
  const audEl = el('div',{class:'aud',html:`● ${aud}`});
  const box = el('div',{style:'position:relative;height:100%'},[p,chip,vote,audEl]);
  return box;
}
function slide(pair){
  const s = el('div',{class:'slide'});
  s.appendChild(pane(pair.L, pair.l, pair.la));
  s.appendChild(pane(pair.R, pair.r, pair.ra));
  s.appendChild(el('div',{class:'vs',html:'VS'}));
  return s;
}
function rowBlock(row){
  const r = el('section',{class:'row',dataset:{category:row.category}});
  r.appendChild(el('div',{class:'row-title',html:row.category}));
  const strip = el('div',{class:'slides'});
  row.slides.forEach(p=>strip.appendChild(slide(p)));
  r.appendChild(strip);
  return r;
}
FEED.forEach(r=>grid.appendChild(rowBlock(r)));

/* =========================
   HUD: Category + Timer
   ========================= */
const tArc = document.getElementById('tArc');
const tTxt = document.getElementById('tTxt');
const CIRC = 2*Math.PI*18; tArc.setAttribute('stroke-dasharray', CIRC.toFixed(3));
let timeLeft=60, round=1, maxRounds=3, tInt=null;
function setTimer(){ tTxt.textContent=String(timeLeft); const r=timeLeft/60; tArc.setAttribute('stroke-dashoffset',((1-r)*CIRC).toFixed(3)); }
function startTimer(){ clearInterval(tInt); setTimer(); tInt=setInterval(()=>{ if(timeLeft>0){timeLeft--;setTimer();} else {clearInterval(tInt); if(round<maxRounds){round++; tTxt.textContent='⏸'; setTimeout(()=>{timeLeft=60; startTimer();}, 6000);} else {tTxt.textContent='0';} } },1000); }
startTimer();

/* =========================
   HELPERS
   ========================= */
let rows = Array.from(document.querySelectorAll('.row'));
let wraps = rows.map(r=>r.querySelector('.slides'));

function vh(){return grid.clientHeight;}
function vw(){return grid.clientWidth;}
function activeVIndex(){return Math.round(grid.scrollTop / vh());}
function activeWrap(){return wraps[activeVIndex()] || wraps[0];}
function activeCategory(){return rows[activeVIndex()]?.dataset.category || FEED[0].category;}

function syncCategory(){ catPill.textContent = activeCategory(); }
grid.addEventListener('scroll', syncCategory, {passive:true});
wraps.forEach(w=>w.addEventListener('scroll', syncCategory, {passive:true}));
window.addEventListener('resize', syncCategory);
syncCategory();

/* =========================
   INPUT ENGINE (mobile + desktop)
   - Native scroll stays enabled.
   - Diagonal drag assists both axes.
   - Snap after momentum settles or wheel stops.
   ========================= */
const engine = { on:false, id:null, x:0, y:0, vx:0, vy:0, raf:0, friction:0.92, stop:0.12 };

function step(dx,dy){
  grid.scrollTop -= dy*0.5;        // assist vertical
  activeWrap().scrollLeft -= dx*0.5; // assist horizontal
  syncCategory();
}
function snap(){
  const w = activeWrap();
  const vTarget = Math.round(grid.scrollTop / vh()) * vh();
  const hTarget = Math.round(w.scrollLeft / vw()) * vw();
  grid.scrollTo({top:vTarget, behavior:'smooth'});
  w.scrollTo({left:hTarget, behavior:'smooth'});
}
function momentum(){
  cancelAnimationFrame(engine.raf);
  engine.raf = requestAnimationFrame(()=>{
    engine.vx *= engine.friction;
    engine.vy *= engine.friction;
    if (Math.abs(engine.vx)<engine.stop && Math.abs(engine.vy)<engine.stop){ snap(); return; }
    step(engine.vx, engine.vy);
    momentum();
  });
}

/* Wheel (desktop / Android trackpads) */
grid.addEventListener('wheel',(e)=>{
  const w = activeWrap();
  if (Math.abs(e.deltaX)>0 || e.shiftKey) { w.scrollLeft += (e.deltaX || e.deltaY); e.preventDefault(); }
  if (Math.abs(e.deltaY)>0) { grid.scrollTop += e.deltaY; e.preventDefault(); }
},{passive:false});

/* Pointer / Touch */
const usePE = 'onpointerdown' in window;
function begin(x,y,id){ engine.on=true; engine.id=id; engine.x=x; engine.y=y; engine.vx=engine.vy=0; }
function move(x,y){
  if(!engine.on) return;
  const dx=x-engine.x, dy=y-engine.y;
  step(dx,dy);
  engine.vx = engine.vx*0.8 + dx*0.2;
  engine.vy = engine.vy*0.8 + dy*0.2;
  engine.x=x; engine.y=y;
}
function end(){ if(!engine.on) return; engine.on=false; momentum(); }

if(usePE){
  grid.addEventListener('pointerdown',(e)=>{ if(e.target.closest('button,a')) return; begin(e.clientX,e.clientY,e.pointerId); },{passive:true});
  grid.addEventListener('pointermove',(e)=>{ if(!engine.on || engine.id!==e.pointerId) return; move(e.clientX,e.clientY); },{passive:true});
  const off=e=>{ if(engine.id===e.pointerId) end(); };
  grid.addEventListener('pointerup',off,{passive:true});
  grid.addEventListener('pointercancel',off,{passive:true});
}else{
  grid.addEventListener('touchstart',(e)=>{ if(e.target.closest('button,a')) return; const t=e.touches[0]; begin(t.clientX,t.clientY,0); },{passive:true});
  grid.addEventListener('touchmove',(e)=>{ const t=e.touches[0]; move(t.clientX,t.clientY); },{passive:true});
  grid.addEventListener('touchend',end,{passive:true});
  grid.addEventListener('touchcancel',end,{passive:true});
}

/* Debounced snap after native scroll (wheel/trackpad) */
let snapTO;
function debounceSnap(){ clearTimeout(snapTO); snapTO = setTimeout(snap, 160); }
grid.addEventListener('scroll', debounceSnap, {passive:true});
wraps.forEach(w=>w.addEventListener('scroll', debounceSnap, {passive:true}));

/* =========================
   VOTE (stub)
   ========================= */
document.addEventListener('click',(e)=>{
  const btn = e.target.closest('.vote'); if(!btn) return;
  const slide = btn.closest('.slide');
  const meta = slide.querySelector('.chip')?.textContent || '';
  // TODO: replace with your API call
  console.log('VOTE for', meta);
});
</script>
</body>
  </html>
