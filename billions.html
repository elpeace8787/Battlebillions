<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BattleBillions ‚Äî 3illions Feed (Mono)</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bb-bg-0:#000; --bb-bg-1:#0b0c0f; --bb-card:#111317; --bb-line:#1c1f24;
      --bb-ink:#eef1f5; --bb-ink-2:#c9d0d7; --bb-ink-3:#9aa3ad;
      --bb-pill:rgba(255,255,255,.04); --bb-pill-border:rgba(255,255,255,.12);
      --bb-white-12:rgba(255,255,255,.12); --bb-white-16:rgba(255,255,255,.16);
      --bb-shadow:0 8px 30px rgba(0,0,0,.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0; background:radial-gradient(1200px 1200px at 50% -10%,#15171c 0%,var(--bb-bg-0) 55%);
      color:var(--bb-ink); font-family:'Orbitron',system-ui,sans-serif; overflow:hidden; -webkit-tap-highlight-color:transparent;
    }

    /* grain */
    .grain{position:fixed; inset:0; pointer-events:none; opacity:.12; mix-blend-mode:overlay;
      background-image:url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" width="220" height="220">\
        <filter id="n"><feTurbulence type="fractalNoise" baseFrequency=".85" numOctaves="2"/><feColorMatrix type="saturate" values="0"/></filter>\
        <rect width="100%" height="100%" filter="url(%23n)" opacity=".35"/>\
      </svg>'); animation:drift 24s linear infinite}
    @keyframes drift{from{transform:translate3d(0,0,0)}to{transform:translate3d(-220px,-220px,0)}}

    /* HUD */
    .hud{position:fixed; inset:0 0 auto 0; height:76px; display:grid; grid-template-columns:76px 1fr 76px; align-items:center; z-index:30; pointer-events:none}
    .slot{display:flex; align-items:center; justify-content:center; gap:12px; pointer-events:auto}
    .icon-btn{width:42px; height:42px; display:grid; place-items:center; border-radius:999px; border:1px solid var(--bb-pill-border); background:var(--bb-pill); box-shadow:var(--bb-shadow); cursor:pointer; transition:transform .12s ease}
    .icon-btn:hover{transform:translateY(-1px)}
    .pill{border:1px solid var(--bb-pill-border); background:var(--bb-pill); color:var(--bb-ink-2); padding:8px 14px; border-radius:999px; font-size:13px; letter-spacing:.08em; text-transform:uppercase; box-shadow:var(--bb-shadow)}

    .round{display:flex; align-items:center; gap:10px}
    .round .label{font-size:13px; color:var(--bb-ink-2); letter-spacing:.08em; text-transform:uppercase}
    .timer{position:relative; width:46px; height:46px; display:grid; place-items:center}
    .timer svg{transform:rotate(-90deg); filter:drop-shadow(0 2px 8px rgba(0,0,0,.5))}
    .timer .tspan{position:absolute; font-size:12px; color:var(--bb-ink)}

    /* rails */
    .rail{position:fixed; top:50%; transform:translateY(-50%); display:grid; gap:12px; z-index:25}
    .rail.left{left:10px} .rail.right{right:10px}

    /* containers */
    .vertical{
      height:100vh; width:100vw; overflow-y:auto; scroll-snap-type:y mandatory; scroll-snap-stop:always;
      /* custom pan on both axes */
      touch-action:none; overscroll-behavior:contain;
    }
    .vertical::-webkit-scrollbar{width:8px}
    .vertical::-webkit-scrollbar-thumb{background:var(--bb-white-12); border-radius:8px}

    .hwrap{
      display:flex; width:100vw; height:100vh; scroll-snap-align:start; overflow-x:auto; scroll-snap-type:x mandatory; scroll-snap-stop:always;
      -webkit-overflow-scrolling:touch;
    }
    .hwrap::-webkit-scrollbar{height:8px}
    .hwrap::-webkit-scrollbar-thumb{background:var(--bb-white-12); border-radius:8px}

    .arena{flex:0 0 100%; height:100%; position:relative; display:flex; flex-direction:column}
    .content{flex:1; display:flex; height:100%}

    .pane{flex:1; position:relative; display:flex; flex-direction:column; justify-content:space-between; overflow:hidden; isolation:isolate}
    video{width:100%; height:100%; object-fit:cover; background:#000}
    .vignette{position:absolute; inset:0; background:radial-gradient(80% 100% at 50% 50%, transparent 40%, rgba(0,0,0,.55) 100%); z-index:1}

    .cinfo{position:absolute; top:68px; display:flex; align-items:center; gap:10px; background:rgba(0,0,0,.55); backdrop-filter:blur(6px); padding:8px 14px; border-radius:999px; z-index:3; border:1px solid var(--bb-white-12); box-shadow:var(--bb-shadow)}
    .pane.left .cinfo{left:14px} .pane.right .cinfo{right:14px}
    .cinfo img{width:32px; height:32px; border-radius:50%; outline:2px solid rgba(255,255,255,.18)}
    .handle{font-size:14px; color:var(--bb-ink)}

    .vote{position:absolute; bottom:130px; padding:10px 18px; border-radius:999px; background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04)); border:1px solid var(--bb-white-16); color:var(--bb-ink); cursor:pointer; font-size:14px; z-index:3; backdrop-filter:blur(6px); box-shadow:var(--bb-shadow); transition:transform .12s ease}
    .pane.left .vote{left:14px} .pane.right .vote{right:14px}
    .vote:active{transform:translateY(1px) scale(.98)}

    .aud{position:absolute; bottom:82px; left:0; right:0; text-align:center; font-size:12px; color:var(--bb-ink-3); z-index:2}
    .a-avatars{display:inline-flex; gap:6px; margin-top:6px; padding:6px 10px; border-radius:999px; background:rgba(0,0,0,.35); border:1px solid var(--bb-white-12); backdrop-filter:blur(4px)}
    .a-avatars img{width:26px; height:26px; border-radius:50%}

    .chat-hint{position:fixed; bottom:12px; left:50%; transform:translateX(-50%); color:var(--bb-ink-3); font-size:12px; z-index:6; opacity:.75}
    .ripple{position:absolute; border-radius:50%; transform:scale(0); background:rgba(255,255,255,.25); animation:ripple .6s ease-out forwards; pointer-events:none}
    @keyframes ripple{to{transform:scale(10); opacity:0}}

    @media (prefers-reduced-motion:reduce){
      .grain{display:none}
      .vertical,.hwrap{scroll-behavior:auto}
    }
    @media (max-width:768px){
      .handle{font-size:12px}
      .vote{font-size:12px; padding:8px 12px}
    }
  </style>
</head>
<body>
  <div class="grain" aria-hidden="true"></div>

  <!-- HUD -->
  <div class="hud" role="toolbar" aria-label="Top controls">
    <div class="slot">
      <button class="icon-btn" id="btnSearch" title="Search" aria-label="Search">üîç</button>
      <span class="pill" id="categoryPill">ALL</span>
    </div>
    <div class="slot" style="justify-content:center; gap:16px">
      <div class="round">
        <span class="label" id="roundLabel">Round 1</span>
        <div class="timer" aria-live="polite">
          <svg width="46" height="46" viewBox="0 0 40 40">
            <circle cx="20" cy="20" r="18" stroke="rgba(255,255,255,.15)" stroke-width="3" fill="none"/>
            <circle id="timerArc" cx="20" cy="20" r="18" stroke="#fff" stroke-opacity=".9" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="113.097" stroke-dashoffset="0"/>
          </svg>
          <span class="tspan" id="timerText">60</span>
        </div>
      </div>
    </div>
    <div class="slot" style="justify-content:flex-end">
      <button class="icon-btn" id="btnSettings" title="Settings" aria-label="Settings">‚öôÔ∏è</button>
    </div>
  </div>

  <!-- Rails -->
  <div class="rail left" aria-label="Left navigation">
    <button class="icon-btn" title="Profile" aria-label="Profile">üë§</button>
    <button class="icon-btn" title="Watch" aria-label="Watch">üì∫</button>
    <button class="icon-btn" title="Rankings" aria-label="Rankings">üèÜ</button>
  </div>
  <div class="rail right" aria-label="Right navigation">
    <button class="icon-btn" title="Home" aria-label="Home">üè†</button>
    <button class="icon-btn" title="Messages" aria-label="Messages">üí¨</button>
    <button class="icon-btn" title="Settings" aria-label="Settings">‚öôÔ∏è</button>
  </div>

  <!-- FEED -->
  <div class="vertical" id="vCont" aria-label="Categories"></div>
  <div class="chat-hint" aria-hidden="true">üí¨ Chat coming soon‚Ä¶</div>

  <script>
    // ---------- Data ----------
    const FEED = [
      { category:'ALL', slides:[
        { left:{vid:'user1.mp4', img:'user1.jpg', handle:'@Alpha', aud:239}, right:{vid:'user2.mp4', img:'user2.jpg', handle:'@Omega', aud:221} },
        { left:{vid:'all2-left.mp4', img:'all2-left.jpg', handle:'@Nova', aud:198}, right:{vid:'all2-right.mp4', img:'all2-right.jpg', handle:'@Vex', aud:204} },
        { left:{vid:'all3-left.mp4', img:'all3-left.jpg', handle:'@Raze', aud:176}, right:{vid:'all3-right.mp4', img:'all3-right.jpg', handle:'@Myth', aud:182} },
        { left:{vid:'all4-left.mp4', img:'all4-left.jpg', handle:'@Vanta', aud:190}, right:{vid:'all4-right.mp4', img:'all4-right.jpg', handle:'@Kyro', aud:188} },
      ]},
      { category:'ART', slides:[
        { left:{vid:'art1.mp4', img:'art1.jpg', handle:'@BrushKing', aud:97}, right:{vid:'art2.mp4', img:'art2.jpg', handle:'@CanvasQueen', aud:105} },
        { left:{vid:'art3.mp4', img:'art3.jpg', handle:'@InkSoul', aud:112}, right:{vid:'art4.mp4', img:'art4.jpg', handle:'@NeoMuse', aud:109} },
        { left:{vid:'art5.mp4', img:'art5.jpg', handle:'@Stencil', aud:101}, right:{vid:'art6.mp4', img:'art6.jpg', handle:'@Charcoal', aud:99} },
      ]},
      { category:'FASHION', slides:[
        { left:{vid:'fashion1.mp4', img:'fashion1.jpg', handle:'@StyleIcon', aud:155}, right:{vid:'fashion2.mp4', img:'fashion2.jpg', handle:'@ThreadQueen', aud:144} },
        { left:{vid:'fashion3.mp4', img:'fashion3.jpg', handle:'@Runway', aud:138}, right:{vid:'fashion4.mp4', img:'fashion4.jpg', handle:'@Tailor', aud:141} },
      ]},
      { category:'RAP BATTLE', slides:[
        { left:{vid:'rap1.mp4', img:'rap1.jpg', handle:'@MicFlame', aud:312}, right:{vid:'rap2.mp4', img:'rap2.jpg', handle:'@LyricBeast', aud:333} },
        { left:{vid:'rap3.mp4', img:'rap3.jpg', handle:'@Cipher', aud:301}, right:{vid:'rap4.mp4', img:'rap4.jpg', handle:'@EightBar', aud:289} },
        { left:{vid:'rap5.mp4', img:'rap5.jpg', handle:'@Hooksmith', aud:295}, right:{vid:'rap6.mp4', img:'rap6.jpg', handle:'@Metre', aud:284} },
      ]},
      { category:'DANCE', slides:[
        { left:{vid:'dance1.mp4', img:'dance1.jpg', handle:'@Iso', aud:210}, right:{vid:'dance2.mp4', img:'dance2.jpg', handle:'@Poplock', aud:219} },
        { left:{vid:'dance3.mp4', img:'dance3.jpg', handle:'@Glide', aud:225}, right:{vid:'dance4.mp4', img:'dance4.jpg', handle:'@Waves', aud:231} },
        { left:{vid:'dance5.mp4', img:'dance5.jpg', handle:'@Orbit', aud:206}, right:{vid:'dance6.mp4', img:'dance6.jpg', handle:'@Strobe', aud:214} },
      ]},
    ];

    // ---------- DOM builders ----------
    const vCont = document.getElementById('vCont');

    function el(tag, attrs={}, children=[]){
      const n = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs)){
        if (k==='class') n.className = v;
        else if (k==='dataset') Object.entries(v).forEach(([dk,dv]) => n.dataset[dk]=dv);
        else if (k==='html') n.innerHTML = v;
        else n.setAttribute(k, v);
      }
      for (const c of children) n.appendChild(c);
      return n;
    }

    function pane(side, d){
      return el('div',{class:`pane ${side}`},[
        el('video',{autoplay:'', muted:'', loop:'', playsinline:'', src:d.vid}),
        el('div',{class:'vignette'}),
        el('div',{class:'cinfo'},[
          el('img',{src:d.img, alt:`${d.handle} avatar`}),
          el('span',{class:'handle', html:d.handle})
        ]),
        el('button',{class:'vote', html:'Vote'}),
        el('div',{class:'aud', html:`Live Audience: ‚óè ${d.aud}`},[
          el('div',{class:'a-avatars'},[
            el('img',{src:'a1.jpg', alt:''}),
            el('img',{src:'a2.jpg', alt:''}),
            el('img',{src:'a3.jpg', alt:''}),
          ])
        ])
      ]);
    }

    function arena(pair){
      return el('div',{class:'arena'},[
        el('div',{class:'content'},[
          pane('left', pair.left),
          pane('right', pair.right),
        ])
      ]);
    }

    // Build rows/slides
    FEED.forEach(row=>{
      const wrap = el('div',{class:'hwrap', dataset:{category:row.category}});
      row.slides.forEach(pair=>wrap.appendChild(arena(pair)));
      vCont.appendChild(wrap);
    });

    // ---------- HUD: Category + Timer Ring ----------
    const wraps = Array.from(document.querySelectorAll('.hwrap'));
    const categoryPill = document.getElementById('categoryPill');

    function viewportH(){ return vCont.clientHeight || window.innerHeight; }
    function viewportW(){ return vCont.clientWidth  || window.innerWidth; }

    function activeIndex(){
      return Math.round(vCont.scrollTop / viewportH());
    }

    function getActiveWrap(){
      return wraps[activeIndex()] || wraps[0];
    }

    function syncCategory(){
      const w = getActiveWrap();
      categoryPill.textContent = (w && w.dataset.category) ? w.dataset.category : FEED[0].category;
    }

    vCont.addEventListener('scroll', syncCategory, {passive:true});
    window.addEventListener('resize', syncCategory);
    syncCategory();

    // Timer ring
    const roundLabel = document.getElementById('roundLabel');
    const tArc = document.getElementById('timerArc');
    const tText = document.getElementById('timerText');
    const CIRC = 2 * Math.PI * 18; // circle length
    tArc.setAttribute('stroke-dasharray', CIRC.toFixed(3));
    let round = 1, timeLeft = 60, maxRounds = 3, ticking = null;

    function setTimerUI(){
      roundLabel.textContent = `Round ${round}`;
      tText.textContent = String(timeLeft);
      const ratio = timeLeft / 60;
      tArc.setAttribute('stroke-dashoffset', ((1 - ratio) * CIRC).toFixed(3));
    }
    function startTimer(){
      clearInterval(ticking); setTimerUI();
      ticking = setInterval(()=>{
        if(timeLeft>0){ timeLeft--; setTimerUI(); }
        else{
          clearInterval(ticking);
          if(round<maxRounds){ round++; tText.textContent='‚è∏'; setTimeout(()=>{ timeLeft=60; startTimer(); }, 6000); }
          else{ tText.textContent='0'; roundLabel.textContent='Battle Over'; }
        }
      },1000);
    }
    startTimer();

    // Rails fade while moving
    const rails = document.querySelectorAll('.rail');
    let fadeTO;
    function railsFade(){ rails.forEach(r=>r.style.opacity=.35); clearTimeout(fadeTO); fadeTO=setTimeout(()=>rails.forEach(r=>r.style.opacity=1), 800); }
    vCont.addEventListener('scroll', railsFade, {passive:true});
    wraps.forEach(w=>w.addEventListener('scroll', railsFade, {passive:true}));

    // Vote ripple
    document.addEventListener('click', e=>{
      const btn = e.target.closest('.vote');
      if(!btn) return;
      const r=document.createElement('span'); r.className='ripple';
      const rect=btn.getBoundingClientRect(), size=Math.max(rect.width,rect.height);
      r.style.width=r.style.height=size+'px';
      r.style.left=(e.clientX-rect.left-size/2)+'px';
      r.style.top=(e.clientY-rect.top-size/2)+'px';
      btn.appendChild(r); setTimeout(()=>r.remove(),650);
      // hook your vote API here
    });

    // ---------- ADVANCED OBLIQUE ENGINE (momentum + snap) ----------
    const engine = {
      dragging:false, lastX:0, lastY:0, lastT:0, vx:0, vy:0, raf:0, wrap:getActiveWrap(),
      friction:0.92,   // momentum decay per frame
      minVel:0.15,     // px/frame threshold to stop
    };

    function stepScroll(dx, dy){
      // vertical
      vCont.scrollTop -= dy;
      // horizontal (on CURRENT active row)
      const newWrap = getActiveWrap();
      if (newWrap !== engine.wrap) engine.wrap = newWrap;
      if (engine.wrap){
        engine.wrap.scrollLeft -= dx;
      }
      syncCategory();
    }

    function momentumLoop(){
      cancelAnimationFrame(engine.raf);
      engine.raf = requestAnimationFrame(()=>{
        // apply friction
        engine.vx *= engine.friction;
        engine.vy *= engine.friction;
        // stop?
        if (Math.abs(engine.vx) < engine.minVel && Math.abs(engine.vy) < engine.minVel){
          snapToNearest();
          return;
        }
        stepScroll(engine.vx, engine.vy);
        momentumLoop();
      });
    }

    function animateTo(getter, setter, target, done){
      const start = getter();
      const dist = target - start;
      const dur = 300;
      let t0;
      function easeOutCubic(x){ return 1 - Math.pow(1 - x, 3); }
      function tick(ts){
        if(!t0) t0 = ts;
        const p = Math.min(1, (ts - t0) / dur);
        setter(start + dist * easeOutCubic(p));
        if (p < 1) requestAnimationFrame(tick);
        else done && done();
      }
      requestAnimationFrame(tick);
    }

    function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }

    function snapToNearest(){
      const vh = viewportH(), vw = viewportW();
      const maxV = vCont.scrollHeight - vh;
      const vTarget = clamp(Math.round(vCont.scrollTop / vh) * vh, 0, maxV);

      const w = getActiveWrap();
      const maxH = w.scrollWidth - vw;
      const hTarget = clamp(Math.round(w.scrollLeft / vw) * vw, 0, maxH);

      // animate both axes
      animateTo(()=>vCont.scrollTop, v=>vCont.scrollTop=v, vTarget);
      animateTo(()=>w.scrollLeft, v=>w.scrollLeft=v, hTarget, syncCategory);
    }

    // Pointer handling (use vCont as the capture owner for iOS/Safari)
    vCont.addEventListener('pointerdown', (e)=>{
      // don't hijack UI controls
      if (e.target.closest('button,a')) return;

      engine.dragging = true;
      engine.lastX = e.clientX; engine.lastY = e.clientY; engine.lastT = performance.now();
      engine.vx = engine.vy = 0; // reset momentum
      engine.wrap = getActiveWrap();

      try { vCont.setPointerCapture && vCont.setPointerCapture(e.pointerId); } catch(_) {}
    });

    vCont.addEventListener('pointermove', (e)=>{
      if (!engine.dragging) return;

      const now = performance.now();
      const dt = Math.max(1, now - engine.lastT); // ms
      const dx = e.clientX - engine.lastX;
      const dy = e.clientY - engine.lastY;

      // Move content (invert to match finger drag)
      stepScroll(dx, dy);

      // velocity in px/frame (@60fps roughly => multiply by 16.7/dt)
      const k = 16.7 / dt;
      engine.vx = engine.vx*0.8 + (dx * k)*0.2;
      engine.vy = engine.vy*0.8 + (dy * k)*0.2;

      engine.lastX = e.clientX; engine.lastY = e.clientY; engine.lastT = now;
      e.preventDefault(); // required for mobile custom pan (touch-action: none)
    }, {passive:false});

    function endDrag(){
      if (!engine.dragging) return;
      engine.dragging = false;
      momentumLoop();
    }
    vCont.addEventListener('pointerup', endDrag);
    vCont.addEventListener('pointercancel', endDrag);
    vCont.addEventListener('pointerleave', endDrag);

    // Keyboard nav (desktop)
    window.addEventListener('keydown', (e)=>{
      const w = getActiveWrap();
      const vh = viewportH(), vw = viewportW();
      if (e.key === 'ArrowRight') w.scrollBy({left: vw, behavior:'smooth'});
      if (e.key === 'ArrowLeft')  w.scrollBy({left:-vw, behavior:'smooth'});
      if (e.key === 'ArrowDown')  vCont.scrollBy({top:  vh, behavior:'smooth'});
      if (e.key === 'ArrowUp')    vCont.scrollBy({top: -vh, behavior:'smooth'});
    });
  </script>
</body>
    </html>
