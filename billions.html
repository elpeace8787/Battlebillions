<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BattleBillions — Clean Start (Web Component)</title>
<style>
  /* Host page keeps a dark backdrop only; everything else is isolated in the component */
  html,body{height:100%;margin:0;background:#000;color:#eef1f5;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif}
  body{display:grid;place-items:center}
</style>
</head>
<body>

<!-- Drop this anywhere on your site; it’s self-contained -->
<bb-os></bb-os>

<script>
class BBOS extends HTMLElement{
  constructor(){
    super();
    this.attachShadow({mode:'open'});
    const r = (css)=>css.replace(/\s+/g,' ').trim(); // minify a bit
    const style = `
      :host{display:block;inline-size:100vw;block-size:100vh;background:#000;color:#eef1f5}
      .hud{
        position:fixed; inset-block-start:0; inset-inline:0; block-size:64px; z-index:10;
        display:flex; align-items:center; justify-content:space-between;
        padding:0 12px; background:linear-gradient(180deg,rgba(0,0,0,.55),rgba(0,0,0,0))
      }
      .pill{border:1px solid rgba(255,255,255,.12); padding:7px 12px; border-radius:999px; font-size:12px; color:#c7cdd6; letter-spacing:.08em; text-transform:uppercase}
      .mini{opacity:.85}

      .surface{
        position:fixed; inset:0; z-index:1;
        overflow:auto; scroll-snap-type: both mandatory; scroll-snap-stop:always;
        -webkit-overflow-scrolling:touch; touch-action:pan-x pan-y;
        display:grid; gap:0; background:#000; padding-top:64px;
        grid-template-columns:repeat(5,100vw); grid-template-rows:repeat(5,calc(100vh - 64px));
      }
      .cell{
        inline-size:100vw; block-size:calc(100vh - 64px);
        scroll-snap-align:start;
        border-inline-end:1px solid rgba(255,255,255,.12);
        border-block-end:1px solid rgba(255,255,255,.12);
        display:flex; flex-direction:column; gap:10px; padding:10px;
      }
      .title{font-size:12px; color:#9aa3ad; letter-spacing:.12em; display:flex; align-items:center; gap:10px}
      .card{flex:1; border:1px solid rgba(255,255,255,.12); border-radius:16px; background:#111317; overflow:hidden; display:grid; place-items:center}
      .card-inner{display:grid; gap:12px; justify-items:center}
      .btn{border:1px solid rgba(255,255,255,.16); border-radius:999px; padding:10px 14px; background:linear-gradient(180deg,rgba(255,255,255,.10),rgba(255,255,255,.04)); color:#eef1f5; font-size:13px}

      /* grayscale tints so each screen is distinct immediately */
      .g0{background:#0f1115}.g1{background:#111318}.g2{background:#13161b}.g3{background:#151a20}.g4{background:#171c23}.g5{background:#1a1f27}

      /* minimap */
      .map{position:fixed; inset-block-start:70px; inset-inline-end:10px; z-index:20; border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:6px 8px; background:rgba(0,0,0,.45); backdrop-filter:blur(6px); display:grid; gap:4px}
      .map-row{display:flex; gap:4px}
      .dot{inline-size:8px; block-size:8px; border-radius:2px; background:#323742}
      .dot.active{background:#e6e9ef}

      .hint{position:fixed; inset-inline-start:50%; transform:translateX(-50%); inset-block-end:10px; z-index:20; color:#9aa3ad; font-size:12px; opacity:.9}
    `;

    const html = `
      <div class="hud">
        <div class="pill mini" id="pos">0,0</div>
        <div class="pill" id="label">Feed</div>
        <div class="pill mini">BattleBillions</div>
      </div>

      <div class="map" id="map" aria-hidden="true">
        ${[-2,-1,0,1,2].map(y=>`
          <div class="map-row">
            ${[-2,-1,0,1,2].map(x=>`<div class="dot" data-x="${x}" data-y="${y}"></div>`).join('')}
          </div>
        `).join('')}
      </div>

      <div class="hint">Swipe/drag ↕ ↔ ↗ or use arrow keys</div>

      <!-- 2D SURFACE (static inside shadow—immune to outside CSS/JS) -->
      <main class="surface" id="surface" aria-label="2D Web OS">
        ${this._cellsHTML()}
      </main>
    `;

    const tpl = document.createElement('template');
    tpl.innerHTML = `<style>${r(style)}</style>${html}`;
    this.shadowRoot.appendChild(tpl.content.cloneNode(true));
  }

  connectedCallback(){
    const root = this.shadowRoot;
    const surface = root.getElementById('surface');
    const label = root.getElementById('label');
    const posPill = root.getElementById('pos');
    const dots = Array.from(root.querySelectorAll('.dot'));

    // Center on (0,0) at mount
    const centerOn = (x,y, smooth=true)=>{
      const col = x + 3; // 1..5
      const row = y + 3;
      const left = (col-1) * window.innerWidth;
      const top  = (row-1) * (window.innerHeight - 64);
      surface.scrollTo({left, top, behavior: smooth ? 'smooth' : 'auto'});
    };

    const currentXY = ()=>{
      const col = Math.round(surface.scrollLeft / window.innerWidth) + 1;
      const row = Math.round(surface.scrollTop  / (window.innerHeight - 64)) + 1;
      return { x: col - 3, y: row - 3 };
    };

    const setHUD = ()=>{
      const {x,y} = currentXY();
      posPill.textContent = `${x},${y}`;
      const cell = root.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
      const title = cell ? cell.querySelector('.title')?.textContent || 'Screen' : 'Screen';
      label.textContent = title.replace(/\s*\([-0-9,]+\)\s*$/,'');
      dots.forEach(d=>d.classList.remove('active'));
      const hit = dots.find(d=> +d.dataset.x===x && +d.dataset.y===y );
      if (hit) hit.classList.add('active');
    };

    // Init
    centerOn(0,0,false); setHUD();
    surface.addEventListener('scroll', setHUD, {passive:true});
    this._resizeHandler = ()=>setHUD();
    window.addEventListener('resize', this._resizeHandler);

    // Arrow keys (desktop)
    this._keyHandler = (e)=>{
      const {x,y} = currentXY();
      if (e.key==='ArrowRight') centerOn(Math.min(2, x+1), y);
      if (e.key==='ArrowLeft')  centerOn(Math.max(-2, x-1), y);
      if (e.key==='ArrowDown')  centerOn(x, Math.min(2, y+1));
      if (e.key==='ArrowUp')    centerOn(x, Math.max(-2, y-1));
    };
    window.addEventListener('keydown', this._keyHandler);
  }

  disconnectedCallback(){
    window.removeEventListener('resize', this._resizeHandler);
    window.removeEventListener('keydown', this._keyHandler);
  }

  /* Build static cells (5x5 around 0,0) */
  _cellsHTML(){
    const cell = (col,row,x,y, title, tint, inner)=>`
      <section class="cell" style="grid-column:${col};grid-row:${row}" data-x="${x}" data-y="${y}">
        <div class="title">${title} (${x},${y})</div>
        <div class="card ${tint}"><div class="card-inner">${inner||''}</div></div>
      </section>`;
    // grid columns 1..5 map to x: -2..+2 ; rows 1..5 map to y: -2..+2
    const at = (col,row)=>({x: col-3, y: row-3});
    const t = (name)=>name; // simple label helper

    let out = '';
    for (let r=1;r<=5;r++){
      for (let c=1;c<=5;c++){
        const {x,y} = at(c,r);
        // Choose screen titles around center
        let title = 'Screen', tint='g2', inner='';
        if (x===0 && y===0){ title=t('Feed'); tint='g4'; inner='<div>Swipe → Profile, ← Explore, ↓ Messages, ↑ Wallet</div><button class="btn">Open Battle</button>'; }
        else if (x=== 1 && y=== 0){ title=t('Profile'); tint='g3'; inner='<div>@you</div><button class="btn">Edit</button>'; }
        else if (x===-1 && y=== 0){ title=t('Explore'); tint='g3'; inner='<div>Discover battles</div><button class="btn">Search</button>'; }
        else if (x=== 0 && y=== 1){ title=t('Messages'); tint='g5'; inner='<div>DMs</div><button class="btn">New message</button>'; }
        else if (x=== 0 && y===-1){ title=t('Wallet'); tint='g3'; inner='<div>Balance: 0</div><button class="btn">Deposit</button>'; }
        else if (x=== 1 && y=== 1){ title=t('Settings'); tint='g0'; inner='<div>App settings</div>'; }
        else if (x===-1 && y=== 1){ title=t('Live'); tint='g4'; inner='<div>Live rooms</div>'; }
        else if (x=== 1 && y===-1){ title=t('Notifications'); tint='g1'; inner='<div>No alerts</div>'; }
        else if (x===-1 && y===-1){ title=t('Leaderboard'); tint='g2'; inner='<div>Top players</div>'; }
        else if (x=== 2 && y=== 0){ title=t('Settings'); tint='g2'; inner='<div>Preferences</div>'; }
        else if (x===-2 && y=== 0){ title=t('Clubs'); tint='g2'; inner='<div>Create/Join clubs</div>'; }
        else if (x=== 0 && y=== 2){ title=t('Requests'); tint='g0'; inner='<div>Requests</div>'; }
        else if (x=== 0 && y===-2){ title=t('Tournaments'); tint='g2'; inner='<div>Seasons</div>'; }
        else { title=t('More'); tint=['g0','g1','g2','g3','g4','g5'][(c+r)%6]; inner='<div>—</div>'; }
        out += cell(c,r,x,y,title,tint,inner);
      }
    }
    return out;
  }
}

customElements.define('bb-os', BBOS);
</script>

</body>
</html>
