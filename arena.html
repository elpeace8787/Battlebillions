<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no"/>
  <title>BattleBillions ‚Äî Live Battle</title>
  <style>
    :root{
      --bg:#000;
      --ink:#f4f6f8;
      --ink-d:#c7cbd1;
      --accent:#fff;           /* neutral; your system can skin later */
      --outline:rgba(255,255,255,.12);
      --glass:rgba(15,15,20,.55);
      --glass-2:rgba(15,15,20,.75);
      --good:#18cf6a;
      --bad:#ef3b3b;
      --btn:rgba(255,255,255,.08);
      --btn-h:rgba(255,255,255,.16);
      --pad:#0c0c12;
    }

    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    body { overflow:hidden; }

    /* ====== LAYOUT ====== */
    .wrap {
      position: fixed; inset:0; display:grid; gap:8px;
      grid-template-columns: 1fr 1fr;
      padding: 8px;
      background:
        radial-gradient(1200px 1200px at 10% -20%, rgba(80,80,120,.12), transparent 60%),
        radial-gradient(1200px 1200px at 110% 120%, rgba(80,120,120,.10), transparent 60%);
    }

    .panel{
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      background: #000;
      outline: 1px solid var(--outline);
      isolation:isolate;
    }

    video{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit: cover; background:#000;
      z-index:0;
    }

    /* ====== OVERLAYS ====== */
    .hud{
      position:absolute; inset:0; z-index:2; pointer-events:none;
      display:flex; flex-direction:column; justify-content:space-between;
      padding: 12px;
    }

    .top-row{
      display:flex; align-items:center; gap:10px;
    }
    .badge{
      pointer-events:auto;
      backdrop-filter: blur(8px);
      background: var(--glass);
      border: 1px solid var(--outline);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px; color: var(--ink);
      display:flex; align-items:center; gap:8px;
    }

    .nameplate{
      margin-left:auto;
      pointer-events:auto;
      padding:8px 12px; border-radius:10px;
      background: var(--glass);
      border:1px solid var(--outline);
      font-size:13px; color:var(--ink);
    }

    /* ====== NEXT OPPONENT PAD (CENTERED IN OPPONENT SCREEN) ====== */
    .opponent-center{
      position:absolute; inset:0; z-index:3;
      display:grid; place-items:center; pointer-events:none;
      padding: 12px;
    }

    .next-card{
      width:min(82%, 520px);
      pointer-events:auto;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.32));
      border:1px solid var(--outline);
      border-radius:16px;
      box-shadow: 0 8px 40px rgba(0,0,0,.6);
      display:flex; flex-direction:column; align-items:center; gap:14px;
      padding:18px 16px;
      transform: translateZ(0);
    }

    .avatar{
      width:96px; height:96px; border-radius:18px; overflow:hidden; outline:1px solid var(--outline);
      box-shadow: 0 6px 30px rgba(0,0,0,.45);
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }

    .handle{ font-weight:700; font-size:18px; letter-spacing:.2px; }
    .meta{ font-size:12px; color:var(--ink-d); }

    .actions{
      width:100%; display:flex; gap:10px; justify-content:center; margin-top:2px;
    }
    .btn{
      flex:1 1 0;
      appearance:none; border:1px solid var(--outline); background:var(--btn);
      color:var(--ink); padding:12px 14px; border-radius:12px; font-weight:700; font-size:14px;
      letter-spacing:.3px; cursor:pointer; transition:.2s transform ease, .2s background ease, .2s border-color ease;
    }
    .btn:hover{ background:var(--btn-h); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn.good{ border-color: rgba(24,207,106,.4); box-shadow: inset 0 0 0 1px rgba(24,207,106,.25); }
    .btn.bad{ border-color: rgba(239,59,59,.4); box-shadow: inset 0 0 0 1px rgba(239,59,59,.25); }

    /* ====== TURN STATES: DIM & MUTE FEEDBACK ====== */
    .dimmed::after{
      content:"";
      position:absolute; inset:0; z-index:1;
      background: linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.48));
      backdrop-filter: blur(0.5px);
      pointer-events:none;
    }
    .turn-chip{
      position:absolute; right:12px; bottom:12px; z-index:3;
      padding:8px 10px; font-size:12px; border-radius:10px;
      background:var(--glass-2); border:1px solid var(--outline);
      display:flex; align-items:center; gap:8px;
      pointer-events:none; /* informational */
    }

    /* ====== FOOTER CONTROL (DEV/TEST) ====== */
    .footer-controls{
      position:fixed; left:50%; bottom:10px; transform:translateX(-50%);
      z-index:40; display:flex; gap:10px;
      background: var(--glass-2); border:1px solid var(--outline);
      padding:8px; border-radius:12px;
      backdrop-filter: blur(8px);
    }
    .footer-controls button{
      pointer-events:auto;
      padding:8px 10px; border-radius:10px; background:var(--btn); color:var(--ink);
      border:1px solid var(--outline); font-weight:600; letter-spacing:.2px; cursor:pointer;
    }
    .footer-controls button:hover{ background:var(--btn-h); }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; height:100dvh; overflow:hidden; }
      .panel{ height: 50dvh; }
      .footer-controls{ bottom:8px; }
    }
    @media (min-width: 981px){
      .panel{ height: calc(100dvh - 16px); }
    }
  </style>
</head>
<body>

  <main class="wrap">
    <!-- YOUR SCREEN (LEFT) -->
    <section class="panel" id="panel-you">
      <video id="video-you" autoplay muted playsinline></video>

      <div class="hud">
        <div class="top-row">
          <div class="badge" id="you-audio-badge">üé§ Your Mic</div>
          <div class="badge">‚è±Ô∏è 01:23</div>
          <div class="nameplate">You ‚Ä¢ @YourHandle</div>
        </div>
        <div></div>
      </div>

      <div class="turn-chip" id="you-turn-chip">Your turn</div>
    </section>

    <!-- OPPONENT SCREEN (RIGHT) -->
    <section class="panel" id="panel-opponent">
      <video id="video-opponent" autoplay playsinline></video>

      <!-- Centered Next Opponent Pad + Buttons Underneath -->
      <div class="opponent-center">
        <div class="next-card" id="next-card">
          <div class="avatar">
            <img id="next-avatar" alt="Next opponent" src="https://images.unsplash.com/photo-1568605114967-8130f3a36994?q=80&w=600&auto=format&fit=crop"/>
          </div>
          <div class="handle" id="next-handle">@NextOpponent</div>
          <div class="meta" id="next-meta">Rank #27 ‚Ä¢ Atlanta, GA ‚Ä¢ 18.2k followers</div>

          <!-- Buttons live UNDER the display (not on top) -->
          <div class="actions">
            <button class="btn bad" id="btn-next">NEXT</button>
            <button class="btn good" id="btn-accept">ACCEPT</button>
          </div>
        </div>
      </div>

      <div class="hud">
        <div class="top-row">
          <div class="badge">üëÅÔ∏è 12,403</div>
          <div class="badge">LIVE</div>
          <div class="nameplate">@Opponent ‚Ä¢ Nation: JP</div>
        </div>
        <div></div>
      </div>

      <div class="turn-chip" id="opp-turn-chip">Opponent‚Äôs turn</div>
    </section>
  </main>

  <!-- Dev/Test Controls (remove in prod) -->
  <div class="footer-controls" aria-hidden="true">
    <button id="toggle-turn">Toggle Turn</button>
    <button id="shuffle-next">Shuffle Next Opponent</button>
  </div>

  <script>
    // ====== MEDIA BOOTSTRAP (placeholder streams) ======
    // For demo: use a muted looped video or generated stream. Replace with real streams in app.
    // Here we create a quiet MediaStream so the <video> elements stay "playing".
    async function createSilentStream() {
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator(); // inaudible when gain is 0
        const gain = ctx.createGain(); gain.gain.value = 0;
        osc.connect(gain).connect(ctx.destination); osc.start();
        const dest = ctx.createMediaStreamDestination();
        gain.disconnect();
        osc.connect(dest);
        // Create an empty canvas for "video"
        const canvas = document.createElement('canvas'); canvas.width = 16; canvas.height = 9;
        const stream = canvas.captureStream(15);
        // Merge audio (silent) and canvas video
        dest.stream.getAudioTracks().forEach(t => stream.addTrack(t));
        return stream;
      } catch (e) {
        return new MediaStream(); // fallback
      }
    }

    const youVideo = document.getElementById('video-you');
    const oppVideo = document.getElementById('video-opponent');

    (async () => {
      const s1 = await createSilentStream();
      const s2 = await createSilentStream();
      youVideo.srcObject = s1;
      oppVideo.srcObject = s2;
      youVideo.play().catch(()=>{});
      oppVideo.play().catch(()=>{});
    })();

    // ====== TURN STATE (dims + mutes your panel when it's opponent's turn) ======
    const youPanel = document.getElementById('panel-you');
    const oppPanel = document.getElementById('panel-opponent');
    const youTurnChip = document.getElementById('you-turn-chip');
    const oppTurnChip = document.getElementById('opp-turn-chip');
    const youAudioBadge = document.getElementById('you-audio-badge');

    let opponentTurn = false; // false = your turn; true = their turn

    function applyTurnState() {
      if (opponentTurn) {
        // Their turn: your side dims & mutes, opponent side is normal
        youPanel.classList.add('dimmed');
        oppPanel.classList.remove('dimmed');

        youVideo.muted = true;          // your screen's audio muted
        oppVideo.muted = false;         // you can hear opponent

        youTurnChip.textContent = "Waiting ‚Ä¢ Opponent‚Äôs turn";
        oppTurnChip.textContent = "Opponent‚Äôs turn";
        youAudioBadge.textContent = "üîá Your Mic (muted)";
      } else {
        // Your turn: restore you, dim/mute opponent
        youPanel.classList.remove('dimmed');
        oppPanel.classList.add('dimmed');

        youVideo.muted = false;         // your side active (if you attach real mic)
        oppVideo.muted = true;          // opponent muted during your turn (optional)

        youTurnChip.textContent = "Your turn";
        oppTurnChip.textContent = "Waiting ‚Ä¢ Your turn";
        youAudioBadge.textContent = "üé§ Your Mic";
      }
    }
    applyTurnState();

    document.getElementById('toggle-turn').addEventListener('click', () => {
      opponentTurn = !opponentTurn;
      applyTurnState();
    });

    // ====== NEXT OPPONENT PAD LOGIC ======
    const nextCard = document.getElementById('next-card');
    const btnNext = document.getElementById('btn-next');
    const btnAccept = document.getElementById('btn-accept');
    const nextAvatar = document.getElementById('next-avatar');
    const nextHandle = document.getElementById('next-handle');
    const nextMeta = document.getElementById('next-meta');

    const sampleOpponents = [
      { handle:'@LunaFire', meta:'Rank #12 ‚Ä¢ Tokyo, JP ‚Ä¢ 44.1k followers', img:'https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=600&auto=format&fit=crop' },
      { handle:'@KingZulu', meta:'Rank #3 ‚Ä¢ Lagos, NG ‚Ä¢ 201k followers', img:'https://images.unsplash.com/photo-1519345182560-3f2917c472ef?q=80&w=600&auto=format&fit=crop' },
      { handle:'@NordicWave', meta:'Rank #19 ‚Ä¢ Oslo, NO ‚Ä¢ 28.4k followers', img:'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=600&auto=format&fit=crop' },
      { handle:'@RioNova', meta:'Rank #7 ‚Ä¢ Rio, BR ‚Ä¢ 132k followers', img:'https://images.unsplash.com/photo-1547106634-56dcd53ae883?q=80&w=600&auto=format&fit=crop' }
    ];
    function shuffleNext(){
      const pick = sampleOpponents[Math.floor(Math.random()*sampleOpponents.length)];
      nextAvatar.src = pick.img;
      nextHandle.textContent = pick.handle;
      nextMeta.textContent = pick.meta;
    }
    shuffleNext();
    document.getElementById('shuffle-next').addEventListener('click', shuffleNext);

    // NEXT: reject and fetch another
    btnNext.addEventListener('click', () => {
      // subtle feedback
      nextCard.animate([{transform:'scale(1)'},{transform:'scale(.98)'},{transform:'scale(1)'}], {duration:160, easing:'ease'});
      shuffleNext();
    });

    // ACCEPT: lock & hide pad
    btnAccept.addEventListener('click', () => {
      nextCard.animate([{opacity:1, transform:'translateY(0)'},{opacity:0, transform:'translateY(12px)'}], {duration:220, easing:'ease-out'});
      setTimeout(()=>{ nextCard.style.display='none'; }, 220);
      // When accepted, force opponent turn first (optional ‚Äì adjust to your rules)
      opponentTurn = true;
      applyTurnState();
    });

    // Expose small API hooks you can call from your app:
    window.BattleUI = {
      setOpponentTurn(isOppTurn){ opponentTurn = !!isOppTurn; applyTurnState(); },
      showNextPad(){ nextCard.style.display='flex'; nextCard.style.opacity='1'; },
      hideNextPad(){ nextCard.style.display='none'; },
      setNextOpponent({handle, meta, img}) {
        if(handle) nextHandle.textContent = handle;
        if(meta) nextMeta.textContent = meta;
        if(img) nextAvatar.src = img;
      }
    };
  </script>
</body>
            </html>
