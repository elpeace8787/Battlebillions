<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BattleBillions ‚Äì Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;font-family:'Orbitron',sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#fff;overflow:hidden}

    :root{
      --cyan:#0ff;
      --glass:rgba(0,255,255,0.12);
      --glass-strong:rgba(0,255,255,0.18);
      --dim-overlay:rgba(0,0,0,0.55);
      --light-overlay:rgba(0,255,200,0.10);
    }

    /* Shared chrome */
    .top-bar,.bottom-bar{
      position:fixed;left:0;width:100%;display:flex;justify-content:space-between;align-items:center;
      padding:6px 12px;background:rgba(0,255,255,0.08);backdrop-filter:blur(10px);z-index:50
    }
    .top-bar{top:0;border-bottom:1px solid rgba(0,255,255,0.25);height:40px}
    .bottom-bar{bottom:0;border-top:1px solid rgba(0,255,255,0.2)}
    .nav-icon{font-size:14px;color:var(--cyan);cursor:pointer;text-shadow:0 0 5px var(--cyan);padding:6px 10px;border-radius:10px;transition:.25s}
    .nav-icon:hover{background:rgba(0,255,255,0.12);transform:translateY(-1px)}

    .side-controls{position:fixed;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:14px;z-index:40}
    .side-controls.left{left:10px}
    .side-controls.right{right:10px}
    .side-button{width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;
      background:rgba(0,255,255,0.10);border:1px solid rgba(0,255,255,0.25);color:var(--cyan);cursor:pointer;transition:.25s}
    .side-button:hover{transform:scale(1.08)}

    /* Views (SPA) */
    .view{position:absolute;inset:40px 0 48px 0; /* under top/bottom bars */ padding:16px;overflow:auto;display:none}
    .view.active{display:block}

    /* Dashboard / category picker */
    .slogan{
      max-width:980px;margin:12px auto 18px auto;display:flex;gap:8px;flex-wrap:wrap;justify-content:center
    }
    .slogan .chip{
      background:var(--glass-strong);border:1px solid rgba(0,255,255,0.28);padding:8px 12px;border-radius:12px;
      font-size:12px;letter-spacing:.5px;color:var(--cyan)
    }

    .panel{
      max-width:1100px;margin:0 auto;background:rgba(0,0,0,0.35);border:1px solid rgba(0,255,255,0.2);
      border-radius:16px;padding:16px 14px;box-shadow:0 0 18px rgba(0,255,255,0.15)
    }
    .panel h2{font-size:18px;color:#e8feff;margin-bottom:10px;letter-spacing:.6px}
    .grid{
      display:grid;gap:10px;
      grid-template-columns:repeat(2,minmax(0,1fr)); /* mobile-safe */
    }
    @media(min-width:720px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    @media(min-width:1040px){.grid{grid-template-columns:repeat(6,minmax(0,1fr))}}

    .pill{
      position:relative;display:flex;align-items:center;justify-content:center;text-align:center;
      min-height:56px;padding:10px 8px;border-radius:14px;border:1px solid rgba(0,255,255,0.28);
      background:rgba(0,255,255,0.06);color:#dff;cursor:pointer;transition:.22s;
      line-height:1.1;
    }
    .pill span{
      display:block;max-width:100%;word-break:break-word;
      font-size:14px;
    }
    @media(min-width:520px){.pill span{font-size:15px}}
    .pill:hover{background:rgba(0,255,255,0.16);transform:translateY(-1px)}
    .pill.active{outline:2px solid var(--cyan);box-shadow:0 0 12px rgba(0,255,255,0.45)}

    .subgrid{display:grid;gap:10px;grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(min-width:760px){.subgrid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .sub-note{margin:10px 0 4px 2px;color:#aef;font-size:12px;opacity:.9}

    .cta-wrap{display:flex;justify-content:center;margin-top:16px}
    .cta{
      display:none; /* shown after subcategory pick */
      padding:12px 22px;border-radius:24px;background:var(--cyan);color:#000;border:none;font-weight:700;
      letter-spacing:.5px;cursor:pointer;box-shadow:0 0 16px rgba(0,255,255,0.5);transition:.2s
    }
    .cta.show{display:inline-block}
    .cta:hover{transform:translateY(-1px)}

    /* Arena view */
    .stream-container{position:relative;width:100%;height:100%;display:flex}
    video.video-stream{flex:1;object-fit:cover;width:50%;height:100%;background:#000;filter:brightness(.9) contrast(1.2) saturate(1.3)}
    .arena-overlay{position:absolute;inset:0;pointer-events:none}
    .arena-top{position:absolute;top:0;left:0;right:0;height:38px;padding:6px 12px;display:flex;justify-content:space-between;align-items:center;
      background:rgba(0,255,255,0.08);border-bottom:1px solid rgba(0,255,255,0.2)}
    .arena-chip{background:rgba(0,255,255,0.12);border:1px solid rgba(0,255,255,0.28);padding:6px 10px;border-radius:10px;color:var(--cyan);font-size:12px}

    .names{position:absolute;top:70px;left:0;right:0;display:flex;justify-content:space-between;padding:0 12px;gap:12px}
    .name-pill{pointer-events:auto;background:rgba(0,0,0,0.55);padding:6px 10px;border-radius:14px;border:1px solid rgba(0,255,255,0.28);color:#e8feff;font-size:13px}

    .vote-btn{position:absolute;bottom:130px;padding:9px 16px;border-radius:30px;background:rgba(0,255,255,0.2);border:none;
      color:#fff;font-size:15px;pointer-events:auto}
    .vote-left{left:12px}
    .vote-right{right:12px}

    /* Live audience + chat button inline */
    .audience-bar{position:absolute;bottom:78px;left:50%;transform:translateX(-50%);min-width:260px;max-width:min(92%,560px);
      display:flex;align-items:center;justify-content:center;gap:10px;padding:8px 12px;border-radius:14px;
      background:rgba(0,0,0,0.45);border:1px solid rgba(0,255,255,0.28)}
    .aud-text{font-size:12px;color:var(--cyan)}
    .aud-avatars{display:flex;gap:6px}
    .aud-avatars img{width:20px;height:20px;border-radius:50%}
    .chat-mini{pointer-events:auto;border:none;border-radius:999px;background:var(--cyan);color:#000;font-weight:700;padding:6px 10px;cursor:pointer}

    /* Timer + round center pill */
    .round-timer{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);padding:10px 18px;border-radius:28px;
      background:rgba(0,255,255,0.12);border:2px solid var(--cyan);color:#fff;font-weight:700;box-shadow:0 0 15px rgba(0,255,255,0.5)}
    .round-timer.animate{background:rgba(0,255,200,0.22);box-shadow:0 0 20px rgba(0,255,200,0.75)}

    /* Cinematic lighting */
    .cinema-dim::after{
      content:"";position:absolute;inset:0;background:var(--dim-overlay);pointer-events:none;z-index:2
    }
    .cinema-light::after{
      content:"";position:absolute;inset:0;background:var(--light-overlay);pointer-events:none;z-index:2
    }

    /* Post-battle modal (category box + next opponent) */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1000
    }
    .modal.show{display:flex}
    .modal-card{
      width:min(960px,92%);max-height:80vh;overflow:auto;background:rgba(0,0,0,0.7);
      border:1px solid rgba(0,255,255,0.3);border-radius:16px;padding:16px;box-shadow:0 0 20px rgba(0,255,255,0.5)
    }
    .modal-title{font-size:18px;margin-bottom:8px;color:#e8feff}
    .modal-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btn{
      padding:10px 16px;border-radius:12px;border:1px solid rgba(0,255,255,0.3);background:rgba(0,255,255,0.1);
      color:#e8feff;cursor:pointer
    }
    .btn.primary{background:var(--cyan);color:#000;border:none;font-weight:700}
    .btn:hover{filter:brightness(1.08)}

    .hidden{display:none!important}
  </style>
</head>
<body>
  <!-- Global Bars -->
  <div class="top-bar">
    <div class="nav-icon" data-nav="home">üè† Home</div>
    <div class="nav-icon" data-nav="dashboard">üéõÔ∏è Dashboard</div>
    <div class="nav-icon" data-nav="battle">üì∫ Battle</div>
    <div class="nav-icon" data-nav="leaderboard">üèÜ Leaderboard</div>
    <div class="nav-icon" data-nav="profile">üë§ Profile</div>
  </div>

  <div class="side-controls left">
    <div class="side-button" data-nav="profile">üë§</div>
    <div class="side-button" data-nav="dashboard">üîç</div>
    <div class="side-button" data-nav="home">üè†</div>
  </div>
  <div class="side-controls right">
    <div class="side-button" data-nav="leaderboard">üèÜ</div>
    <div class="side-button" data-nav="battle">üì∫</div>
    <div class="side-button" data-nav="dashboard">üéõÔ∏è</div>
  </div>

  <div class="bottom-bar">
    <div class="nav-icon" data-nav="profile">üë§</div>
    <div class="nav-icon" data-nav="dashboard">üîç</div>
    <div class="nav-icon" data-nav="leaderboard">üèÜ</div>
    <div class="nav-icon" data-nav="home">üè†</div>
    <div class="nav-icon" data-nav="battle">üì∫</div>
  </div>

  <!-- VIEWS -->
  <!-- HOME -->
  <section id="view-home" class="view active">
    <div class="slogan">
      <div class="chip">1ST ‚Äì Defeat BILLIONS.</div>
      <div class="chip">2ND ‚Äì Choose Your BATTLE.</div>
      <div class="chip">3RD ‚Äì Defeat BILLIONS.</div>
    </div>
    <div class="panel">
      <h2>Welcome to BattleBillions</h2>
      <p style="opacity:.9;font-size:13px;margin-bottom:10px">Tap Dashboard to choose your battle category and jump in.</p>
      <div class="cta-wrap"><button class="cta show" data-nav="dashboard">Go to Dashboard</button></div>
    </div>
  </section>

  <!-- DASHBOARD: Category -> Subcategory -->
  <section id="view-dashboard" class="view">
    <div class="slogan">
      <div class="chip">1ST ‚Äì Defeat BILLIONS.</div>
      <div class="chip">2ND ‚Äì Choose Your BATTLE.</div>
      <div class="chip">3RD ‚Äì Defeat BILLIONS.</div>
    </div>

    <div class="panel" id="cat-panel">
      <h2>Choose Category</h2>
      <div class="grid" id="categoryGrid">
        <!-- Categories injected by JS -->
      </div>
    </div>

    <div class="panel hidden" id="subcat-panel">
      <h2 id="subcatTitle">Choose Subcategory</h2>
      <div class="sub-note" id="subcatNote"></div>
      <div class="subgrid" id="subcatGrid"></div>
      <div class="cta-wrap">
        <button id="startBattleBtn" class="cta">BattleBillions</button>
      </div>
    </div>
  </section>

  <!-- BATTLE (Arena) -->
  <section id="view-battle" class="view">
    <div class="stream-container" id="arena">
      <video class="video-stream" id="localVideo" autoplay muted playsinline></video>
      <video class="video-stream" id="opponentVideo" autoplay muted loop></video>

      <div class="arena-overlay">
        <div class="arena-top">
          <div class="arena-chip" id="arenaCat">Category: ‚Äî</div>
          <div class="arena-chip" id="arenaSub">Sub: ‚Äî</div>
        </div>

        <div class="names">
          <div class="name-pill" id="youName">@You</div>
          <div class="name-pill" id="oppName">@Opponent</div>
        </div>

        <button class="vote-btn vote-left">Vote</button>
        <button class="vote-btn vote-right">Vote</button>

        <div class="audience-bar">
          <span class="aud-text" id="audCount">Live Audience: üî¥ 0</span>
          <div class="aud-avatars" id="audAvatars">
            <img src="a1.jpg" alt="">
            <img src="a2.jpg" alt="">
            <img src="a3.jpg" alt="">
          </div>
          <button class="chat-mini" id="chatBtn">üí¨ Chat</button>
        </div>

        <div class="round-timer" id="roundTimer">Preparing battle‚Ä¶</div>
      </div>
    </div>
    <audio id="roundEndSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_38ca955dae.mp3?filename=click-124467.mp3"></audio>
    <audio id="battleTrack" hidden></audio>
  </section>

  <!-- LEADERBOARD -->
  <section id="view-leaderboard" class="view">
    <div class="panel">
      <h2>Leaderboard</h2>
      <p style="opacity:.85;font-size:13px">Top battlers will appear here.</p>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="view-profile" class="view">
    <div class="panel">
      <h2>Your Profile</h2>
      <p style="opacity:.85;font-size:13px">Customize your handle, avatar, and settings.</p>
    </div>
  </section>

  <!-- POST-BATTLE MODAL (Category box + Next Opponent) -->
  <div class="modal" id="postBattleModal">
    <div class="modal-card">
      <div id="postBattleHome">
        <div class="modal-title">Battle Finished</div>
        <div class="modal-actions">
          <button class="btn primary" id="btnNextOpponent">Next Opponent (Same Category)</button>
          <button class="btn" id="btnChangeCategory">Change Category</button>
          <button class="btn" id="btnCloseModal">Close</button>
        </div>
      </div>

      <div id="changeCategoryPanel" class="hidden">
        <div class="modal-title">Choose Category</div>
        <div class="grid" id="modalCategoryGrid"></div>

        <div class="hidden" id="changeSubPanel">
          <div class="sub-note" id="changeSubNote" style="margin-top:10px"></div>
          <div class="subgrid" id="modalSubGrid"></div>
          <div class="modal-actions">
            <button class="btn primary" id="btnStartNewBattle" disabled>Start New Battle</button>
            <button class="btn" id="btnBackToCat">Back</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ---------------- SPA Router ---------------- */
    const views = {
      home: document.getElementById('view-home'),
      dashboard: document.getElementById('view-dashboard'),
      battle: document.getElementById('view-battle'),
      leaderboard: document.getElementById('view-leaderboard'),
      profile: document.getElementById('view-profile'),
    };
    function go(view){
      Object.values(views).forEach(v=>v.classList.remove('active'));
      (views[view]||views.home).classList.add('active');
    }
    document.querySelectorAll('[data-nav]').forEach(el=>{
      el.addEventListener('click', ()=> go(el.getAttribute('data-nav')));
    });

    /* ------------- Category / Subcategory Logic ------------- */
    const CATEGORY_MAP = {
      ART:        { note:"Select an art discipline", sub:["Painting","Digital","Sculpture","Graffiti","Photography","Mixed Media"] },
      AUTO:       { note:"Select an auto discipline", sub:["Drift","Build","Detail","Audio","Off-road","Showcase"] },
      DEBAT:      { note:"Pick your debate arena", sub:["Politics","Tech","Sports","Culture","Open Debate"] },
      FASHION:    { note:"Select a fashion lane", sub:["Runway","Streetwear","Styling","Thrifting","Design Sketch"] },
      INSTRUMENTS:{ note:"Pick an instrument", sub:["Guitar","Piano","Drums","Violin","Bass","Brass"] },
      RAP:        { note:"Pick your style", sub:["Boom Bap","Trap","Freestyle","Melodic","Battle Bars"] },
    };

    const categoryGrid = document.getElementById('categoryGrid');
    const subPanel = document.getElementById('subcat-panel');
    const subTitle = document.getElementById('subcatTitle');
    const subNote = document.getElementById('subcatNote');
    const subGrid = document.getElementById('subcatGrid');
    const startBattleBtn = document.getElementById('startBattleBtn');

    let chosenCategory = null;
    let chosenSub = null;

    // Build category buttons (Dashboard)
    for(const key of Object.keys(CATEGORY_MAP)){
      const btn = document.createElement('button');
      btn.className = 'pill';
      btn.innerHTML = `<span>${key}</span>`;
      btn.addEventListener('click', ()=>{
        chosenCategory = key;
        chosenSub = null;
        [...categoryGrid.children].forEach(c=>c.classList.remove('active'));
        btn.classList.add('active');
        fillSubcats(key);
      });
      categoryGrid.appendChild(btn);
    }

    function fillSubcats(cat){
      const cfg = CATEGORY_MAP[cat];
      subTitle.textContent = `Choose ${cat} Subcategory`;
      subNote.textContent  = cfg.note;
      subGrid.innerHTML = '';
      cfg.sub.forEach(name=>{
        const s = document.createElement('button');
        s.className = 'pill';
        s.innerHTML = `<span>${name}</span>`;
        s.addEventListener('click', ()=>{
          chosenSub = name;
          [...subGrid.children].forEach(c=>c.classList.remove('active'));
          s.classList.add('active');
          startBattleBtn.classList.add('show');
        });
        subGrid.appendChild(s);
      });
      subPanel.classList.remove('hidden');
      startBattleBtn.classList.remove('show');
    }

    startBattleBtn.addEventListener('click', ()=>{
      if(!chosenCategory || !chosenSub) return;
      go('battle');
      bootArena(chosenCategory, chosenSub);
    });

    /* ------------- Arena Logic ------------- */
    const arenaEl = document.getElementById('arena');
    const arenaCat = document.getElementById('arenaCat');
    const arenaSub = document.getElementById('arenaSub');
    const localVideo = document.getElementById('localVideo');
    const opponentVideo = document.getElementById('opponentVideo');
    const oppName = document.getElementById('oppName');
    const roundTimer = document.getElementById('roundTimer');
    const roundEndSound = document.getElementById('roundEndSound');
    const battleTrack = document.getElementById('battleTrack');
    const audCountEl = document.getElementById('audCount');
    const audAvatars = document.getElementById('audAvatars');

    const OPP_POOLS = {
      ART: [{user:'@BrushKing', video:'art2.mp4'},{user:'@InkMage', video:'art3.mp4'}],
      AUTO: [{user:'@DriftLord', video:'auto1.mp4'},{user:'@DetailDuke', video:'auto2.mp4'}],
      DEBAT: [{user:'@ArgueAI', video:'debat1.mp4'},{user:'@PointGuard', video:'debat2.mp4'}],
      FASHION: [{user:'@RunwayRay', video:'fashion2.mp4'},{user:'@FitGenius', video:'fashion3.mp4'}],
      INSTRUMENTS: [{user:'@Guitarix', video:'inst1.mp4'},{user:'@KeysNova', video:'inst2.mp4'}],
      RAP: [{user:'@MicFlame', video:'rap1.mp4'},{user:'@LyricBeast', video:'rap2.mp4'}],
    };

    const INSTRUMENTALS = [
      {label:'üî• Classic Trap', src:'beat1.mp3'},
      {label:'üí• Boom Bap', src:'beat2.mp3'},
      {label:'üåä Chill Vibes', src:'beat3.mp3'},
      {label:'‚ö° Fast Flow', src:'beat4.mp3'},
    ];

    let round = 1, part = 0, timeLeft = 33, maxRounds = 3, timerHandle = null;
    let audienceCount = 0, audienceTick = null;

    async function bootArena(cat, sub){
      arenaCat.textContent = `Category: ${cat}`;
      arenaSub.textContent = `Sub: ${sub}`;

      // Pick opponent for category
      const pool = OPP_POOLS[cat] || [{user:'@Opponent', video:'user2.mp4'}];
      const rnd = pool[Math.floor(Math.random()*pool.length)];
      oppName.textContent = rnd.user;
      opponentVideo.src = rnd.video;

      // Start camera
      try{
        const stream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
        localVideo.srcObject = stream;
      }catch(e){
        // fallback to sample
        localVideo.src = 'user1.mp4';
        localVideo.muted = true;
        localVideo.loop = true;
        localVideo.play();
      }

      // RAP: auto instrumental, others: no music
      if(cat === 'RAP'){
        const track = INSTRUMENTALS[Math.floor(Math.random()*INSTRUMENTALS.length)];
        battleTrack.src = track.src;
        try{ await battleTrack.play(); }catch{}
      }else{
        battleTrack.pause();
        battleTrack.currentTime = 0;
      }

      // Audience
      seedAudience();
      if(audienceTick) clearInterval(audienceTick);
      audienceTick = setInterval(updateAudience, 1500);

      // Rounds
      resetRounds();
      startRoundLoop();
    }

    function resetRounds(){
      round = 1; part = 0; timeLeft = 33;
      if(timerHandle) clearInterval(timerHandle);
      roundTimer.textContent = 'Get Ready‚Ä¶';
      hidePostBattleModal();
    }

    function setCinematic(state){ // 'dim' | 'light'
      arenaEl.classList.remove('cinema-dim','cinema-light');
      if(state==='dim') arenaEl.classList.add('cinema-dim');
      if(state==='light') arenaEl.classList.add('cinema-light');
    }

      
