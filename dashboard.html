<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BattleBillions - Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      height: 100%;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
      color: white;
      overflow: hidden;
    }

    .screen { position: absolute; inset: 0; display: none; }
    .screen.active { display: block; }

    .stream-container {
      display: flex; height: 100vh; width: 100vw; position: relative;
      background: url('https://www.transparenttextures.com/patterns/cubes.png');
      backdrop-filter: blur(10px);
      transition: filter 300ms ease, opacity 300ms ease;
    }
    .stream-container.dimmed { filter: brightness(0.6) contrast(0.9) saturate(0.9); }

    video.video-stream {
      flex: 1; object-fit: cover; background-color: black; width: 50%; height: 100%;
      filter: brightness(0.85) contrast(1.2) saturate(1.4);
      border: 1px solid rgba(0,255,255,0.2);
    }

    .overlay { position: absolute; inset: 0; pointer-events: none; z-index: 10; }

    .top-bar, .bottom-bar {
      position: absolute; width: 100%;
      display: flex; justify-content: space-between;
      pointer-events: auto; z-index: 20;
      background: rgba(0, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    .top-bar { top: 0; height: 36px; padding: 4px 12px; border-bottom: 1px solid rgba(0,255,255,0.3); }
    .bottom-bar { bottom: 0; padding: 6px 12px; background: rgba(0, 255, 255, 0.07); border-top: 1px solid rgba(0,255,255,0.2); align-items: center; gap: 16px; }

    .nav-icon { font-size: 14px; color: #0ff; cursor: pointer; text-shadow: 0 0 5px #0ff; transition: transform 0.3s; }
    .nav-icon:hover { transform: scale(1.1); }

    .side-controls.left, .side-controls.right {
      position: absolute; bottom: 140px; display: flex; flex-direction: column; gap: 16px;
      pointer-events: auto; z-index: 30;
    }
    .side-controls.left { left: 15px; }
    .side-controls.right { right: 15px; }

    .side-button {
      width: 36px; height: 36px;
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      font-size: 18px; color: #0ff; box-shadow: 0 0 6px rgba(0, 255, 255, 0.3);
      cursor: pointer; transition: transform 0.3s;
    }
    .side-button:hover { transform: scale(1.15); }
    .floating { animation: floatUpDown 3s ease-in-out infinite; }

    .profile-labels { position: absolute; top: 40px; right: 20px; display: flex; justify-content: flex-end; z-index: 40; }
    .profile-entry {
      display: flex; align-items: center; gap: 12px;
      background: rgba(0,255,255,0.1); padding: 6px 16px; border-radius: 30px;
      border: 1px solid rgba(0,255,255,0.3); box-shadow: 0 0 10px rgba(0,255,255,0.2);
      animation: floatUpDown 4s ease-in-out infinite;
    }
    .profile-entry img { width: 34px; height: 34px; border-radius: 50%; animation: floatLeftRight 6s ease-in-out infinite; box-shadow: 0 0 4px #0ff; }
    .profile-entry span { font-size: 15px; color: #0ff; text-shadow: 0 0 6px #0ff; }

    @keyframes floatUpDown { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
    @keyframes floatLeftRight { 0%,100%{transform:translateX(0)} 50%{transform:translateX(6px)} }

    .round-timer {
      position: absolute; bottom: 120px; left: 50%; transform: translateX(-50%);
      background: rgba(0,255,255,0.1); padding: 14px 30px; border-radius: 40px;
      font-size: 18px; font-weight: bold; color: #fff; border: 2px solid #0ff;
      box-shadow: 0 0 15px rgba(0,255,255,0.6); animation: pulse 2s infinite; z-index: 50;
      pointer-events: none; text-align: center;
    }
    .round-timer.animate { background: rgba(0,255,200,0.2); box-shadow: 0 0 20px rgba(0,255,200,0.8); }
    @keyframes pulse { 0%{transform:translateX(-50%) scale(1)} 50%{transform:translateX(-50%) scale(1.05)} 100%{transform:translateX(-50%) scale(1)} }

    /* Modals */
    .modal {
      position: absolute; inset: 0; display: none; align-items: center; justify-content: center;
      z-index: 1000; background: rgba(0,0,0,0.45); backdrop-filter: blur(2px); pointer-events: auto;
    }
    .modal.show { display: flex; }

    .card {
      background: #0b0b12; border: 2px solid #0ff; border-radius: 14px;
      width: min(92vw, 680px); padding: 20px; box-shadow: 0 0 24px rgba(0,255,255,0.35);
    }
    .card h2 { margin-bottom: 10px; color: #0ff; font-size: 22px; text-align: center; }
    .slogan { margin: 8px auto 18px; padding: 10px 12px; border-radius: 10px; background: rgba(0,255,255,0.08); border: 1px solid rgba(0,255,255,0.2); font-size: 13px; line-height: 1.6; color: #c8ffff; text-align: center; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-top: 12px; }

    .pill {
      display: flex; align-items: center; justify-content: center;
      min-height: 56px; width: 100%; padding: 10px 8px; text-align: center;
      white-space: normal; word-break: break-word; line-height: 1.2; font-size: 15px; letter-spacing: 0.4px;
      background: rgba(0,255,255,0.08); border: 1px solid rgba(0,255,255,0.3);
      border-radius: 10px; color: #0ff; cursor: pointer; user-select: none;
      transition: transform .2s, background .2s, box-shadow .2s;
    }
    .pill:focus-visible { outline: none; box-shadow: 0 0 0 3px rgba(0,255,255,0.45); }
    .pill:hover { transform: translateY(-2px); background: rgba(0,255,255,0.16); box-shadow: 0 0 8px rgba(0,255,255,0.25); }
    .pill.active { background: rgba(0,255,255,0.26); box-shadow: 0 0 12px rgba(0,255,255,0.35) inset; }

    .actions { margin-top: 16px; display: flex; justify-content: center; gap: 10px; }
    .btn { background: #0ff; color: #001a1a; border: none; border-radius: 10px; padding: 10px 16px; cursor: pointer; font-weight: 700; }
    .btn.secondary { background: transparent; color: #0ff; border: 1px solid #0ff; }

    .modal .sub-title { text-align: center; color: #7ffafa; margin-top: 6px; font-size: 14px; }
    .muted { opacity: .8; font-size: 12px; margin-top: 10px; text-align:center; color:#9fecec; }

    #startBattleBtn {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(0,255,255,0.2); border: 2px solid #0ff; color: white; font-size: 20px;
      padding: 16px 34px; border-radius: 40px; cursor: pointer;
      z-index: 1200; pointer-events: auto; box-shadow: 0 0 20px rgba(0,255,255,0.5);
      transition: all 0.3s ease; display: none;
    }
    #startBattleBtn:hover { background: rgba(0,255,255,0.35); transform: translate(-50%, -50%) scale(1.05); }

    .placeholder { display:flex; align-items:center; justify-content:center; height:100%; width:100%; background: rgba(0,0,0,0.35); backdrop-filter: blur(6px); text-align:center; }
    .placeholder .box { border:2px solid #0ff; border-radius:16px; padding:24px 28px; background:#0b0b12; max-width: 720px; width: calc(100% - 40px); box-shadow: 0 0 24px rgba(0,255,255,0.25); }
    .placeholder h1 { color:#0ff; margin-bottom:8px; }
    .placeholder p { color:#c8ffff; }
  </style>
</head>
<body>
  <!-- SCREEN: BATTLE -->
  <div class="screen active" id="screen-battle">
    <div class="stream-container" id="streamContainer">
      <video class="video-stream" id="localVideo" autoplay muted playsinline></video>
      <video class="video-stream" id="opponentVideo" autoplay muted loop src="user2.mp4"></video>

      <!-- CATEGORY PICKER -->
      <div class="modal show" id="categoryModal" aria-modal="true" role="dialog">
        <div class="card">
          <h2>Pick a Category</h2>
          <div class="slogan">
            <div>1ST - <b>Defeat BILLIONS.</b></div>
            <div>2ND - <b>Choose Your BATTLE.</b></div>
            <div>3RD - <b>Defeat BILLIONS.</b></div>
          </div>

          <div class="grid" id="categoryGrid">
            <button type="button" class="pill" tabindex="0" data-cat="ART" aria-controls="optionsModal" aria-expanded="false">ART</button>
            <button type="button" class="pill" tabindex="0" data-cat="AUTO" aria-controls="optionsModal" aria-expanded="false">AUTO</button>
            <button type="button" class="pill" tabindex="0" data-cat="DEBAT" aria-controls="optionsModal" aria-expanded="false">DEBAT</button>
            <button type="button" class="pill" tabindex="0" data-cat="FASHION" aria-controls="optionsModal" aria-expanded="false">FASHION</button>
            <button type="button" class="pill" tabindex="0" data-cat="INSTRUMENTS" aria-controls="optionsModal" aria-expanded="false">INSTRUMENTS</button>
            <button type="button" class="pill" tabindex="0" data-cat="RAP" aria-controls="optionsModal" aria-expanded="false">RAP</button>
          </div>
          <div class="actions">
            <button class="btn secondary" id="cancelCat" type="button">Cancel</button>
          </div>
        </div>
      </div>

      <!-- CATEGORY OPTIONS -->
      <div class="modal" id="optionsModal" aria-modal="true" role="dialog">
        <div class="card">
          <h2 id="optionsTitle">Category Options</h2>
          <div class="sub-title" id="optionsSubtitle">Configure this battle</div>
          <div id="optionsBody"></div>
          <div class="muted" id="optionsHint"></div>
          <div class="actions" id="optionsActions" style="margin-top:12px;">
            <button class="btn secondary" id="backBtn" type="button">Back</button>
          </div>
        </div>
      </div>

      <!-- Center button shown after option chosen -->
      <button id="startBattleBtn" onclick="startBattle()">‚öîÔ∏è BattleBillions</button>

      <div class="overlay">
        <div class="top-bar">
          <div class="nav-icon">üî¥ LIVE</div>
          <div class="nav-icon">üëÅÔ∏è 1.3k</div>
        </div>

        <div class="profile-labels" id="profileLabels">
          <div class="profile-entry">
            <img src="user2.jpg" id="opponentImage" alt="User 2">
            <span id="opponentUsername">@Opponent</span>
          </div>
        </div>

        <div class="side-controls left">
          <div class="side-button floating" data-screen="profile">üë§</div>
          <div class="side-button" data-screen="dashboard">üîç</div>
          <div class="side-button" data-screen="login">üö™</div>
        </div>

        <div class="side-controls right">
          <div class="side-button" data-screen="home">üè†</div>
          <div class="side-button" data-screen="leaderboard">üèÜ</div>
          <div class="side-button" data-screen="battle">üì∫</div>
        </div>

        <div class="bottom-bar">
          <div class="nav-icon" data-screen="profile">üë§</div>
          <div class="nav-icon" data-screen="dashboard">üîç</div>
          <div class="nav-icon" data-screen="leaderboard">üèÜ</div>
          <div class="nav-icon" data-screen="home">üè†</div>
          <div class="nav-icon" data-screen="battle">üì∫</div>
        </div>

        <div class="round-timer" id="roundTimer">Choose a category to begin‚Ä¶</div>
      </div>
    </div>
  </div>

  <!-- Other screens -->
  <div class="screen" id="screen-home"><div class="placeholder"><div class="box"><h1>Home</h1><p>Use the nav to jump back to <b>Battle</b> ‚Äî everything loads on this page.</p></div></div></div>
  <div class="screen" id="screen-profile"><div class="placeholder"><div class="box"><h1>Your Profile</h1><p>Profile settings soon. Click üì∫ to return to Battle.</p></div></div></div>
  <div class="screen" id="screen-leaderboard"><div class="placeholder"><div class="box"><h1>Leaderboard</h1><p>Top performers will appear here. Click üì∫ to return to Battle.</p></div></div></div>
  <div class="screen" id="screen-dashboard"><div class="placeholder"><div class="box"><h1>Dashboard Explorer</h1><p>Search & discovery UI goes here. Click üì∫ to return to Battle.</p></div></div></div>
  <div class="screen" id="screen-login"><div class="placeholder"><div class="box"><h1>Login</h1><p>Auth flow placeholder. Click üì∫ to return to Battle.</p></div></div></div>

  <audio id="roundEndSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_38ca955dae.mp3?filename=click-124467.mp3"></audio>
  <audio id="battleTrack" controls hidden></audio>

  <script>
    /* ========== SPA NAV ========== */
    const screens = {
      battle: document.getElementById('screen-battle'),
      home: document.getElementById('screen-home'),
      profile: document.getElementById('screen-profile'),
      leaderboard: document.getElementById('screen-leaderboard'),
      dashboard: document.getElementById('screen-dashboard'),
      login: document.getElementById('screen-login'),
    };
    function showScreen(name) {
      Object.entries(screens).forEach(([key, el]) => {
        if (key === name) el.classList.add('active'); else el.classList.remove('active');
      });
    }
    document.querySelectorAll('[data-screen]').forEach(el => {
      el.addEventListener('click', (e) => {
        e.preventDefault();
        showScreen(el.getAttribute('data-screen'));
      });
    });

    /* ========== Battle & Category State ========== */
    let currentCategory = null;
    let chosenOptions = {};
    let chosenSub = null;

    const opponentPools = {
      ART: [{ video: "art2.mp4", image: "art2.jpg", username: "@InkMage" }, { video: "art3.mp4", image: "art3.jpg", username: "@ColorCaster" }],
      AUTO: [{ video: "auto1.mp4", image: "auto1.jpg", username: "@TorqueLord" }, { video: "auto2.mp4", image: "auto2.jpg", username: "@RimReaper" }],
      DEBAT: [{ video: "deb1.mp4", image: "deb1.jpg", username: "@LogicBlade" }, { video: "deb2.mp4", image: "deb2.jpg", username: "@VerbalVolt" }],
      FASHION: [{ video: "fashion2.mp4", image: "fashion2.jpg", username: "@RunwayRuler" }, { video: "fashion3.mp4", image: "fashion3.jpg", username: "@FitArchitect" }],
      INSTRUMENTS: [{ video: "inst1.mp4", image: "inst1.jpg", username: "@ChordSmith" }, { video: "inst2.mp4", image: "inst2.jpg", username: "@DrumOracle" }],
      RAP: [{ video: "user3.mp4", image: "user3.jpg", username: "@ChallengerX" }, { video: "user4.mp4", image: "user4.jpg", username: "@MCNeo" }]
    };

    const subLists = {
      ART: ['Painting','Digital','Graffiti','Sculpture','Illustration'],
      AUTO: ['Drift','Drag','Build Showcase','Detailing','Audio Systems'],
      DEBAT: ['Politics','Tech','Sports','Culture','Freestyle'],
      FASHION: ['Runway','Streetwear','Vintage','Upcycle','Styling'],
      INSTRUMENTS: ['Guitar','Piano','Violin','Drums','DJ'],
      RAP: [
        {label:'üî• Classic Trap', value:'beat1.mp3'},
        {label:'üí• Boom Bap', value:'beat2.mp3'},
        {label:'üåä Chill Vibes', value:'beat3.mp3'},
        {label:'‚ö° Fast Flow', value:'beat4.mp3'},
      ]
    };

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 1280 }, height: { ideal: 720 } }, audio: true });
        document.getElementById('localVideo').srcObject = stream;
      } catch (err) {
        console.error('Camera error:', err);
        alert('Please allow camera and mic access.');
      }
    }

    const streamContainer = document.getElementById('streamContainer');
    const timerDisplay = document.getElementById('roundTimer');
    const sound = document.getElementById('roundEndSound');
    const battleTrack = document.getElementById('battleTrack');
    const opponentVideo = document.getElementById('opponentVideo');
    const opponentImage = document.getElementById('opponentImage');
    const opponentUsername = document.getElementById('opponentUsername');

    const categoryModal = document.getElementById('categoryModal');
    const optionsModal = document.getElementById('optionsModal');
    const optionsTitle = document.getElementById('optionsTitle');
    const optionsSubtitle = document.getElementById('optionsSubtitle');
    const optionsBody = document.getElementById('optionsBody');
    const optionsHint = document.getElementById('optionsHint');
    const startBattleBtn = document.getElementById('startBattleBtn');
    const categoryGrid = document.getElementById('categoryGrid');

    document.getElementById('cancelCat').onclick = () => {
      categoryModal.classList.remove('show');
      timerDisplay.innerText = "Open categories anytime to begin.";
      clearHash();
    };
    document.getElementById('backBtn').onclick = () => {
      optionsModal.classList.remove('show');
      categoryModal.classList.add('show');
      startBattleBtn.style.display = 'none';
      chosenSub = null;
      updateHash(currentCategory, null);
      categoryGrid.querySelectorAll('.pill').forEach(p=>p.classList.toggle('active', p.dataset.cat===currentCategory));
      categoryGrid.querySelector(`[data-cat="${currentCategory}"]`)?.focus();
    };

    // Category buttons
    categoryGrid.addEventListener('click', (e) => {
      const btn = e.target.closest('.pill[data-cat]');
      if (!btn) return;
      openCategory(btn.dataset.cat, true);
    });
    categoryGrid.addEventListener('keydown', (e) => {
      if ((e.key === 'Enter' || e.key === ' ') && e.target.matches('.pill[data-cat]')) {
        e.preventDefault();
        openCategory(e.target.dataset.cat, true);
      }
    });

    function openCategory(cat, fromUser) {
      try {
        currentCategory = cat;
        chosenSub = null;
        startBattleBtn.style.display = 'none';
        categoryGrid.querySelectorAll('.pill').forEach(p=>p.classList.toggle('active', p.dataset.cat===cat));
        buildOptionsFor(cat);
        categoryModal.classList.remove('show');
        optionsModal.classList.add('show');
        if (fromUser) updateHash(cat, null);
        optionsModal.querySelector('.pill')?.focus();
        console.log('[Category] Opened:', cat);
      } catch (err) {
        console.error('openCategory error:', err);
      }
    }

    function applyCategoryOpponent(cat) {
      const pool = opponentPools[cat] || [];
      if (pool.length) {
        const random = pool[Math.floor(Math.random() * pool.length)];
        opponentVideo.src = random.video;
        opponentImage.src = random.image;
        opponentUsername.innerText = random.username;
      }
    }

    function buildOptionsFor(cat) {
      optionsBody.innerHTML = '';
      chosenOptions = {};
      optionsHint.innerText = '';
      optionsTitle.innerText = `${cat} ‚Äì Options`;

      const wrapper = document.createElement('div');
      wrapper.className = 'grid';

      const items = subLists[cat] || [];
      if (cat === 'RAP') {
        optionsSubtitle.innerText = "Choose your instrumental.";
        items.forEach(b => {
          const btn = makePill(b.label, b.value, () => {
            chosenOptions.beat = b.value;
            chosenSub = b.label;
            battleTrack.src = b.value;
            battleTrack.load();
            optionsModal.classList.remove('show');
            startBattleBtn.style.display = 'block';
            timerDisplay.innerText = "üî• Ready ‚Äî tap BattleBillions to start!";
            updateHash(cat, b.label);
            applyCategoryOpponent(cat);
            console.log('[SubOption] RAP beat chosen:', b.label);
          });
          wrapper.appendChild(btn);
        });
        optionsHint.innerText = "Only RAP uses beats. Others don‚Äôt.";
      } else {
        const subtitleMap = {
          ART: "Choose your art style.",
          AUTO: "Choose your auto event.",
          DEBAT: "Choose your debate topic.",
          FASHION: "Choose your fashion lane.",
          INSTRUMENTS: "Choose your instrument."
        };
        optionsSubtitle.innerText = subtitleMap[cat] || "Choose an option.";
        items.forEach(label => {
          const btn = makePill(label, label, () => {
            chosenSub = label;
            chosenOptions[cat.toLowerCase()] = label;
            optionsModal.classList.remove('show');
            startBattleBtn.style.display = 'block';
            timerDisplay.innerText = "üî• Ready ‚Äî tap BattleBillions to start!";
            updateHash(cat, label);
            applyCategoryOpponent(cat);
            console.log('[SubOption] chosen:', cat, label);
          });
          wrapper.appendChild(btn);
        });
        const hints = {
          ART: "No instrumental here ‚Äî obviously.",
          AUTO: "Rev up. No instrumental picker needed.",
          DEBAT: "No beats ‚Äî just bars of logic.",
          FASHION: "Serving looks ‚Äî no instrumental here.",
          INSTRUMENTS: "Live performance mode ‚Äî no beat selection here."
        };
        optionsHint.innerText = hints[cat] || '';
      }

      optionsBody.appendChild(wrapper);
    }

    function makePill(label, value, onChoose) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'pill';
      btn.tabIndex = 0;
      btn.textContent = label;
      btn.dataset.value = value;
      btn.addEventListener('click', onChoose);
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onChoose(); }
      });
      return btn;
    }

    /* Deep link: #cat/<CAT>/<SUB?>  */
    function updateHash(cat, sub) {
      const frag = `#cat/${encodeURIComponent(cat)}${sub?`/${encodeURIComponent(sub)}`:''}`;
      history.pushState({cat, sub}, '', frag);
    }
    function clearHash(){ history.pushState({}, '', location.pathname + location.search); }

    function parseHashAndOpen() {
      const m = location.hash.match(/^#cat\/([^\/]+)(?:\/([^\/]+))?/i);
      if (!m) return;
      const cat = decodeURIComponent(m[1]);
      const sub = m[2] ? decodeURIComponent(m[2]) : null;
      if (!subLists[cat]) return;
      openCategory(cat, false);
      if (sub) {
        setTimeout(() => {
          const target = Array.from(optionsBody.querySelectorAll('.pill'))
            .find(b => (b.textContent.trim() === sub) || (b.dataset.value === sub));
          target?.click();
        }, 0);
      }
    }
    window.addEventListener('popstate', parseHashAndOpen);
    window.addEventListener('hashchange', parseHashAndOpen);

    /* Round & Dimming */
    let round = 1, roundPart = 0, timeLeft = 33;
    const maxRounds = 3;

    function setDim(active) { active ? streamContainer.classList.add('dimmed') : streamContainer.classList.remove('dimmed'); }
    function triggerGlow() { timerDisplay.classList.add('animate'); setTimeout(() => timerDisplay.classList.remove('animate'), 2000); }

    function runRoundPart() {
      setDim(true);
      const interval = setInterval(() => {
        timerDisplay.innerText = `Round ${round} of ${maxRounds} | ${(roundPart === 0 ? '@You' : '@Opponent')} | ${timeLeft}s`;
        timeLeft--;
        if (timeLeft < 0) {
          clearInterval(interval);
          sound.play();
          setDim(false);

          if (roundPart === 0) {
            roundPart = 1; timeLeft = 33;
            timerDisplay.innerText = `Switching to Opponent‚Ä¶`;
            setTimeout(runRoundPart, 6000);
          } else {
            if (round < maxRounds) {
              round++; roundPart = 0; timeLeft = 33;
              timerDisplay.innerText = `Switching to Next Round‚Ä¶`;
              setTimeout(runRoundPart, 6000);
            } else {
              timerDisplay.innerText = 'üî• Battle Over ‚Äî Great Work! üî•';
              triggerGlow(); setDim(false);
              setTimeout(loadRandomOpponent, 4000);
              startBattleBtn.style.display = 'block';
            }
          }
        }
      }, 1000);
    }

    function startBattle() {
      if (!currentCategory) { timerDisplay.innerText = "Pick a category first."; return; }
      if (currentCategory === 'RAP') {
        if (!chosenOptions.beat) { timerDisplay.innerText = "Pick an instrumental to start."; return; }
        battleTrack.play().catch(()=>{});
      }
      startBattleBtn.style.display = 'none';
      triggerGlow();
      round = 1; roundPart = 0; timeLeft = 33;
      runRoundPart();
    }

    function loadRandomOpponent() {
      const pool = opponentPools[currentCategory] || [];
      if (pool.length) {
        const random = pool[Math.floor(Math.random() * pool.length)];
        opponentVideo.src = random.video;
        opponentImage.src = random.image;
        opponentUsername.innerText = random.username;
      }
      setTimeout(() => {
        timerDisplay.innerText = "üî• New Opponent Ready ‚Äî pick options or press BattleBillions!";
      }, 1200);
    }

    /* Init */
    window.onload = () => {
      showScreen('battle');
      startCamera();
      timerDisplay.innerText = "Choose a category to begin‚Ä¶";
      setDim(false);
      parseHashAndOpen();
    };
  </script>
</body>
</html>
