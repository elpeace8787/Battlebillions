<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Create Account — BattleBillions</title>

  <!-- Orbitron font -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --bg:#000;
      --ink:#e9edf1; --ink-2:#cfd6dd; --ink-3:#9aa3ad;
      --gold:#FFD700; --gold-d:#caa800;
      --panel:rgba(255,255,255,.05);
      --ring:0 0 0 3px rgba(255,255,255,.12);
      --err:#ff6b6b;
      --ok:#3ddc97;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:'Orbitron',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; line-height:1.35;
    }

    /* Subtle ambient */
    .ambient{
      position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        radial-gradient(600px 300px at 90% -10%, rgba(255,215,0,.08), transparent 60%),
        radial-gradient(500px 250px at -10% 100%, rgba(255,255,255,.06), transparent 60%);
      filter: blur(0.3px);
      animation: drift 18s ease-in-out infinite alternate;
    }
    @keyframes drift{
      0%{transform:translateY(0)}
      100%{transform:translateY(6px)}
    }

    /* Top bar with X */
    .top-right{
      position:fixed; top:16px; right:16px; z-index:10;
    }
    .top-right a{display:inline-flex; align-items:center; gap:8px; text-decoration:none; color:var(--ink-2); font-size:12px}
    .top-right img{width:26px; height:26px; filter:brightness(0) invert(1); transition:transform .2s}
    .top-right a:hover img{transform:scale(1.08)}
    .logo{
      position:fixed; top:16px; left:16px; z-index:10; color:var(--gold); font-weight:700; letter-spacing:.5px
    }

    /* Container */
    .wrap{
      position:relative; z-index:1;
      max-width:860px; margin:96px auto 48px; padding:0 16px;
    }
    .card{
      background:var(--panel);
      border-radius:20px; padding:20px; box-shadow:0 0 24px rgba(255,215,0,.15);
    }

    /* Stepper header */
    .stepper{
      display:flex; align-items:center; gap:10px; margin-bottom:18px;
    }
    .dot{
      width:12px; height:12px; border-radius:999px; background:#333; position:relative;
    }
    .dot.active{background:var(--gold)}
    .bar{flex:1; height:2px; background:#222; border-radius:4px; overflow:hidden}
    .bar>span{display:block; height:100%; width:0; background:var(--gold); transition:width .4s ease}

    .title{font-size:20px; color:var(--ink); margin:4px 0 14px}

    /* Grid + inputs */
    .grid{display:grid; gap:12px}
    @media (min-width:700px){
      .grid.cols-2{grid-template-columns:1fr 1fr}
      .grid.cols-3{grid-template-columns:repeat(3,1fr)}
    }
    label{display:block; font-size:12px; color:var(--ink-3); margin-bottom:6px}
    input, select{
      width:100%; padding:12px 14px; border-radius:12px; border:0;
      background:#111; color:var(--ink); outline:none;
    }
    input:focus, select:focus{box-shadow:var(--ring)}
    .hint{font-size:11px; color:var(--ink-3)}
    .error{font-size:12px; color:var(--err); margin-top:6px; display:none}

    /* “Drop pill” selects */
    .pill-select{
      appearance:none;
      background:#111;
      border-radius:999px;
      padding:12px 16px;
    }
    .pill-row{display:flex; gap:10px; flex-wrap:wrap}
    .pill-col{flex:1 1 110px}

    .chipset{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      padding:8px 12px; border-radius:999px; background:#111; font-size:12px; cursor:pointer; user-select:none
    }
    .chip.active{background:var(--gold); color:#000; font-weight:700}

    /* Avatar */
    .avatar-upload{display:flex; align-items:center; gap:14px}
    .avatar{
      width:72px; height:72px; border-radius:999px; background:#111; overflow:hidden; flex:0 0 auto; border:1px solid #222
    }
    .avatar img{width:100%; height:100%; object-fit:cover}
    .file-btn{font-size:12px}

    /* Actions */
    .actions{
      display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:16px
    }
    .btn{
      appearance:none; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer;
      background:#1a1a1a; color:var(--ink); transition:transform .08s ease, background .2s;
    }
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:var(--gold); color:#000}
    .btn.primary:hover{background:#ffe255}
    .btn.ghost{background:#111}
    .btn[disabled]{opacity:.5; pointer-events:none}

    /* Social providers (placeholders) */
    .providers{display:flex; gap:10px; flex-wrap:wrap}
    .provider{
      flex:1 1 120px; display:flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 12px; border-radius:12px; background:#101010; text-decoration:none; color:var(--ink-2); font-size:12px
    }

    /* Success overlay */
    .success{
      position:fixed; inset:0; background:rgba(0,0,0,.65);
      display:none; align-items:center; justify-content:center; z-index:20;
    }
    .success .box{
      background:linear-gradient(180deg, rgba(255,215,0,.15), rgba(255,215,0,.05));
      border:1px solid rgba(255,215,0,.25);
      padding:28px 22px; border-radius:18px; text-align:center; max-width:360px;
      box-shadow:0 0 80px rgba(255,215,0,.35), inset 0 0 60px rgba(255,215,0,.08);
      animation: pop .3s ease;
    }
    .success h3{margin:0 0 8px; color:var(--gold)}
    .success p{margin:0; color:var(--ink-2); font-size:13px}
    @keyframes pop{from{transform:scale(.98); opacity:0} to{transform:scale(1); opacity:1}}

    /* Footer links */
    .foot{
      text-align:center; margin-top:14px; font-size:12px; color:var(--ink-3)
    }
    .foot a{color:var(--ink-2); text-decoration:none}
  </style>
</head>
<body>
  <div class="ambient"></div>

  <div class="logo">BattleBillions</div>

  <div class="top-right">
    <a href="login.html" title="Back to Login">
      <img src="assets/icons/x-icon.png" alt="Close">
      <span>Back</span>
    </a>
  </div>

  <div class="wrap">
    <div class="card">
      <!-- Stepper -->
      <div class="stepper">
        <div class="dot active" data-stepdot="1"></div>
        <div class="bar"><span id="barFill" style="width:0%"></span></div>
        <div class="dot" data-stepdot="2"></div>
        <div class="dot" data-stepdot="3"></div>
        <div class="dot" data-stepdot="4"></div>
      </div>

      <!-- Step 1 -->
      <section class="step" data-step="1">
        <h2 class="title">Account Basics</h2>
        <div class="grid cols-2">
          <div>
            <label for="ca-handle">Username / Handle</label>
            <input id="ca-handle" type="text" placeholder="@yourname" autocomplete="nickname" maxlength="20"/>
            <div class="hint">3–20 chars, letters/numbers/underscore</div>
            <div class="error" id="err-handle">Invalid or taken handle.</div>
          </div>
          <div>
            <label for="ca-invite">Invite Code (optional)</label>
            <input id="ca-invite" type="text" placeholder="Enter code (if any)"/>
          </div>
          <div>
            <label for="ca-email">Email</label>
            <input id="ca-email" type="email" placeholder="you@example.com" autocomplete="email"/>
            <div class="error" id="err-email">Enter a valid email.</div>
          </div>
          <div>
            <label for="ca-password">Password</label>
            <input id="ca-password" type="password" placeholder="8+ chars, 1 letter & 1 number" autocomplete="new-password"/>
            <div class="hint" id="pw-hint">Strength: —</div>
            <div class="error" id="err-password">Password too weak.</div>
          </div>
          <div>
            <label for="ca-password2">Confirm Password</label>
            <input id="ca-password2" type="password" placeholder="Re-enter password" autocomplete="new-password"/>
            <div class="error" id="err-password2">Passwords don’t match.</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="ca-cancel-1" onclick="location.href='login.html'">Cancel</button>
          <button class="btn primary" id="ca-next-1">Next</button>
        </div>
      </section>

      <!-- Step 2 -->
      <section class="step" data-step="2" style="display:none">
        <h2 class="title">Identity & Region</h2>
        <div class="grid cols-3">
          <div>
            <label for="ca-country">Country</label>
            <select id="ca-country" class="pill-select">
              <option value="">Select country</option>
              <option>United States</option>
              <option>Canada</option>
              <option>United Kingdom</option>
              <option>Australia</option>
              <option>Other</option>
            </select>
          </div>
          <div>
            <label for="ca-state">State / Province</label>
            <input id="ca-state" type="text" placeholder="State / Province"/>
          </div>
          <div>
            <label for="ca-city">City</label>
            <input id="ca-city" type="text" placeholder="City"/>
          </div>

          <!-- Birthday as pill selects -->
          <div class="pill-col">
            <label for="ca-dob-month">Birth Month</label>
            <select id="ca-dob-month" class="pill-select"></select>
          </div>
          <div class="pill-col">
            <label for="ca-dob-day">Birth Day</label>
            <select id="ca-dob-day" class="pill-select"></select>
          </div>
          <div class="pill-col">
            <label for="ca-dob-year">Birth Year</label>
            <select id="ca-dob-year" class="pill-select"></select>
          </div>
          <div class="hint" style="grid-column:1/-1">Select Month • Day • Year</div>
          <div class="error" id="err-dob" style="grid-column:1/-1">You must be 13+ to join.</div>

          <!-- Chinese Zodiac -->
          <div>
            <label for="ca-zodiac">Chinese Zodiac</label>
            <select id="ca-zodiac" class="pill-select">
              <option value="">Auto (from year)</option>
              <option>Rat</option><option>Ox</option><option>Tiger</option><option>Rabbit</option>
              <option>Dragon</option><option>Snake</option><option>Horse</option><option>Goat</option>
              <option>Monkey</option><option>Rooster</option><option>Dog</option><option>Pig</option>
            </select>
            <div class="hint">Auto-fills from the selected year. You can override if you want.</div>
          </div>

          <div>
            <label for="ca-lang">Languages</label>
            <select id="ca-lang" multiple>
              <option>English</option>
              <option>Spanish</option>
              <option>French</option>
              <option>Arabic</option>
              <option>Hindi</option>
              <option>Chinese</option>
              <option>Other</option>
            </select>
            <div class="hint">Hold Ctrl/Cmd to select multiple</div>
          </div>
          <div>
            <label for="ca-ethnicity">Ethnicity (optional)</label>
            <select id="ca-ethnicity" class="pill-select">
              <option value="">Prefer not to say</option>
              <option>African / African American</option>
              <option>Asian</option>
              <option>Hispanic / Latino</option>
              <option>Middle Eastern / North African</option>
              <option>Native / Indigenous</option>
              <option>Pacific Islander</option>
              <option>White</option>
              <option>Other / Mixed</option>
            </select>
          </div>
          <div>
            <label for="ca-timezone">Timezone</label>
            <select id="ca-timezone" class="pill-select">
              <option value="">Auto-detect</option>
              <option>America/New_York</option>
              <option>America/Chicago</option>
              <option>America/Denver</option>
              <option>America/Los_Angeles</option>
              <option>UTC</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="ca-back-2">Back</button>
          <button class="btn primary" id="ca-next-2">Next</button>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="step" data-step="3" style="display:none">
        <h2 class="title">Education & Community</h2>
        <div class="grid cols-2">
          <div>
            <label for="ca-hs">High School</label>
            <input id="ca-hs" type="text" placeholder="Type your high school"/>
          </div>
          <div>
            <label for="ca-college">College / University</label>
            <input id="ca-college" type="text" placeholder="Type your college"/>
          </div>
          <div>
            <label for="ca-role">Role (optional)</label>
            <select id="ca-role" class="pill-select">
              <option value="">Select role</option>
              <option>Student</option>
              <option>Creator</option>
              <option>Athlete</option>
              <option>Musician</option>
              <option>Entrepreneur</option>
              <option>Other</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="ca-back-3">Back</button>
          <button class="btn primary" id="ca-next-3">Next</button>
        </div>
      </section>

      <!-- Step 4 -->
      <section class="step" data-step="4" style="display:none">
        <h2 class="title">Battle Setup</h2>
        <div class="grid">
          <div class="avatar-upload">
            <div class="avatar" id="avatarPreview"><img id="avatarImg" alt="" style="display:none"/></div>
            <div>
              <label for="ca-avatar">Profile Photo</label>
              <input id="ca-avatar" type="file" accept="image/*" class="file-btn"/>
              <div class="hint">Square images look best</div>
            </div>
          </div>

          <div>
            <label>Preferred Categories</label>
            <div class="chipset" id="catChips">
              <div class="chip">Rap</div>
              <div class="chip">Dance</div>
              <div class="chip">Gaming</div>
              <div class="chip">Art</div>
              <div class="chip">Sports</div>
              <div class="chip">Comedy</div>
            </div>
          </div>

          <div>
            <label><input type="checkbox" id="ca-terms"/> I agree to the Terms</label>
            <div class="hint">You must accept Terms & Privacy to continue</div>
          </div>
          <div>
            <label><input type="checkbox" id="ca-privacy"/> I agree to the Privacy Policy</label>
          </div>

          <!-- Providers (placeholders for official SDKs) -->
          <div>
            <label>Or sign up with</label>
            <div class="providers">
              <a href="#" class="provider" id="prov-google">Google</a>
              <a href="#" class="provider" id="prov-facebook">Facebook</a>
              <a href="#" class="provider" id="prov-instagram">Instagram</a>
              <a href="#" class="provider" id="prov-tiktok">TikTok</a>
            </div>
            <div class="hint">We’ll only ask for what’s missing after social sign up.</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn ghost" id="ca-back-4">Back</button>
          <button class="btn primary" id="ca-submit">Create Account</button>
        </div>
      </section>

      <div class="foot">
        By creating an account you agree to our <a href="#">Terms</a> & <a href="#">Privacy</a>.
      </div>
    </div>
  </div>

  <!-- Success overlay -->
  <div class="success" id="success">
    <div class="box">
      <h3>Account Created</h3>
      <p>Welcome to BattleBillions — redirecting to your home...</p>
    </div>
  </div>

  <script>
    (function(){
      const steps = Array.from(document.querySelectorAll('.step'));
      const dots  = Array.from(document.querySelectorAll('[data-stepdot]'));
      const barFill = document.getElementById('barFill');
      let current = 1;

      const get = id => document.getElementById(id);

      // Fields
      const f = {
        handle: get('ca-handle'),
        email: get('ca-email'),
        pw: get('ca-password'),
        pw2: get('ca-password2'),
        // Birthday pieces:
        m: get('ca-dob-month'),
        d: get('ca-dob-day'),
        y: get('ca-dob-year'),
        zodiacSel: get('ca-zodiac'),
        tz: get('ca-timezone'),
        terms: get('ca-terms'),
        privacy: get('ca-privacy'),
      };

      // Errors
      const err = {
        handle: get('err-handle'),
        email: get('err-email'),
        pw: get('err-password'),
        pw2: get('err-password2'),
        dob: get('err-dob'),
      };

      // Simple validators
      const reHandle = /^[a-zA-Z0-9_]{3,20}$/;
      const reEmail  = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const strength = s => {
        let score = 0;
        if(s.length>=8) score++;
        if(/[a-zA-Z]/.test(s)) score++;
        if(/[0-9]/.test(s)) score++;
        return ['—','Weak','OK','Strong'][score];
      };

      // Chinese zodiac from Gregorian year
      const zodiacNames = ['Rat','Ox','Tiger','Rabbit','Dragon','Snake','Horse','Goat','Monkey','Rooster','Dog','Pig'];
      function chineseZodiacByYear(year){
        // 2008 = Rat (index 0)
        const idx = ((year - 2008) % 12 + 12) % 12;
        return zodiacNames[idx];
      }

      // Build month/day/year
      const months = [
        'January','February','March','April','May','June',
        'July','August','September','October','November','December'
      ];
      // Populate months
      f.m.innerHTML = '<option value="">Month</option>' +
        months.map((m,i)=>`<option value="${i+1}">${m}</option>`).join('');

      // Populate years (13+ rule helper; still let user pick older)
      const now = new Date();
      const currentYear = now.getFullYear();
      const startYear = currentYear - 100;
      const endYear = currentYear; // show all, validate later
      let yearOpts = '<option value="">Year</option>';
      for(let y=endYear; y>=startYear; y--){
        yearOpts += `<option value="${y}">${y}</option>`;
      }
      f.y.innerHTML = yearOpts;

      // Days per month/year
      function daysInMonth(month, year){
        if(!month || !year) return 31;
        return new Date(year, month, 0).getDate();
      }
      function refreshDays(){
        const m = parseInt(f.m.value,10);
        const y = parseInt(f.y.value,10);
        const max = daysInMonth(m,y);
        const current = parseInt(f.d.value||'0',10);
        let html = '<option value="">Day</option>';
        for(let i=1;i<=max;i++){ html += `<option value="${i}">${i}</option>`; }
        f.d.innerHTML = html;
        if(current && current <= max){ f.d.value = String(current); }
      }
      f.d.innerHTML = '<option value="">Day</option>'; // initial

      // Birthday → zodiac auto
      function maybeUpdateZodiac(){
        const y = parseInt(f.y.value,10);
        if(y){
          const z = chineseZodiacByYear(y);
          // Only auto-set if user hasn't manually chosen a different one
          if(!f.zodiacSel.dataset.userOverride){
            f.zodiacSel.value = z;
          }
        }
      }

      // Age calc
      function ageFromParts(y,m,d){
        if(!y || !m || !d) return 0;
        const today = new Date();
        const dob = new Date(y, m-1, d);
        let age = today.getFullYear() - dob.getFullYear();
        const mm = today.getMonth() - dob.getMonth();
        if (mm < 0 || (mm === 0 && today.getDate() < dob.getDate())) age--;
        return age;
      }

      // Events for DOB selects
      f.m.addEventListener('change', ()=>{
        refreshDays();
      });
      f.y.addEventListener('change', ()=>{
        refreshDays();
        maybeUpdateZodiac();
      });
      f.d.addEventListener('change', ()=>{ /* no-op except keeping value */ });

      // User override tracking for zodiac
      f.zodiacSel.addEventListener('change', ()=>{
        // If user picks anything (including clearing), mark override
        f.zodiacSel.dataset.userOverride = '1';
      });

      // Password strength text
      const pwHint = document.getElementById('pw-hint');
      get('ca-password').addEventListener('input', ()=> pwHint.textContent = 'Strength: ' + strength(get('ca-password').value));

      // Progress UI
      function showStep(n){
        current = n;
        steps.forEach(s => s.style.display = (Number(s.dataset.step)===n)?'block':'none');
        dots.forEach((d,i)=> d.classList.toggle('active', i < n));
        const pct = ((n-1)/(steps.length-1))*100;
        barFill.style.width = pct + '%';
      }

      // Next buttons
      document.getElementById('ca-next-1').addEventListener('click', ()=>{
        let ok = true;
        // Handle
        if(!reHandle.test(f.handle.value.trim())){ err.handle.style.display='block'; ok=false; } else err.handle.style.display='none';
        // Email
        if(!reEmail.test(f.email.value.trim())){ err.email.style.display='block'; ok=false; } else err.email.style.display='none';
        // Password
        const pw = f.pw.value;
        const pwOk = pw.length>=8 && /[a-zA-Z]/.test(pw) && /[0-9]/.test(pw);
        if(!pwOk){ err.pw.style.display='block'; ok=false; } else err.pw.style.display='none';
        // Confirm
        if(f.pw2.value !== pw){ err.pw2.style.display='block'; ok=false; } else err.pw2.style.display='none';

        if(ok) showStep(2);
      });

      document.getElementById('ca-next-2').addEventListener('click', ()=>{
        // Validate age >= 13
        const y = parseInt(f.y.value,10);
        const m = parseInt(f.m.value,10);
        const d = parseInt(f.d.value,10);
        const a = ageFromParts(y,m,d);
        if(a < 13 || !y || !m || !d){
          err.dob.style.display='block';
          return;
        } else {
          err.dob.style.display='none';
        }

        // Timezone default if none
        if(!f.tz.value){ try { f.tz.value = Intl.DateTimeFormat().resolvedOptions().timeZone || ''; } catch(_){} }
        showStep(3);
      });

      document.getElementById('ca-next-3').addEventListener('click', ()=> showStep(4));

      // Back buttons
      document.getElementById('ca-back-2').addEventListener('click', ()=> showStep(1));
      document.getElementById('ca-back-3').addEventListener('click', ()=> showStep(2));
      document.getElementById('ca-back-4').addEventListener('click', ()=> showStep(3));

      // Chips
      document.getElementById('catChips').addEventListener('click', (e)=>{
        const c = e.target.closest('.chip'); if(!c) return;
        c.classList.toggle('active');
      });

      // Avatar preview
      document.getElementById('ca-avatar').addEventListener('change', (e)=>{
        const file = e.target.files?.[0]; if(!file) return;
        const img = document.getElementById('avatarImg');
        const reader = new FileReader();
        reader.onload = ev => {
          img.src = ev.target.result;
          img.style.display='block';
        };
        reader.readAsDataURL(file);
      });

      // Submit
      document.getElementById('ca-submit').addEventListener('click', ()=>{
        // Terms/Privacy check
        if(!f.terms.checked || !f.privacy.checked){
          alert('Please agree to the Terms and Privacy Policy.');
          return;
        }
        // Final minimal guard
        if(!reHandle.test(f.handle.value.trim()) || !reEmail.test(f.email.value.trim())){
          alert('Please complete required fields.');
          return;
        }
        // DOB check (again)
        const y = parseInt(f.y.value,10);
        const m = parseInt(f.m.value,10);
        const d = parseInt(f.d.value,10);
        const a = ageFromParts(y,m,d);
        if(a < 13 || !y || !m || !d){
          err.dob.style.display='block';
          return;
        } else {
          err.dob.style.display='none';
        }

        // Auto-set zodiac if none chosen
        if(!f.zodiacSel.value && y){
          f.zodiacSel.value = chineseZodiacByYear(y);
        }

        // Success shimmer + redirect
        const box = document.getElementById('success');
        box.style.display='flex';
        setTimeout(()=>{ window.location.href = 'home.html'; }, 1200);
      });

      // Initialize
      try { f.tz.value = Intl.DateTimeFormat().resolvedOptions().timeZone || ''; } catch(_){}
      showStep(1);
    })();
  </script>
</body>
</html>
