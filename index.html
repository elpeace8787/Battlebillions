<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BattleBillions ‚Äî Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --ink:#f5f5f5; --ink-2:#cecece; --muted:#8a8a8a; --line:#2a2a2a;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#000;color:var(--ink)}
    #bg{position:fixed;inset:0;width:100%;height:100%;display:block;background:radial-gradient(circle at 30% 20%, #101012 0%, #000 70%)}
    .auth-shell{position:relative; z-index:1; min-height:100vh; display:grid; place-items:center; padding:32px;}
    .stack{width:min(92vw,520px); display:grid; gap:16px}
    header{text-align:center}
    header h1{margin:0 0 6px; font-size:30px; letter-spacing:.4px; text-shadow:0 2px 18px rgba(255,255,255,.08)}
    header .sub{margin:0 0 12px; color:var(--muted); font-size:13px}

    .providers,.form{display:grid; gap:12px}
    .btn, input{
      width:100%; padding:12px 16px; border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,15,17,.28);
      -webkit-backdrop-filter: blur(6px) saturate(120%);
      backdrop-filter: blur(6px) saturate(120%);
      color:var(--ink); transition:transform .16s ease, background .16s ease, border-color .16s ease;
    }
    .btn:hover{transform:translateY(-2px); background:rgba(28,28,32,.36); border-color:rgba(255,255,255,.18)}
    .btn.primary{background:#fff;color:#000;border-color:transparent}
    .btn.primary:hover{background:#ececec}
    .btn.ghost{background:transparent;border-color:#3a3a3a}
    .btn.ghost:hover{border-color:#fff}
    .btn svg{width:20px;height:20px;vertical-align:middle;margin-right:10px}

    label{font-size:12px;color:var(--ink-2)}
    input:focus{outline:0;border-color:#fff;box-shadow:0 0 6px rgba(255,255,255,.25)}
    .pw-wrap{position:relative}
    .pw-toggle{position:absolute; right:10px; top:50%; transform:translateY(-50%); border:0; background:transparent; color:var(--muted); cursor:pointer; font-size:14px;}
    .actions{display:flex; gap:12px; margin-top:4px}

    .divider{display:flex;align-items:center;gap:10px;margin:6px 0}
    .divider::before,.divider::after{content:"";flex:1;height:1px;background:rgba(255,255,255,.12)}
    .divider span{font-size:12px;color:var(--muted)}

    .status{min-height:18px;font-size:12px;text-align:center;color:var(--muted)}
    .foot{position:fixed;left:0;right:0;bottom:12px;text-align:center;font-size:12px;color:var(--muted)}

    @media (prefers-reduced-motion: reduce){ #bg{background:#000} }
  </style>
</head>
<body>
  <canvas id="bg" aria-hidden="true"></canvas>

  <main class="auth-shell">
    <div class="stack">
      <header>
        <h1>BattleBillions</h1>
        <p class="sub">Enter Battles. Billions. Respect.</p>
      </header>

      <section class="providers">
        <button id="googleBtn" class="btn">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M21.35 12.18c0-.64-.06-1.25-.18-1.84H12v3.48h5.28a4.51 4.51 0 0 1-1.95 2.96v2.46h3.16c1.85-1.7 2.86-4.2 2.86-7.06z"/><path fill="#dcdcdc" d="M12 22c2.7 0 4.96-.89 6.61-2.4l-3.16-2.46c-.88.59-2 .94-3.45.94-2.65 0-4.9-1.79-5.7-4.2H3.03v2.64A10 10 0 0 0 12 22z"/><path fill="#a9a9a9" d="M6.3 13.88a6 6 0 0 1 0-3.76V7.48H3.03A10 10 0 0 0 2 12c0 1.6.38 3.1 1.03 4.52L6.3 13.88z"/><path fill="#8b8b8b" d="M12 6.5c1.46 0 2.77.5 3.8 1.48l2.84-2.84A9.98 9.98 0 0 0 12 2 10 10 0 0 0 3.03 7.48L6.3 10.12C7.1 7.71 9.35 6.5 12 6.5z"/></svg>
          Continue with Google
        </button>
        <button id="facebookBtn" class="btn">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M22 12.07C22 6.47 17.52 2 11.93 2 6.34 2 1.86 6.47 1.86 12.07c0 4.99 3.64 9.14 8.4 9.95v-7.03H7.96v-2.92h2.3V9.77c0-2.27 1.35-3.53 3.42-3.53.99 0 2.03.18 2.03.18v2.23h-1.14c-1.12 0-1.47.7-1.47 1.42v1.71h2.5l-.4 2.92h-2.1V22c4.77-.81 8.4-4.96 8.4-9.93z"/></svg>
          Continue with Facebook
        </button>
        <div class="divider"><span>or</span></div>
      </section>

      <form id="authForm" class="form" autocomplete="on">
        <div class="row">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" required />
        </div>
        <div class="row">
          <label for="password">Password</label>
          <div class="pw-wrap">
            <input id="password" type="password" minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
            <button type="button" id="togglePw" class="pw-toggle" aria-label="Show password">üëÅ</button>
          </div>
        </div>
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn primary">Sign In</button>
          <button id="modeBtn" type="button" class="btn ghost">Create account</button>
        </div>
      </form>

      <p id="status" class="status" role="status" aria-live="polite"></p>
    </div>
    <footer class="foot">¬© <span id="year"></span> BattleBillions</footer>
  </main>

  <!-- Auth logic -->
  <script type="module">
    import {
      auth, onAuthStateChanged, signInWithPopup,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      googleProvider, facebookProvider
    } from "./js/firebase.js";

    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submitBtn");
    const modeBtn = document.getElementById("modeBtn");
    const googleBtn = document.getElementById("googleBtn");
    const facebookBtn = document.getElementById("facebookBtn");
    const emailEl = document.getElementById("email");
    const pwEl = document.getElementById("password");
    const togglePw = document.getElementById("togglePw");
    document.getElementById("year").textContent = new Date().getFullYear();

    let isSignup = false;
    function setLoading(v,msg=""){submitBtn.disabled=v;googleBtn.disabled=v;facebookBtn.disabled=v;statusEl.textContent=msg;}
    function setMode(v){isSignup=v;submitBtn.textContent=v?"Create Account":"Sign In";modeBtn.textContent=v?"Have an account? Sign in":"Create account";statusEl.textContent="";}
    modeBtn.addEventListener("click",()=>setMode(!isSignup));
    togglePw.addEventListener("click",()=>{pwEl.type=pwEl.type==="password"?"text":"password";togglePw.setAttribute("aria-label",pwEl.type==="password"?"Show password":"Hide password");});

    document.getElementById("authForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim(), password = pwEl.value;
      if(!email || !password){statusEl.textContent="Email and password required.";return;}
      try{
        setLoading(true, isSignup ? "Creating your account..." : "Signing you in...");
        if(isSignup){ await createUserWithEmailAndPassword(auth,email,password); }
        else{ await signInWithEmailAndPassword(auth,email,password); }
      }catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    googleBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Google..."); await signInWithPopup(auth, googleProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    facebookBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Facebook..."); await signInWithPopup(auth, facebookProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    onAuthStateChanged(auth, (user)=>{ if(user){ window.location.href="./dashboard.html"; } });

    function niceError(err){
      const m=String(err?.message||err).toLowerCase();
      if(m.includes("auth/invalid-credential")) return "Invalid email or password.";
      if(m.includes("auth/invalid-email")) return "Enter a valid email.";
      if(m.includes("auth/weak-password")) return "Password must be at least 6 characters.";
      if(m.includes("auth/email-already-in-use")) return "That email is already in use.";
      if(m.includes("popup-closed-by-user")) return "Popup closed ‚Äî try again.";
      if(m.includes("auth/account-exists-with-different-credential")) return "Account exists with a different sign-in method for this email.";
      return "Error: " + (err?.message || "Something went wrong.");
    }
    setMode(false);
  </script>

  <!-- DBZ-style grayscale explosion engine (fast & mobile-friendly) -->
  <script>
    (function () {
      const reduce = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      const canvas = document.getElementById("bg");
      const ctx = canvas.getContext("2d", { alpha: true });

      // Perf controls
      const DPR_LIMIT = 1.25;
      const QUALITY = 0.85;
      const MAX_ENTITIES = 160;     // total puffs + rings + dust + streaks
      const BLAST_INTERVAL = 900;   // ms between major blasts
      const AMBIENT_WISPS = 3;      // background wisps per tick

      let scale = 1, w = 0, h = 0;
      function resize() {
        const dpr = Math.min(window.devicePixelRatio || 1, DPR_LIMIT);
        scale = dpr * QUALITY;
        w = Math.max(320, innerWidth);
        h = Math.max(480, innerHeight);
        canvas.width = Math.floor(w * scale);
        canvas.height = Math.floor(h * scale);
        canvas.style.width = w + "px";
        canvas.style.height = h + "px";
        ctx.setTransform(scale, 0, 0, scale, 0, 0);
      }
      addEventListener("resize", resize, { passive: true });
      resize();

      // ---- Sprites (no runtime blur/filters) ----
      function makeRadial(size, stops) {
        const c = document.createElement("canvas");
        c.width = c.height = size;
        const g = c.getContext("2d");
        const grad = g.createRadialGradient(size/2, size/2, 0, size/2, size/2, size/2);
        for (const [pos, col] of stops) grad.addColorStop(pos, col);
        g.fillStyle = grad; g.fillRect(0,0,size,size);
        return c;
      }
      // Soft smoke
      const SMOKE = makeRadial(128, [
        [0.00, "rgba(255,255,255,0.40)"],
        [0.35, "rgba(220,220,220,0.22)"],
        [0.75, "rgba(160,160,160,0.10)"],
        [1.00, "rgba(0,0,0,0.00)"]
      ]);
      // Shockwave edge (ring sprite)
      function makeRing(size=128){
        const c = document.createElement("canvas"); c.width = c.height = size;
        const g = c.getContext("2d");
        g.lineWidth = size*0.06;
        g.strokeStyle = "rgba(240,240,240,0.8)";
        g.beginPath(); g.arc(size/2,size/2,size*0.36,0,Math.PI*2); g.stroke();
        g.strokeStyle = "rgba(255,255,255,0.25)";
        g.lineWidth = size*0.14;
        g.beginPath(); g.arc(size/2,size/2,size*0.36,0,Math.PI*2); g.stroke();
        return c;
      }
      const RING = makeRing(128);

      const rnd = (a, b) => a + Math.random() * (b - a);
      const clamp = (v, a, b) => Math.max(a, Math.min(b, v));

      // ---- Entities ----
      const entities = [];
      class Puff {
        constructor(x, y, r, life, vx, vy, grow=20){
          this.t=0; this.life=life; this.x=x; this.y=y; this.r=r; this.vx=vx; this.vy=vy; this.grow=grow; this.j=rnd(0.9,1.15);
        }
        step(dt){ this.t+=dt; this.x+=this.vx*60*dt; this.y+=this.vy*60*dt; this.r+=this.grow*dt; return this.t<this.life; }
        draw(){
          const a = (1 - this.t/this.life) * 0.35;
          if(a<=0) return;
          const s = this.r*2*this.j;
          ctx.globalAlpha = a;
          ctx.drawImage(SMOKE, this.x - s/2, this.y - s/2, s, s);
          ctx.globalAlpha = 1;
        }
      }
      class Dust { // fast ground-hugging dust
        constructor(x,y,dir,speed,life){ this.t=0; this.life=life; this.x=x; this.y=y; this.dir=dir; this.speed=speed; this.r=rnd(6,16); }
        step(dt){ this.t+=dt; this.x+=Math.cos(this.dir)*this.speed*dt; this.y+=Math.sin(this.dir)*this.speed*dt; this.r+=14*dt; return this.t<this.life; }
        draw(){
          const a = (1 - this.t/this.life) * 0.25, s = this.r*2;
          if(a<=0) return;
          ctx.globalAlpha=a; ctx.drawImage(SMOKE, this.x - s/2, this.y - s/2, s, s); ctx.globalAlpha=1;
        }
      }
      class Ring {
        constructor(x,y){ this.t=0; this.life=0.9; this.x=x; this.y=y; this.r=40; this.grow=360; }
        step(dt){ this.t+=dt; this.r+=this.grow*dt; return this.t<this.life; }
        draw(){
          const a = (1 - this.t/this.life);
          if(a<=0) return;
          const s=this.r*2;
          ctx.globalAlpha = 0.55*a + 0.15;
          ctx.drawImage(RING, this.x - s/2, this.y - s/2, s, s);
          ctx.globalAlpha = 1;
        }
      }
      class Streak { // tiny anime debris
        constructor(x,y,angle,speed,life){ this.t=0; this.life=life; this.x=x; this.y=y; this.ax=Math.cos(angle)*speed; this.ay=Math.sin(angle)*speed; this.len=rnd(8,22); }
        step(dt){ this.t+=dt; this.x+=this.ax*dt; this.y+=this.ay*dt; this.ay+= -8*dt; return this.t<this.life; }
        draw(){
          const a = (1 - this.t/this.life)*0.8;
          if(a<=0) return;
          ctx.globalAlpha=a;
          ctx.strokeStyle="rgba(230,230,230,0.9)";
          ctx.lineWidth=1.2;
          ctx.beginPath();
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x - this.ax*0.03*this.len, this.y - this.ay*0.03*this.len);
          ctx.stroke();
          ctx.globalAlpha=1;
        }
      }

      function ambientWisps(){
        for(let i=0;i<AMBIENT_WISPS;i++){
          entities.push(new Puff(
            rnd(0,w), rnd(h*0.65,h),
            rnd(10,22), rnd(1.0,2.0),
            rnd(-0.25,0.25), rnd(-0.9,-0.35), 16
          ));
        }
      }

      function dbzBlast() {
        const cx = rnd(w*0.2, w*0.8);
        const cy = rnd(h*0.58, h*0.86);

        // Shockwave ring
        entities.push(new Ring(cx, cy));

        // Cap plumes (billowing top)
        const base = rnd(26, 40);
        const life = rnd(1.1, 1.7);
        for(let i=0;i<16;i++){
          const ang = rnd(-Math.PI, 0);
          const dist = rnd(0, base*2.0);
          const x = cx + Math.cos(ang)*dist;
          const y = cy + Math.sin(ang)*dist - rnd(8, 22);
          entities.push(new Puff(x,y,rnd(base*0.9, base*1.7), life, rnd(-0.3,0.3), rnd(-1.1,-0.45), 24));
        }

        // Stalk plume (column)
        for(let i=0;i<9;i++){
          const x = cx + rnd(-10,10);
          const y = cy + rnd(0,34) + i*1.5;
          entities.push(new Puff(x,y,rnd(base*0.5, base*0.9), life*0.95, rnd(-0.18,0.18), rnd(-0.95,-0.5), 20));
        }

        // Ground dust ring racing outward
        const dustCount = 14;
        for(let i=0;i<dustCount;i++){
          const theta = (i/dustCount)*Math.PI*2;
          entities.push(new Dust(cx, cy+base*0.6, theta, rnd(260, 420), rnd(0.5,0.9)));
        }

        // Debris streaks for anime pop
        for(let i=0;i<8;i++){
          entities.push(new Streak(cx, cy, rnd(0,Math.PI*2), rnd(240,360), rnd(0.25,0.45)));
        }
      }

      // Warm start
      for(let i=0;i<18;i++) ambientWisps();

      let prev = performance.now();
      let lastBlast = prev;

      function tick(now){
        if(reduce) return;
        const dt = clamp((now - prev)/1000, 0, 0.05);
        prev = now;

        // Clear + vignette
        ctx.clearRect(0,0,w,h);
        const vg = ctx.createRadialGradient(w*0.3,h*0.2,0,w*0.3,h*0.2,Math.max(w,h)*0.8);
        vg.addColorStop(0,"rgba(16,16,18,0.22)");
        vg.addColorStop(1,"rgba(0,0,0,0)");
        ctx.fillStyle = vg; ctx.fillRect(0,0,w,h);

        // Trigger blasts regularly
        if(now - lastBlast > BLAST_INTERVAL){
          dbzBlast();
          lastBlast = now;
        }
        // Ambient motion
        ambientWisps();

        // Cap total entities
        if(entities.length > MAX_ENTITIES) entities.splice(0, entities.length - MAX_ENTITIES);

        // Update/draw
        for(let i=0;i<entities.length;i++){
          if(!entities[i].step(dt)){ entities.splice(i,1); i--; continue; }
          entities[i].draw(ctx);
        }

        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
    })();
  </script>

  <noscript>Enable JavaScript to use BattleBillions.</noscript>
</body>
  </html>
