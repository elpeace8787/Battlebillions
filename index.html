<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3ATTLE33ILLIONS — App</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --ink:#f5f5f5; --ink-2:#cecece; --muted:#8a8a8a;
      --google-border:#dadce0;
      --facebook:#1877F2;
      --twitter:#1DA1F2;
      --accent:#ffd700;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#000;color:var(--ink)}
    #bg3d{position:fixed; inset:0; width:100%; height:100%; pointer-events:none; background:radial-gradient(1200px 800px at 30% 20%, #101012 0%, #000 70%); z-index:0;}

    .app-shell{position:relative; z-index:1; min-height:100vh; display:grid; place-items:center; padding:25px;}
    .stack{width:min(92vw,980px); display:grid; gap:18px}
    header{text-align:center}

    .title-wrap{ perspective:1200px; display:inline-block; user-select:none; }
    .title-3d{ position:relative; display:inline-block; transform-style:preserve-3d; transition:transform .3s ease; }
    header h1{
      margin:0; font-size:38px; text-transform:uppercase;
      background:linear-gradient(180deg,#fafafa 0%,#dcdcdc 28%,#a9a9a9 55%,#f3f3f3 82%);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      filter: drop-shadow(0 8px 22px rgba(0,0,0,.35)) drop-shadow(0 2px 8px rgba(255,215,0,.18));
      position:relative; animation:titleGlow 7.2s ease-in-out infinite;
    }
    @keyframes titleGlow{0%,100%{filter:drop-shadow(0 8px 22px rgba(0,0,0,.35)) drop-shadow(0 2px 8px rgba(255,215,0,.18));}50%{filter:drop-shadow(0 10px 26px rgba(0,0,0,.45)) drop-shadow(0 2px 12px rgba(255,235,140,.28));}}

    .form{display:grid; gap:12px}
    .btn, input{width:100%; padding:12px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.12); background:rgba(15,15,17,.28); -webkit-backdrop-filter:blur(6px) saturate(120%); backdrop-filter:blur(6px) saturate(120%); color:var(--ink);}
    .btn.primary{background:#fff;color:#000}
    .btn.ghost{background:transparent;border-color:#3a3a3a}

    .providers{display:grid; gap:10px}
    .provider-bar{display:flex; justify-content:center; gap:10px; flex-wrap:wrap;}
    .pbtn{width:44px; height:44px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,.14); background:rgba(15,15,17,.35);}
    .pbtn.google{background:#fff; border-color:var(--google-border);}
    .pbtn.facebook{background:var(--facebook);}
    .pbtn.twitter{background:var(--twitter);}

    .status{min-height:18px;font-size:12px;text-align:center;color:var(--muted)}
    .foot{position:fixed;left:0;right:0;bottom:12px;text-align:center;font-size:12px;color:var(--muted)}

    .route-auth{display:block;}
    .route-frame{display:none;}
    .route-active{display:block !important;}
    .frame-wrap{position:fixed; inset:0; z-index:2; overflow:hidden;}
    .route-iframe{position:absolute; inset:0; width:100%; height:100%; border:0; background:transparent; opacity:0; transition:opacity .18s ease; pointer-events:none;}
    .route-iframe.visible{opacity:1; pointer-events:auto;}
    .app-shell.frame-active #route-auth {display:none !important;}
  </style>
</head>
<body>
<canvas id="bg3d"></canvas>
<main class="app-shell">
  <!-- Login view -->
  <div id="route-auth" class="route-auth route-active">
    <div class="stack">
      <header>
        <div class="title-wrap" id="titleWrap">
          <div class="title-3d" id="title3d">
            <h1>3ATTLE33ILLIONS</h1>
          </div>
        </div>
      </header>

      <form id="authForm" class="form">
        <label>Email<input id="email" type="email" required></label>
        <label>Password<input id="password" type="password" required></label>
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn primary">Sign In</button>
          <button id="modeBtn" type="button" class="btn ghost">Create Account</button>
        </div>
      </form>

      <div class="divider"><span>or continue with</span></div>
      <section class="providers">
        <div class="provider-bar">
          <button id="googleBtn" class="pbtn google" title="Google"></button>
          <button id="facebookBtn" class="pbtn facebook" title="Facebook"></button>
          <button id="twitterBtn" class="pbtn twitter" title="Twitter"></button>
        </div>
      </section>

      <p id="status" class="status"></p>
    </div>
    <footer class="foot">© <span id="year"></span> BattleBillions</footer>
  </div>

  <!-- SPA iframe container -->
  <div id="route-frame" class="route-frame">
    <div class="frame-wrap">
      <iframe id="frameA" class="route-iframe visible"></iframe>
      <iframe id="frameB" class="route-iframe"></iframe>
    </div>
  </div>
</main>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

// Routing
const routes = {
  "/auth/login":  {type:"auth"},
  "/auth/create": {type:"frame", src:"createaccount.html"},
  "/home":        {type:"frame", src:"home.html"},
  "/discover":    {type:"frame", src:"discover.html"},
  "/opponent":    {type:"frame", src:"opponent.html"},
  "/battle":      {type:"frame", src:"live.html"},
  "/leaderboard": {type:"frame", src:"leaderboard.html"},
  "/profile":     {type:"frame", src:"profile.html"}
};
const authView=document.getElementById("route-auth"), frameView=document.getElementById("route-frame"), appShell=document.querySelector(".app-shell");
const frameA=document.getElementById("frameA"), frameB=document.getElementById("frameB"); let visible=frameA, hidden=frameB;

function parseHash(){const raw=location.hash||"#/auth/login";const parts=raw.slice(1).split("/").filter(Boolean);if(parts[0]==="auth"&&parts[1]==="create")return{base:"/auth/create"};if(parts[0]==="profile"&&parts[1])return{base:"/profile",id:parts[1]};const base=`/${parts[0]||"auth"}`;if(base==="/auth")return{base:"/auth/login"};return{base};}
function showAuth(){appShell.classList.remove("frame-active");authView.classList.add("route-active");frameView.classList.remove("route-active");}
function showFrame(src){appShell.classList.add("frame-active");authView.classList.remove("route-active");frameView.classList.add("route-active");if(visible.src===src)return;hidden.removeAttribute("src");hidden.classList.remove("visible");hidden.addEventListener("load",()=>{visible.classList.remove("visible");hidden.classList.add("visible");[visible,hidden]=[hidden,visible];},{once:true});hidden.src=src;}
function navigate(){const {base,id}=parseHash();const r=routes[base]||routes["/auth/login"];if(r.type==="auth")return showAuth();let src=r.src;if(base==="/profile"&&id)src=`${src}?uid=${encodeURIComponent(id)}`;showFrame(src);}
window.addEventListener("hashchange", navigate);
document.getElementById("authForm").addEventListener("submit",e=>{e.preventDefault();location.hash="/home";});
document.getElementById("modeBtn").addEventListener("click",()=>{location.hash="/auth/create";});
if(!location.hash)location.hash="/auth/login";navigate();
</script>

<!-- Social logins -->
<script type="module">
import { auth, db, googleProvider, facebookProvider, twitterProvider, signInWithPopup, onAuthStateChanged, doc, getDoc, setDoc, serverTimestamp } from "./firebase.js";

async function ensureUserDoc(user){
  const ref=doc(db,"users",user.uid);const snap=await getDoc(ref);
  if(!snap.exists()){await setDoc(ref,{email:user.email||"",displayName:user.displayName||"",avatarURL:user.photoURL||"",createdAt:serverTimestamp(),username:null,dob:null,age:null,westernZodiac:null,chineseZodiac:null});return{existed:false,data:null};}
  return{existed:true,data:snap.data()};
}
function needsCompletion(data){return!(data&&data.username&&data.dob&&data.age&&data.westernZodiac&&data.chineseZodiac);}
async function handleOAuth(provider){
  try{const res=await signInWithPopup(auth,provider);const {data}=await ensureUserDoc(res.user);location.hash=needsCompletion(data)?"/auth/create?mode=complete":"/home";}
  catch(err){document.getElementById("status").textContent=err.message;}
}
document.getElementById("googleBtn").onclick=()=>handleOAuth(googleProvider);
document.getElementById("facebookBtn").onclick=()=>handleOAuth(facebookProvider);
document.getElementById("twitterBtn").onclick=()=>handleOAuth(twitterProvider);

onAuthStateChanged(auth,async(u)=>{if(!u)return;const ref=doc(db,"users",u.uid);const snap=await getDoc(ref);location.hash=(!snap.exists()||needsCompletion(snap.data()))?"/auth/create?mode=complete":"/home";});
</script>

<!-- Three.js background explosions -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script>
/* background explosion effect code same as before */
</script>
</body>
</html>
