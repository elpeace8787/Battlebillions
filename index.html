<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3ATTLE33ILLIONS ‚Äî Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --ink:#f5f5f5; --ink-2:#cecece; --muted:#8a8a8a; --line:#2a2a2a;
      --google-border:#dadce0;
      --facebook:#1877F2;
      --tiktok:#000000;
      /* Instagram gradient stops (approx official) */
      --ig1:#f58529; --ig2:#dd2a7b; --ig3:#8134af; --ig4:#515bd4;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#000;color:var(--ink)}
    #bg{position:fixed;inset:0;width:100%;height:100%;display:block;background:radial-gradient(circle at 30% 20%, #101012 0%, #000 70%)}
    .auth-shell{position:relative; z-index:1; min-height:100vh; display:grid; place-items:center; padding:32px;}
    .stack{width:min(92vw,520px); display:grid; gap:16px}
    header{text-align:center}
    header h1{margin:0 0 6px; font-size:30px; letter-spacing:.4px; text-shadow:0 2px 18px rgba(255,255,255,.08)}
    header .sub{margin:0 0 12px; color:var(--muted); font-size:13px}

    .providers,.form{display:grid; gap:12px}
    .btn, input{
      width:100%; padding:12px 16px; border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(15,15,17,.28);
      -webkit-backdrop-filter: blur(6px) saturate(120%);
      backdrop-filter: blur(6px) saturate(120%);
      color:var(--ink); transition:transform .16s ease, background .16s ease, border-color .16s ease, box-shadow .16s ease;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-2px)}
    .btn svg{width:20px;height:20px;vertical-align:middle;margin-right:10px}

    /* Brand styles */
    .btn.google{
      background:#fff; color:#000; border-color:var(--google-border);
      box-shadow:0 1px 1px rgba(0,0,0,.06);
    }
    .btn.google:hover{box-shadow:0 2px 6px rgba(0,0,0,.12)}
    .btn.facebook{ background:var(--facebook); color:#fff; border-color:transparent }
    .btn.facebook:hover{box-shadow:0 2px 6px rgba(24,119,242,.35)}
    .btn.instagram{
      background:linear-gradient(135deg,var(--ig1),var(--ig2),var(--ig3),var(--ig4));
      color:#fff; border-color:transparent;
    }
    .btn.instagram:hover{box-shadow:0 2px 6px rgba(221,42,123,.35)}
    .btn.tiktok{
      background:#000; color:#fff; border-color:#222;
    }
    .btn.tiktok:hover{box-shadow:0 2px 6px rgba(0,0,0,.35)}
    /* Primary + ghost (email/password) */
    .btn.primary{background:#fff;color:#000;border-color:transparent}
    .btn.primary:hover{background:#ececec}
    .btn.ghost{background:transparent;border-color:#3a3a3a}
    .btn.ghost:hover{border-color:#fff}

    label{font-size:12px;color:var(--ink-2)}
    input:focus{outline:0;border-color:#fff;box-shadow:0 0 6px rgba(255,255,255,.25)}
    input{color:#eaeaea}
    .pw-wrap{position:relative}
    .pw-toggle{position:absolute; right:10px; top:50%; transform:translateY(-50%); border:0; background:transparent; color:var(--muted); cursor:pointer; font-size:14px;}
    .actions{display:flex; gap:12px; margin-top:4px}

    .divider{display:flex;align-items:center;gap:10px;margin:6px 0}
    .divider::before,.divider::after{content:"";flex:1;height:1px;background:rgba(255,255,255,.12)}
    .divider span{font-size:12px;color:var(--muted)}

    .status{min-height:18px;font-size:12px;text-align:center;color:var(--muted)}
    .foot{position:fixed;left:0;right:0;bottom:12px;text-align:center;font-size:12px;color:var(--muted)}

    @media (prefers-reduced-motion: reduce){ #bg{background:#000} }
  </style>
</head>
<body>
  <canvas id="bg" aria-hidden="true"></canvas>

  <main class="auth-shell">
    <div class="stack">
      <header>
        <h1>3ATTLE33ILLIONS</h1>
        <p class="sub">Enter Battles. Billions. Respect.</p>
      </header>

      <section class="providers">
        <!-- Google -->
        <button id="googleBtn" class="btn google" aria-label="Continue with Google">
          <!-- Official multicolor G -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#EA4335" d="M12 10.2v3.6h5.02c-.22 1.3-1.52 3.8-5.02 3.8-3.03 0-5.5-2.5-5.5-5.6s2.47-5.6 5.5-5.6c1.73 0 2.9.73 3.57 1.36l2.43-2.36C16.7 3.7 14.55 2.8 12 2.8 6.98 2.8 2.9 6.88 2.9 12s4.08 9.2 9.1 9.2c5.25 0 8.7-3.68 8.7-8.86 0-.6-.06-1.06-.14-1.54H12z"/>
            <path fill="#4285F4" d="M3.5 7.4l2.96 2.17C7.23 7.6 9.41 6.4 12 6.4c1.73 0 2.9.73 3.57 1.36l2.43-2.36C16.7 3.7 14.55 2.8 12 2.8 8.83 2.8 6.04 4.52 4.5 7.02z" opacity=".001"/>
            <path fill="#FBBC05" d="M12 21.2c2.88 0 5.3-.94 7.07-2.56l-3.3-2.7c-.89.6-2.07.96-3.77.96-3.01 0-5.54-2.5-5.54-5.6 0-.87.2-1.69.55-2.41L3.5 7.4A9.16 9.16 0 0 0 2.9 12c0 5.12 4.08 9.2 9.1 9.2z"/>
            <path fill="#34A853" d="M21.1 12c0-.6-.06-1.06-.14-1.54H12v3.6h5.02c-.22 1.3-1.52 3.8-5.02 3.8-1.89 0-3.5-.79-4.6-2.05l-3.3 2.56A9.2 9.2 0 0 0 12 21.2c5.25 0 8.7-3.68 8.7-8.86z"/>
            <path fill="#EA4335" d="M3.5 7.4l2.96 2.17" opacity=".001"/>
          </svg>
          Continue with Google
        </button>

        <!-- Facebook -->
        <button id="facebookBtn" class="btn facebook" aria-label="Continue with Facebook">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#FFFFFF" d="M22 12.07C22 6.47 17.52 2 11.93 2 6.34 2 1.86 6.47 1.86 12.07c0 4.99 3.64 9.14 8.4 9.95v-7.03H7.96v-2.92h2.3V9.77c0-2.27 1.35-3.53 3.42-3.53.99 0 2.03.18 2.03.18v2.23h-1.14c-1.12 0-1.47.7-1.47 1.42v1.71h2.5l-.4 2.92h-2.1V22c4.77-.81 8.4-4.96 8.4-9.93z"/>
          </svg>
          Continue with Facebook
        </button>

        <!-- Instagram (UI-ready; needs backend/OAuth hookup) -->
        <button id="instagramBtn" class="btn instagram" aria-label="Continue with Instagram">
          <!-- Simple outline camera matching brand feel -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <rect x="3" y="3" width="18" height="18" rx="5" ry="5" fill="none" stroke="white" stroke-width="2"/>
            <circle cx="12" cy="12" r="4.5" fill="none" stroke="white" stroke-width="2"/>
            <circle cx="17.5" cy="6.5" r="1.5" fill="white"/>
          </svg>
          Continue with Instagram
        </button>

        <!-- TikTok (UI-ready; needs backend/OAuth hookup) -->
        <button id="tiktokBtn" class="btn tiktok" aria-label="Continue with TikTok">
          <!-- TikTok note with brand duotone -->
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M14.5 2v9.2a3.8 3.8 0 1 1-3-3.7" fill="none" stroke="#69C9D0" stroke-width="2" stroke-linecap="round"/>
            <path d="M14.5 4.2c.9 1.6 2.6 3 4.5 3.2V10c-1.9-.1-3.4-.7-4.5-1.5v4.7a5.8 5.8 0 1 1-4.6-5.6" fill="none" stroke="#EE1D52" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Continue with TikTok
        </button>

        <div class="divider"><span>or</span></div>
      </section>

      <form id="authForm" class="form" autocomplete="on">
        <div class="row">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" required />
        </div>
        <div class="row">
          <label for="password">Password</label>
          <div class="pw-wrap">
            <input id="password" type="password" minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
            <button type="button" id="togglePw" class="pw-toggle" aria-label="Show password">üëÅ</button>
          </div>
        </div>
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn primary">Sign In</button>
          <button id="modeBtn" type="button" class="btn ghost">Create account</button>
        </div>
      </form>

      <p id="status" class="status" role="status" aria-live="polite"></p>
    </div>
    <footer class="foot">¬© <span id="year"></span> BattleBillions</footer>
  </main>

  <!-- Auth logic -->
  <script type="module">
    import {
      auth, onAuthStateChanged, signInWithPopup,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      googleProvider, facebookProvider
    } from "./js/firebase.js";

    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submitBtn");
    const modeBtn = document.getElementById("modeBtn");
    const googleBtn = document.getElementById("googleBtn");
    const facebookBtn = document.getElementById("facebookBtn");
    const instagramBtn = document.getElementById("instagramBtn");
    const tiktokBtn = document.getElementById("tiktokBtn");
    const emailEl = document.getElementById("email");
    const pwEl = document.getElementById("password");
    const togglePw = document.getElementById("togglePw");
    document.getElementById("year").textContent = new Date().getFullYear();

    let isSignup = false;
    function setLoading(v,msg=""){submitBtn.disabled=v;googleBtn.disabled=v;facebookBtn.disabled=v;instagramBtn.disabled=v;tiktokBtn.disabled=v;statusEl.textContent=msg;}
    function setMode(v){isSignup=v;submitBtn.textContent=v?"Create Account":"Sign In";modeBtn.textContent=v?"Have an account? Sign in":"Create account";statusEl.textContent="";}
    modeBtn.addEventListener("click",()=>setMode(!isSignup));
    togglePw.addEventListener("click",()=>{pwEl.type=pwEl.type==="password"?"text":"password";togglePw.setAttribute("aria-label",pwEl.type==="password"?"Show password":"Hide password");});

    document.getElementById("authForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim(), password = pwEl.value;
      if(!email || !password){statusEl.textContent="Email and password required.";return;}
      try{
        setLoading(true, isSignup ? "Creating your account..." : "Signing you in...");
        if(isSignup){ await createUserWithEmailAndPassword(auth,email,password); }
        else{ await signInWithEmailAndPassword(auth,email,password); }
      }catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    googleBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Google..."); await signInWithPopup(auth, googleProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    facebookBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Facebook..."); await signInWithPopup(auth, facebookProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    // Instagram/TikTok placeholders (UI added; needs backend OAuth)
    instagramBtn.addEventListener("click", ()=>{
      statusEl.textContent = "Instagram sign-in not configured yet.";
    });
    tiktokBtn.addEventListener("click", ()=>{
      statusEl.textContent = "TikTok sign-in not configured yet.";
    });

    onAuthStateChanged(auth, (user)=>{ if(user){ window.location.href="./dashboard.html"; } });

    function niceError(err){
      const m=String(err?.message||err).toLowerCase();
      if(m.includes("auth/invalid-credential")) return "Invalid email or password.";
      if(m.includes("auth/invalid-email")) return "Enter a valid email.";
      if(m.includes("auth/weak-password")) return "Password must be at least 6 characters.";
      if(m.includes("auth/email-already-in-use")) return "That email is already in use.";
      if(m.includes("popup-closed-by-user")) return "Popup closed ‚Äî try again.";
      if(m.includes("auth/account-exists-with-different-credential")) return "Account exists with a different sign-in method for this email.";
      return "Error: " + (err?.message || "Something went wrong.");
    }
    setMode(false);
  </script>

  <!-- Full-screen smoke (grey build-up) ‚Üí timed gold explosion with double shockwave and varied moves -->
  <script>
  (function () {
    const canvas = document.getElementById("bg");
    const ctx = canvas.getContext("2d", { alpha: true });

    // Perf & pacing
    const DPR_LIMIT = 1.25, QUALITY = 0.9;
    const MAX_ENTITIES = 260;          // room for fighters + rings + smoke
    const BLAST_INTERVAL = 900;        // ms between fights
    const AMBIENT_WISPS = 2;           // idle motion

    let scale=1,w=0,h=0;
    function resize(){
      const dpr=Math.min(window.devicePixelRatio||1,DPR_LIMIT);
      scale=dpr*QUALITY; w=innerWidth; h=innerHeight;
      canvas.width=Math.floor(w*scale); canvas.height=Math.floor(h*scale);
      canvas.style.width=w+"px"; canvas.style.height=h+"px";
      ctx.setTransform(scale,0,0,scale,0,0);
    }
    addEventListener("resize",resize,{passive:true}); resize();

    // --------- Sprites ----------
    function makeRadial(size,stops){
      const c=document.createElement("canvas"); c.width=c.height=size;
      const g=c.getContext("2d");
      const grad=g.createRadialGradient(size/2,size/2,0,size/2,size/2,size/2);
      for(const[s,col] of stops) grad.addColorStop(s,col);
      g.fillStyle=grad; g.fillRect(0,0,size,size);
      return c;
    }
    // grey smoke for build-up
    const SMOKE=makeRadial(128,[
      [0,"rgba(255,255,255,0.45)"],
      [0.4,"rgba(200,200,200,0.20)"],
      [0.75,"rgba(120,120,120,0.08)"],
      [1,"rgba(0,0,0,0.00)"]
    ]);
    // gold explosion
    const GOLD=makeRadial(128,[
      [0,"rgba(255,230,150,0.65)"],
      [0.35,"rgba(255,200,80,0.38)"],
      [0.7,"rgba(255,160,0,0.18)"],
      [1,"rgba(255,120,0,0.00)"]
    ]);
    // ring sprites
    function makeRing(size=128, strong=true){
      const c=document.createElement("canvas"); c.width=c.height=size;
      const g=c.getContext("2d");
      g.strokeStyle = strong ? "rgba(255,215,0,0.9)" : "rgba(255,220,120,0.55)";
      g.lineWidth = strong ? size*0.12 : size*0.08;
      g.beginPath(); g.arc(size/2,size/2,size*0.35,0,Math.PI*2); g.stroke();
      return c;
    }
    const RING_STRONG=makeRing(128,true);
    const RING_SOFT=makeRing(128,false);

    const rnd=(a,b)=>a+Math.random()*(b-a);
    const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
    const entities=[];

    class Puff{
      constructor(x,y,r,life,vx,vy,grow=22,colorMode=0){
        this.t=0; this.life=life; this.x=x; this.y=y; this.r=r;
        this.vx=vx; this.vy=vy; this.grow=grow; this.colorMode=colorMode; // 0 auto grey‚Üígold, 1 gold-only
      }
      step(dt){ this.t+=dt; this.x+=this.vx*60*dt; this.y+=this.vy*60*dt; this.r+=this.grow*dt; return this.t<this.life; }
      draw(){
        const f=this.t/this.life; let a=(1-f)*0.4; if(a<=0) return;
        const s=this.r*2; ctx.globalAlpha=a;
        if(this.colorMode===1){ ctx.drawImage(GOLD,this.x-s/2,this.y-s/2,s,s); }
        else { ctx.drawImage(f<0.5?SMOKE:GOLD,this.x-s/2,this.y-s/2,s,s); }
        ctx.globalAlpha=1;
      }
    }
    class Ring{
      constructor(x,y,strong=true,delay=0){
        this.x=x; this.y=y; this.t=-delay; this.life=0.95; this.r=42; this.grow=460; this.strong=strong;
      }
      step(dt){ this.t+=dt; if(this.t<0) return true; this.r+=this.grow*dt; return this.t<this.life; }
      draw(){
        if(this.t<0) return;
        const a=(1-this.t/this.life); if(a<=0) return; const s=this.r*2; ctx.globalAlpha=a;
        ctx.drawImage(this.strong?RING_STRONG:RING_SOFT,this.x-s/2,this.y-s/2,s,s);
        ctx.globalAlpha=1;
      }
    }

    // ---- FIGHTERS with varied moves ----
    const MOVES = [
      { name:"straight",  hitTime:0.28, leadArm:[14, -2], rearArm:[-6, 6], leadLeg:[-6, 18], rearLeg:[4, 20],  lunge:10, recoil:8,  kick:false },
      { name:"hook",      hitTime:0.30, leadArm:[10, -4], rearArm:[-8, 8], leadLeg:[-6, 18], rearLeg:[6, 20],  lunge:12, recoil:10, hook:true,  kick:false },
      { name:"uppercut",  hitTime:0.32, leadArm:[10,-10], rearArm:[-6, 6], leadLeg:[-7, 18], rearLeg:[6, 20],  lunge:9,  recoil:9,  upper:true, kick:false },
      { name:"frontkick", hitTime:0.34, leadArm:[-4, 4],  rearArm:[-6, 6], leadLeg:[14, 6],  rearLeg:[-6, 18], lunge:14, recoil:12, kick:true,  round:false },
      { name:"roundhouse",hitTime:0.36, leadArm:[-4, 6],  rearArm:[-8, 8], leadLeg:[18, 2],  rearLeg:[-8, 18], lunge:16, recoil:14, kick:true,  round:true }
    ];

    class Fighters {
      constructor(x,y,impactCallback){
        this.cx=x; this.cy=y; this.t=0; this.life=0.7;
        this.rot=rnd(-Math.PI, Math.PI);
        this.scale=rnd(0.8, 1.15);
        this.move = MOVES[(Math.random()*MOVES.length)|0];
        this.hitTime=this.move.hitTime;
        this.didHit=false;
        this.impact = impactCallback;
      }
      step(dt){
        this.t+=dt;
        if(!this.didHit && this.t>=this.hitTime){
          this.didHit=true;
          this.impact?.(this.cx, this.cy); // trigger explosion at impact
        }
        return this.t < this.life;
      }
      draw(){
        const f=this.t/this.life;
        const a=(1-f)*0.95;
        const pre = Math.min(1, this.t/this.hitTime);
        const post = Math.max(0, (this.t - this.hitTime)/(this.life - this.hitTime));
        const lungeAmt = this.move.lunge*pre - this.move.recoil*post;

        ctx.save();
        ctx.translate(this.cx, this.cy);
        ctx.rotate(this.rot + pre*0.4 - post*0.2);
        ctx.scale(this.scale, this.scale);
        ctx.strokeStyle = `rgba(255, ${210 + Math.floor(45*f)}, ${Math.floor(40 + 150*f)}, ${a})`;
        ctx.lineWidth = 2;

        const baseGap = 18;
        const offset = baseGap - lungeAmt*0.6 + post*6;
        const lx = -offset, rx = offset;

        const pc = Math.sin(pre*Math.PI); // punch curve 0..1..0
        const kc = this.move.kick ? Math.sin(pre*Math.PI) : 0;

        drawFighter(lx, 0, +1, pc, kc, this.move);
        drawFighter(rx, 0, -1, pc, kc, this.move, true);

        ctx.restore();
function drawFighter(cx, cy, dir, pc, kc, mv, mirror=false){
          // Head
          ctx.beginPath(); ctx.arc(cx, cy-12, 5, 0, Math.PI*2); ctx.stroke();
          // Torso
          ctx.beginPath(); ctx.moveTo(cx, cy-7); ctx.lineTo(cx, cy+10); ctx.stroke();

          // Arms
          const laX = mv.leadArm[0]*dir, laY = mv.leadArm[1];
          const raX = mv.rearArm[0]*dir, raY = mv.rearArm[1];
          // Lead arm extends toward center with move-specific flavor
          ctx.beginPath();
          ctx.moveTo(cx, cy-4);
          let leadReachX = cx + laX + dir*(mv.hook ? 8*pc : mv.upper ? 10*pc : 14*pc);
          let leadReachY = cy + laY + (mv.upper ? (-10*pc) : (-4*Math.abs(pc)));
          ctx.lineTo(leadReachX, leadReachY);
          ctx.stroke();

          // Rear arm balances
          ctx.beginPath();
          ctx.moveTo(cx, cy-2);
          ctx.lineTo(cx + raX*(0.7+0.3*pc), cy + raY + 3*Math.abs(pc));
          ctx.stroke();

          // Legs
          const llX = mv.leadLeg[0]*dir, llY = mv.leadLeg[1];
          const rlX = mv.rearLeg[0]*dir, rlY = mv.rearLeg[1];

          // Lead leg: kicks on kick-moves
          ctx.beginPath();
          ctx.moveTo(cx, cy+10);
          const kickReachX = mv.kick ? (cx + llX + dir*(mv.round ? 20*kc : 16*kc)) : (cx + llX);
          const kickReachY = mv.kick ? (cy + Math.min(llY, 10 + (mv.round ? 2 : -6*kc))) : (cy + llY);
          ctx.lineTo(kickReachX, kickReachY);
          ctx.stroke();

          // Rear leg anchors
          ctx.beginPath();
          ctx.moveTo(cx, cy+10);
          ctx.lineTo(cx + rlX*(0.7+0.3*pc), cy + rlY);
          ctx.stroke();
        }
      }
    }

    function ambientWisps(){
      for(let i=0;i<AMBIENT_WISPS;i++){
        entities.push(new Puff(
          rnd(0,w), rnd(0,h),
          rnd(8,20), rnd(1.4,2.1),
          rnd(-0.25,0.25), rnd(-0.25,0.25), 18, 0
        ));
      }
    }

    // pre-hit build-up smoke (grey)
    function preSmoke(cx, cy){
      const base = rnd(22,34), life = rnd(0.8,1.2);
      for(let i=0;i<14;i++){
        const ang=rnd(0,Math.PI*2), dist=rnd(0,base*1.8);
        const x=cx+Math.cos(ang)*dist, y=cy+Math.sin(ang)*dist;
        entities.push(new Puff(x,y,rnd(base*0.6,base*1.2),life,rnd(-0.35,0.35),rnd(-0.35,0.35),20,0));
      }
    }

    // gold explosion exactly at impact + delayed second ring + gold smoke burst
    function goldExplosion(cx, cy){
      entities.push(new Ring(cx,cy,true,0));    // strong ring at impact
      entities.push(new Ring(cx,cy,false,0.08)); // softer second ring

      const base = rnd(30,44), life=rnd(1.0,1.6);
      for(let i=0;i<22;i++){
        const ang=rnd(0,Math.PI*2), dist=rnd(0,base*2.2);
        const x=cx+Math.cos(ang)*dist, y=cy+Math.sin(ang)*dist;
        entities.push(new Puff(x,y,rnd(base*0.7,base*1.6),life,rnd(-0.6,0.6),rnd(-0.6,0.6),26,1)); // gold-only
      }
    }

    function fightBlast(){
      const cx=rnd(0,w), cy=rnd(0,h);
      preSmoke(cx, cy);                                    // build-up smoke
      entities.push(new Fighters(cx, cy, goldExplosion));  // fighters call explosion on hit
    }

    // Loop
    let prev=performance.now(), last=prev;
    function tick(now){
      const dt=clamp((now-prev)/1000,0,0.05); prev=now;
      ctx.clearRect(0,0,w,h);

      if(now-last>BLAST_INTERVAL){ fightBlast(); last=now; }
      ambientWisps();

      if(entities.length>260) entities.splice(0,entities.length-260);

      for(let i=0;i<entities.length;i++){
        if(!entities[i].step(dt)){ entities.splice(i,1); i--; continue; }
        entities[i].draw(ctx);
      }
      requestAnimationFrame(tick);
    }
    requestAnimationFrame(tick);
  })();
  </script>

  <noscript>Enable JavaScript to use BattleBillions.</noscript>
</body>
</html>
        
