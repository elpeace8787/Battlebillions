<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BattleBillions ‚Äî Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg:#000; --card:#0f0f10; --line:#242426;
      --ink:#f5f5f5; --ink-2:#cecece; --muted:#8a8a8a; --r:18px;
      --white:#fff; --grey:#dcdcdc; --dim:#1a1a1a;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink);}

    /* Canvas background sits behind everything */
    #bg{
      position:fixed; inset:0; width:100%; height:100%;
      z-index:0; display:block; background:radial-gradient(circle at 30% 20%, #101012 0%, #000 70%);
    }

    .auth-shell{position:relative; z-index:1; width:100%; max-width:440px; margin:auto; padding:24px;}
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:34px 28px;
      box-shadow:0 6px 40px rgba(255,255,255,.06), inset 0 1px 0 rgba(255,255,255,.03);
      backdrop-filter:saturate(120%) blur(6px);
      animation:fadeInUp .6s ease-out both;
    }
    .card-head{text-align:center; margin-bottom:20px}
    .logo{width:150px; height:auto; margin:0 auto 10px; filter:drop-shadow(0 0 10px rgba(255,255,255,.12))}
    h1{font-size:24px; margin:6px 0 2px; letter-spacing:.4px}
    .sub{color:var(--muted); font-size:13px}

    .providers{display:grid; gap:12px; margin-bottom:16px}
    .btn{
      display:flex; align-items:center; justify-content:center; gap:12px;
      width:100%; padding:12px 16px; border-radius:var(--r);
      font-weight:600; cursor:pointer; transition:transform .2s ease, background .2s ease, border-color .2s ease;
      border:1px solid var(--line); color:var(--ink); background:var(--dim);
    }
    .btn:hover{transform:translateY(-2px); background:#1f1f22}
    .btn svg{width:20px; height:20px; flex:0 0 20px}
    .btn.primary{background:var(--white); color:#000; border-color:transparent}
    .btn.primary:hover{background:#ececec}
    .btn.ghost{background:transparent; border-color:#3a3a3a}
    .btn.ghost:hover{border-color:var(--ink)}

    .divider{display:flex; align-items:center; gap:10px; margin:12px 0}
    .divider::before,.divider::after{content:""; flex:1; height:1px; background:var(--line)}
    .divider span{font-size:12px; color:var(--muted)}

    .form{display:grid; gap:14px}
    .row label{font-size:12px; color:var(--ink-2); margin-bottom:6px; display:block}
    input{
      width:100%; padding:12px; border-radius:14px; border:1px solid var(--line);
      background:#0b0b0c; color:var(--ink); font-size:14px;
      transition:border-color .18s ease, box-shadow .18s ease;
    }
    input:focus{outline:0; border-color:#fff; box-shadow:0 0 6px rgba(255,255,255,.22)}

    .pw-wrap{position:relative}
    .pw-toggle{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      border:0; background:transparent; color:var(--muted); cursor:pointer; font-size:14px;
    }

    .actions{display:flex; gap:12px; margin-top:8px}
    .status{min-height:18px; font-size:12px; text-align:center; margin-top:12px; color:var(--muted)}
    .foot{text-align:center; font-size:12px; margin-top:16px; color:var(--muted)}

    @keyframes fadeInUp{from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:translateY(0)}}

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .card{animation:none}
      #bg{background:#000}
    }
  </style>
</head>
<body>
  <!-- Dynamic grayscale mushroom-smoke explosions -->
  <canvas id="bg" aria-hidden="true"></canvas>

  <main class="auth-shell">
    <div class="card">
      <header class="card-head">
        <img src="./assets/Logopit_1697753255912.png" alt="BattleBillions" class="logo" />
        <h1>Welcome back</h1>
        <p class="sub">Enter Battles. Billions. Respect.</p>
      </header>

      <section class="providers">
        <!-- Google (monochrome ‚ÄúG‚Äù) -->
        <button id="googleBtn" class="btn">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#fff" d="M21.35 12.18c0-.64-.06-1.25-.18-1.84H12v3.48h5.28a4.51 4.51 0 0 1-1.95 2.96v2.46h3.16c1.85-1.7 2.86-4.2 2.86-7.06z"/>
            <path fill="#dcdcdc" d="M12 22c2.7 0 4.96-.89 6.61-2.4l-3.16-2.46c-.88.59-2 .94-3.45.94-2.65 0-4.9-1.79-5.7-4.2H3.03v2.64A10 10 0 0 0 12 22z"/>
            <path fill="#a9a9a9" d="M6.3 13.88a6 6 0 0 1 0-3.76V7.48H3.03A10 10 0 0 0 2 12c0 1.6.38 3.1 1.03 4.52L6.3 13.88z"/>
            <path fill="#8b8b8b" d="M12 6.5c1.46 0 2.77.5 3.8 1.48l2.84-2.84A9.98 9.98 0 0 0 12 2 10 10 0 0 0 3.03 7.48L6.3 10.12C7.1 7.71 9.35 6.5 12 6.5z"/>
          </svg>
          Continue with Google
        </button>

        <!-- Facebook (monochrome ‚Äúf‚Äù) -->
        <button id="facebookBtn" class="btn">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path fill="#fff" d="M22 12.07C22 6.47 17.52 2 11.93 2 6.34 2 1.86 6.47 1.86 12.07c0 4.99 3.64 9.14 8.4 9.95v-7.03H7.96v-2.92h2.3V9.77c0-2.27 1.35-3.53 3.42-3.53.99 0 2.03.18 2.03.18v2.23h-1.14c-1.12 0-1.47.7-1.47 1.42v1.71h2.5l-.4 2.92h-2.1V22c4.77-.81 8.4-4.96 8.4-9.93z"/>
          </svg>
          Continue with Facebook
        </button>

        <div class="divider"><span>or</span></div>
      </section>

      <form id="authForm" class="form" autocomplete="on">
        <div class="row">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" required />
        </div>
        <div class="row">
          <label for="password">Password</label>
          <div class="pw-wrap">
            <input id="password" type="password" minlength="6" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
            <button type="button" id="togglePw" class="pw-toggle" aria-label="Show password">üëÅ</button>
          </div>
        </div>
        <div class="actions">
          <button id="submitBtn" type="submit" class="btn primary">Sign In</button>
          <button id="modeBtn" type="button" class="btn ghost">Create account</button>
        </div>
      </form>

      <p id="status" class="status" role="status" aria-live="polite"></p>
    </div>
    <footer class="foot">¬© <span id="year"></span> BattleBillions</footer>
  </main>

  <!-- Auth logic -->
  <script type="module">
    import {
      auth, onAuthStateChanged, signInWithPopup,
      signInWithEmailAndPassword, createUserWithEmailAndPassword,
      googleProvider, facebookProvider
    } from "./js/firebase.js";

    const statusEl = document.getElementById("status");
    const submitBtn = document.getElementById("submitBtn");
    const modeBtn = document.getElementById("modeBtn");
    const googleBtn = document.getElementById("googleBtn");
    const facebookBtn = document.getElementById("facebookBtn");
    const emailEl = document.getElementById("email");
    const pwEl = document.getElementById("password");
    const togglePw = document.getElementById("togglePw");
    document.getElementById("year").textContent = new Date().getFullYear();

    let isSignup = false;
    function setLoading(v,msg=""){submitBtn.disabled=v;googleBtn.disabled=v;facebookBtn.disabled=v;statusEl.textContent=msg;}
    function setMode(v){isSignup=v;submitBtn.textContent=v?"Create Account":"Sign In";modeBtn.textContent=v?"Have an account? Sign in":"Create account";statusEl.textContent="";}
    modeBtn.addEventListener("click",()=>setMode(!isSignup));
    togglePw.addEventListener("click",()=>{pwEl.type=pwEl.type==="password"?"text":"password";togglePw.setAttribute("aria-label",pwEl.type==="password"?"Show password":"Hide password");});

    document.getElementById("authForm").addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = emailEl.value.trim(), password = pwEl.value;
      if(!email || !password){statusEl.textContent="Email and password required.";return;}
      try{
        setLoading(true, isSignup ? "Creating your account..." : "Signing you in...");
        if(isSignup){ await createUserWithEmailAndPassword(auth,email,password); }
        else{ await signInWithEmailAndPassword(auth,email,password); }
      }catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    googleBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Google..."); await signInWithPopup(auth, googleProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    facebookBtn.addEventListener("click", async ()=>{
      try{ setLoading(true,"Opening Facebook..."); await signInWithPopup(auth, facebookProvider); }
      catch(err){ statusEl.textContent = niceError(err); setLoading(false); }
    });

    onAuthStateChanged(auth, (user)=>{ if(user){ window.location.href="./dashboard.html"; } });

    function niceError(err){
      const m=String(err?.message||err).toLowerCase();
      if(m.includes("auth/invalid-credential")) return "Invalid email or password.";
      if(m.includes("auth/invalid-email")) return "Enter a valid email.";
      if(m.includes("auth/weak-password")) return "Password must be at least 6 characters.";
      if(m.includes("auth/email-already-in-use")) return "That email is already in use.";
      if(m.includes("popup-closed-by-user")) return "Popup closed ‚Äî try again.";
      if(m.includes("auth/account-exists-with-different-credential")) return "Account exists with a different sign-in method for this email.";
      return "Error: " + (err?.message || "Something went wrong.");
    }
    setMode(false);
  </script>

  <!-- Grayscale ‚Äúmushroom smoke‚Äù explosion engine -->
  <script>
    (function(){
      const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      const canvas = document.getElementById("bg");
      const ctx = canvas.getContext("2d");
      let w = canvas.width = window.innerWidth;
      let h = canvas.height = window.innerHeight;

      const rnd = (a,b)=>a + Math.random()*(b-a);
      const TAU = Math.PI*2;
      let puffs = [];
      let lastSpawn = 0;

      class Puff {
        constructor(x,y,baseR,spread,life,grey=200){
          this.x=x; this.y=y;
          this.baseR=baseR;
          this.r = rnd(baseR*0.3, baseR*0.6);
          this.maxR = baseR + rnd(0, spread);
          this.life = life; this.age = 0;
          this.grey = grey;
          this.vx = rnd(-0.2,0.2);
          this.vy = rnd(-0.6,-0.2);
          this.blur = rnd(2,10);
        }
        step(dt){
          this.age += dt;
          this.x += this.vx * dt * 60;
          this.y += this.vy * dt * 60;
          this.r += (this.maxR - this.r) * 0.03;
          return this.age < this.life;
        }
        draw(){
          const t = this.age/this.life; // 0..1
          const alpha = (1 - t) * 0.18;
          ctx.globalAlpha = alpha;
          ctx.filter = `blur(${this.blur}px)`;
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.r, 0, TAU);
          const g = Math.max(80, Math.min(235, this.grey + (1-t)*20));
          ctx.fillStyle = `rgb(${g},${g},${g})`;
          ctx.fill();
          ctx.filter = "none";
          ctx.globalAlpha = 1;
        }
      }

      function spawnMushroom(){
        const cx = rnd(w*0.2, w*0.8);
        const cy = rnd(h*0.55, h*0.85);
        const baseR = rnd(40, 90);
        const life = rnd(2.5, 4.2);

        // cap cluster
        for(let i=0;i<18;i++){
          const angle = rnd(-Math.PI, 0);
          const dist = rnd(0, baseR*0.8);
          const x = cx + Math.cos(angle)*dist;
          const y = cy + Math.sin(angle)*dist - rnd(10, 28);
          puffs.push(new Puff(x,y, baseR, rnd(10,40), life, rnd(160,230)));
        }
        // stalk plume
        for(let i=0;i<10;i++){
          const x = cx + rnd(-10,10);
          const y = cy + rnd(0,40) + i*2;
          puffs.push(new Puff(x,y, baseR*0.35, rnd(6,18), life*0.8, rnd(120,180)));
        }
      }

      function spawnAmbient(){
        // small ambient wisps
        const count = 4;
        for(let i=0;i<count;i++){
          puffs.push(new Puff(rnd(0,w), rnd(h*0.6,h), rnd(12,28), rnd(6,20), rnd(2,3.5), rnd(140,210)));
        }
      }

      let prev = performance.now();
      function tick(now){
        if(prefersReduced){ return; }
        const dt = Math.min(0.05, (now - prev)/1000);
        prev = now;

        // gentle dark clear with slight trail
        ctx.globalCompositeOperation = "source-over";
        ctx.fillStyle = "rgba(0,0,0,0.20)";
        ctx.fillRect(0,0,w,h);

        // spawn logic
        if(now - lastSpawn > 1100){ // every ~1.1s
          if(Math.random() < 0.55) spawnMushroom(); else spawnAmbient();
          lastSpawn = now;
        }

        // draw/update
        ctx.globalCompositeOperation = "lighter";
        puffs = puffs.filter(p => { const keep = p.step(dt); p.draw(); return keep; });

        requestAnimationFrame(tick);
      }

      function resize(){
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
      }
      window.addEventListener("resize", resize, {passive:true});
      resize();
      // initialize base
      for(let i=0;i<18;i++) spawnAmbient();
      requestAnimationFrame(tick);
    })();
  </script>

  <noscript>Enable JavaScript to use BattleBillions.</noscript>
</body>
  </html>
