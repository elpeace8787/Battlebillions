<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ad Arena — Clean Side-by-Side Vertical</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#0b0c10; --ink:#f5f7fb; --muted:#a6abb6; --glass:rgba(255,255,255,.06); --bd:#ffffff24;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* Header/Footer (sticky so page can scroll normally) */
  header.topbar{
    position:sticky;top:0;z-index:10;display:flex;align-items:center;gap:.6rem;flex-wrap:wrap;
    padding:.7rem .9rem;background:rgba(16,16,18,.94);backdrop-filter:blur(10px);border-bottom:1px solid var(--bd)
  }
  .logo{font-family:Orbitron,Inter,sans-serif;letter-spacing:.4px;font-weight:700}
  .spacer{flex:1}
  .btn{border:1px solid var(--bd);background:#ffffff14;color:var(--ink);border-radius:12px;padding:.56rem .9rem;font-weight:800}
  .btn.gold{background:linear-gradient(180deg,#ffe88a,#ffc400);border:none;color:#121212}

  footer.bottomnav{
    position:sticky;bottom:0;z-index:10;display:flex;justify-content:space-around;align-items:center;
    height:calc(58px + env(safe-area-inset-bottom));padding:.3rem .6rem calc(.3rem + env(safe-area-inset-bottom));
    background:rgba(16,16,18,.94);border-top:1px solid var(--bd);backdrop-filter:blur(10px)
  }
  .navbtn{display:flex;flex-direction:column;align-items:center;gap:.2rem;text-decoration:none;color:var(--ink);opacity:.95}
  .navbtn svg{width:22px;height:22px}.navlbl{font-size:.72rem}

  /* ===== Arena (NO overlays on top of panels) ===== */
  .wrap{padding:.9rem}
  .panes{
    display:grid;grid-template-columns:1fr 1fr;gap:0; /* touching */
    align-items:start;justify-items:center;
  }
  /* Each frame is exactly 9:16 and takes 50vw width. Height is automatic = 50vw*(16/9).
     If it's taller than the viewport, the PAGE scrolls (not the frame). */
  .frame{
    width:50vw;aspect-ratio:9/16;background:#000;overflow:hidden; /* true vertical screen */
  }
  .frame video{width:100%;height:100%;object-fit:cover;display:block}
  /* remove any visual gap between the two frames */
  .frame.left{border-right:1px solid #000}
  .frame.right{border-left:1px solid #000}

  /* Dock: all controls live BELOW the panels */
  .dock{
    margin-top:.8rem;display:flex;flex-wrap:wrap;gap:.6rem;align-items:center;justify-content:center;
    border:1px solid var(--bd);background:var(--glass);border-radius:14px;padding:.6rem
  }
  .chip{display:inline-flex;align-items:center;gap:.45rem;background:#ffffff12;border:1px solid var(--bd);border-radius:999px;padding:.42rem .6rem;font-weight:800}
  .chip select{appearance:none;background:transparent;border:none;color:var(--ink);font-weight:800;outline:none}
  .count{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .5rem;border-radius:10px;background:#ffffff12;border:1px solid var(--bd)}
  .cta{display:flex;gap:.5rem}

  /* Category chips (after confirm) */
  .chips{display:none;gap:.5rem;margin-left:.6rem}
  .chips .chip{background:#ffffff10}

  /* Full-screen chooser */
  .chooser{
    position:fixed;inset:0;z-index:20;display:none;flex-direction:column;background:rgba(10,10,12,.98);backdrop-filter:blur(8px)
  }
  .chooser.open{display:flex}
  .chooser header{display:flex;align-items:center;gap:.6rem;padding:.8rem .9rem;border-bottom:1px solid var(--bd)}
  .chooser .body{flex:1;overflow:auto;padding:1rem;display:grid;gap:1rem}
  .grid{display:grid;gap:.6rem}
  .grid.cols2{grid-template-columns:1fr 1fr}
  .tile{display:flex;align-items:center;gap:.6rem;border:1px solid var(--bd);background:#ffffff10;border-radius:14px;padding:.7rem .8rem}
  .tile input{margin:0}
  .pillOpt{display:inline-flex;align-items:center;gap:.45rem;border:1px solid var(--bd);background:#ffffff12;border-radius:999px;padding:.42rem .6rem;cursor:pointer}
  .pillOpt.selected{outline:2px solid #ffffff3a}
  .chooser footer{display:flex;gap:.6rem;justify-content:flex-end;padding:.8rem .9rem;border-top:1px solid var(--bd);background:rgba(16,16,18,.9)}

  /* Edit Ad modal (simple & scrollable, no overlays on video) */
  .modal{position:fixed;inset:0;z-index:20;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.55)}
  .modal.open{display:flex}
  .sheet{width:100%;max-width:900px;max-height:90svh;overflow:auto;background:rgba(20,20,22,.98);border:1px solid var(--bd);border-radius:16px 16px 0 0;padding:1rem}
  .sheet header{position:sticky;top:0;background:inherit;padding-bottom:.5rem;margin-bottom:.6rem;display:flex;gap:.6rem;align-items:center}
  .field{display:flex;align-items:center;gap:.44rem;border:1px solid var(--bd);background:#ffffff12;border-radius:12px;padding:.5rem .6rem}
  .field input,.field select{background:transparent;border:none;color:var(--ink);font-weight:700;outline:none}
  .form{display:grid;gap:.6rem;grid-template-columns:1fr 1fr}
  @media (max-width: 840px){ .form{grid-template-columns:1fr} }
</style>
</head>
<body>

<header class="topbar">
  <div class="logo">AD ARENA</div>
  <div class="chips" id="chips">
    <div class="chip" id="chipCat"></div>
    <div class="chip" id="chipSub"></div>
  </div>
  <div class="spacer"></div>
  <button class="btn gold" id="openChooser">Choose Category</button>
  <button class="btn" id="openComposerA">Edit Ad A</button>
  <button class="btn" id="openComposerB">Edit Ad B</button>
</header>

<main class="wrap">
  <!-- PANELS: side-by-side, vertical, touching; nothing overlays them -->
  <section class="panes">
    <div class="frame left"><video id="vidA" playsinline muted></video></div>
    <div class="frame right"><video id="vidB" playsinline muted></video></div>
  </section>

  <!-- DOCK: all controls below (no overlay on videos) -->
  <section class="dock">
    <div class="chip">
      <span>Rounds</span>
      <select id="roundsSel"><option>1</option><option selected>3</option><option>5</option></select>
    </div>
    <div class="chip">
      <span>Turn</span>
      <select id="turnSel"><option>15</option><option selected>30</option><option>45</option><option>60</option></select>
    </div>
    <button class="btn gold" id="start">Start</button>
    <div class="count"><strong id="timer">00:30</strong></div>
    <div class="count">A <span id="scoreA">0</span></div>
    <div class="count">B <span id="scoreB">0</span></div>
    <div class="cta">
      <a class="btn" id="ctaA" href="#" target="_blank" rel="noopener">CTA A</a>
      <a class="btn" id="ctaB" href="#" target="_blank" rel="noopener">CTA B</a>
    </div>
  </section>
</main>

<footer class="bottomnav">
  <a class="navbtn" href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M3 11l9-8 9 8v9"/></svg><span class="navlbl">Home</span></a>
  <a class="navbtn" href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="7" stroke-width="2"/><path d="M21 21l-4.3-4.3" stroke-width="2"/></svg><span class="navlbl">Discover</span></a>
  <a class="navbtn" href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="5" y="4" width="14" height="7" rx="1.5" stroke-width="2"/><rect x="5" y="13" width="14" height="7" rx="1.5" stroke-width="2"/></svg><span class="navlbl">Ad Arena</span></a>
  <a class="navbtn" href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path stroke-width="2" d="M7 10l5 5 5-5"/></svg><span class="navlbl">Inbox</span></a>
  <a class="navbtn" href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="7" r="4" stroke-width="2"/><path stroke-width="2" d="M5.5 21a6.5 6.5 0 0 1 13 0"/></svg><span class="navlbl">Profile</span></a>
</footer>

<!-- CATEGORY → SUBCATEGORY CHOOSER -->
<div class="chooser" id="chooser">
  <header>
    <div class="logo">Choose Category</div>
    <div class="spacer"></div>
    <button class="btn" id="closeChooser">Close</button>
  </header>
  <div class="body">
    <div>
      <div style="font-weight:800;opacity:.9;margin-bottom:.4rem">1) Category</div>
      <div class="grid cols2" id="catGrid"></div>
    </div>
    <div>
      <div style="font-weight:800;opacity:.9;margin-bottom:.4rem">2) Subcategory</div>
      <div id="subGrid" class="grid"></div>
    </div>
  </div>
  <footer>
    <button class="btn" id="clearSel">Clear</button>
    <button class="btn gold" id="confirmSel" disabled>Confirm</button>
  </footer>
</div>

<!-- EDIT AD (minimal & clean) -->
<div class="modal" id="composer">
  <div class="sheet">
    <header>
      <button class="btn" id="closeComposer">Close</button>
      <div style="font-weight:800;margin-left:.5rem">Edit Ad</div>
      <div class="spacer"></div>
      <button class="btn gold" id="applyAd">Apply</button>
    </header>
    <div class="form">
      <div class="field"><label>Video</label><input id="videoFile" type="file" accept="video/*" capture="user"></div>
      <div class="field"><label>Music</label><input id="audioFile" type="file" accept="audio/*"></div>
      <div class="field"><label>Trim Start</label><input id="trimStart" type="number" min="0" value="0"></div>
      <div class="field"><label>Trim End</label><input id="trimEnd" type="number" min="1" value="30"></div>
      <div class="field"><label>Speed</label>
        <select id="speedSel"><option>0.5x</option><option selected>1x</option><option>1.5x</option><option>2x</option></select>
      </div>
      <div class="field"><label>Music Offset</label><input id="musicOffset" type="number" min="0" value="0"></div>
      <div class="field"><label>Video Vol</label><input id="volVideo" type="range" min="0" max="1" step="0.05" value="1"></div>
      <div class="field"><label>Music Vol</label><input id="volMusic" type="range" min="0" max="1" step="0.05" value="0.9"></div>
      <div class="field"><label>CTA</label><input id="ctaLink" placeholder="https://your-landingpage.com"></div>
    </div>
  </div>
</div>

<script>
  const $ = s => document.querySelector(s);

  /* ===== Category -> Subcategory (appears -> confirm -> disappears) ===== */
  const CATEGORY_MAP = {
    "Fashion":["Sneakers","Apparel","Accessories","Luxury","Streetwear"],
    "Food & Beverage":["Energy Drinks","Snacks","Quick Service","Coffee"],
    "Tech":["Smartphones","Laptops","Audio","Smart Home","Apps"],
    "Gaming":["Consoles","PC Gaming","Esports","Mobile Games"],
    "Beauty":["Skincare","Makeup","Hair","Fragrance"],
    "Auto":["EV","SUV","Sedan","Charging"],
    "Finance":["Banking","Investing","Insurance","Fintech"],
    "Fitness":["Wearables","Gym","Nutrition"],
    "Music":["Streaming","Artists"],
    "Travel":["Airlines","Hotels","Experiences"],
    "Education":["Online Courses","EdTech"],
    "Entertainment":["Streaming","Movies","Events"]
  };

  const chooser = $('#chooser');
  const openChooser = $('#openChooser');
  const closeChooser = $('#closeChooser');
  const catGrid = $('#catGrid');
  const subGrid = $('#subGrid');
  const clearSel = $('#clearSel');
  const confirmSel = $('#confirmSel');
  const chips = $('#chips'), chipCat = $('#chipCat'), chipSub = $('#chipSub');

  let chosenCat=null, chosenSub=null, activePane='A';

  function renderCats(){
    catGrid.innerHTML='';
    Object.keys(CATEGORY_MAP).forEach(cat=>{
      const el=document.createElement('label');
      el.className='tile';
      el.innerHTML=`<input type="radio" name="cat" value="${cat}"><strong>${cat}</strong>`;
      el.querySelector('input').addEventListener('change', ()=>{ chosenCat=cat; chosenSub=null; renderSubs(cat); updateConfirm(); });
      catGrid.appendChild(el);
    });
  }
  function renderSubs(cat){
    subGrid.innerHTML='';
    if(!cat){ confirmSel.disabled=true; return; }
    const row=document.createElement('div'); row.style.display='flex'; row.style.flexWrap='wrap'; row.style.gap='.5rem';
    CATEGORY_MAP[cat].forEach(s=>{
      const b=document.createElement('button'); b.type='button'; b.className='pillOpt'; b.textContent=s;
      b.addEventListener('click',()=>{
        chosenSub=s; [...row.children].forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); updateConfirm();
      });
      row.appendChild(b);
    });
    subGrid.appendChild(row);
  }
  function updateConfirm(){ confirmSel.disabled = !(chosenCat && chosenSub); }

  openChooser.addEventListener('click',()=>{ chooser.classList.add('open'); renderCats(); renderSubs(null); updateConfirm(); });
  closeChooser.addEventListener('click',()=> chooser.classList.remove('open'));
  clearSel.addEventListener('click',()=>{ chosenCat=null; chosenSub=null; renderCats(); renderSubs(null); updateConfirm(); });
  confirmSel.addEventListener('click',()=>{
    chips.style.display='flex';
    chipCat.textContent = chosenCat;
    chipSub.textContent = chosenSub;
    chooser.classList.remove('open');
  });

  /* ===== Edit Ad (no overlay UI; loads into the chosen pane) ===== */
  const composer = $('#composer');
  const closeComposer = $('#closeComposer');
  const applyAd = $('#applyAd');
  const videoFile = $('#videoFile');
  const audioFile = $('#audioFile');
  const trimStart = $('#trimStart');
  const trimEnd = $('#trimEnd');
  const speedSel = $('#speedSel');
  const musicOffset = $('#musicOffset');
  const volVideo = $('#volVideo');
  const volMusic = $('#volMusic');
  const ctaLink = $('#ctaLink');

  const vidA = $('#vidA'), vidB=$('#vidB');
  const audA = new Audio(), audB = new Audio();
  const scoreA=$('#scoreA'), scoreB=$('#scoreB');
  const timer=$('#timer');

  const state={A:{},B:{}};

  $('#openComposerA').addEventListener('click',()=>openComposer('A'));
  $('#openComposerB').addEventListener('click',()=>openComposer('B'));
  function openComposer(p){
    activePane=p; composer.classList.add('open');
    const s=state[p]||{};
    speedSel.value=(s.speed||1)+'x';
    trimStart.value=s.trimStart||0; trimEnd.value=s.trimEnd||30;
    musicOffset.value=s.musicOffset||0;
    volVideo.value=s.volVideo ?? 1; volMusic.value=s.volMusic ?? 0.9;
    ctaLink.value=s.cta||'';
  }
  closeComposer.addEventListener('click',()=>composer.classList.remove('open'));

  applyAd.addEventListener('click',()=>{
    const s = state[activePane] = state[activePane] || {};
    const v = activePane==='A'?vidA:vidB; const a = activePane==='A'?audA:audB;

    if(videoFile.files?.[0]){ s.videoURL = URL.createObjectURL(videoFile.files[0]); v.src = s.videoURL; }
    if(audioFile.files?.[0]){ s.audioURL = URL.createObjectURL(audioFile.files[0]); a.src = s.audioURL; }

    s.trimStart = +trimStart.value||0; s.trimEnd = +trimEnd.value||30;
    s.speed = parseFloat(speedSel.value)||1;
    s.musicOffset = +musicOffset.value||0;
    s.volVideo = +volVideo.value; s.volMusic = +volMusic.value;
    s.cta = ctaLink.value||'#';
    (activePane==='A'?$('#ctaA'):$('#ctaB')).href = s.cta;

    v.muted = (s.volVideo===0);
    v.loop = true;
    v.playbackRate = s.speed;
    v.play().catch(()=>{});
    composer.classList.remove('open');
    // reset file inputs so applying to other pane doesn't reuse same files unintentionally
    videoFile.value=''; audioFile.value='';
  });

  /* ===== Battle (controls in the dock; tap the video to vote) ===== */
  const roundsSel=$('#roundsSel'), turnSel=$('#turnSel'), start=$('#start');
  let ticker=null, tLeft=30, roundNow=1, roundsTotal=3, current='A', aVotes=0, bVotes=0;

  function mmss(s){ const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${ss}`; }
  function startBattle(){
    roundsTotal=+roundsSel.value||3; tLeft=+turnSel.value||30; roundNow=1; current='A'; timer.textContent=mmss(tLeft);
    aVotes=0; bVotes=0; scoreA.textContent=aVotes; scoreB.textContent=bVotes;
    clearInterval(ticker); ticker=setInterval(tick,1000);
    playPane('A'); pausePane('B');
  }
  function tick(){ tLeft--; timer.textContent=mmss(tLeft); if(tLeft<=0) swapTurn(); }
  function swapTurn(){
    if(current==='A'){ current='B'; tLeft=+turnSel.value||30; playPane('B'); pausePane('A'); }
    else{ if(roundNow<roundsTotal){ roundNow++; current='A'; tLeft=+turnSel.value||30; playPane('A'); pausePane('B'); } else { clearInterval(ticker); } }
  }
  function playPane(p){
    const s=state[p]; if(!s || !s.videoURL) return;
    const v=(p==='A'?vidA:vidB), a=(p==='A'?audA:audB);
    v.currentTime = s.trimStart||0; v.playbackRate = s.speed||1; v.loop=true; v.play().catch(()=>{});
    if(s.audioURL){ a.currentTime = s.musicOffset||0; a.volume = s.volMusic ?? 0.9; a.loop=true; a.play().catch(()=>{}); }
  }
  function pausePane(p){
    const v=(p==='A'?vidA:vidB), a=(p==='A'?audA:audB);
    try{ v.pause(); }catch{} try{ a.pause(); }catch{}
  }

  start.addEventListener('click', startBattle);
  vidA.addEventListener('click',()=>{ if(ticker && current==='A'){ aVotes++; scoreA.textContent=aVotes; }});
  vidB.addEventListener('click',()=>{ if(ticker && current==='B'){ bVotes++; scoreB.textContent=bVotes; }});
</script>
</body>
</html>
