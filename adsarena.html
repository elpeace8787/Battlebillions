<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ad Arena â€” Live Battle</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&family=Orbitron:wght@700;display=swap" rel="stylesheet" />
<style>
  :root{
    --bg:#0a0b0f; --ink:#f6f7fb; --muted:#a7adbb; --gold:#ffd54a;
    --glass:rgba(255,255,255,.06); --bd:#ffffff22; --vh:100svh;
    --accent:#75e0ff; --accent2:#a78bfa;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

  /* ===== Global chrome ===== */
  .topbar{
    position:sticky;top:0;z-index:30;display:flex;align-items:center;gap:.6rem;padding:.6rem .8rem;
    background:linear-gradient(180deg,rgba(10,10,14,.98),rgba(10,10,14,.9));backdrop-filter:blur(8px);border-bottom:1px solid var(--bd)
  }
  .logo{font-family:Orbitron,Inter,sans-serif;font-weight:700;letter-spacing:.4px}
  .spacer{flex:1}
  .btn{border:1px solid var(--bd);background:#12131a;color:var(--ink);border-radius:12px;padding:.5rem .8rem;font-weight:800}
  .btn.gold{background:linear-gradient(180deg,#ffe88a,#ffc400);border:none;color:#141414}
  .btn.ghost{background:var(--glass)}
  .chip{display:inline-flex;align-items:center;gap:.45rem;background:var(--glass);border:1px solid var(--bd);border-radius:999px;padding:.36rem .6rem;font-weight:800}

  /* ===== Live viewport ===== */
  .live{
    height:var(--vh); /* real mobile viewport */
    width:100%;
    position:relative;
    overflow:hidden;
  }

  /* Phone view (default mobile): full-bleed single panel with quick switcher */
  .stage{
    position:absolute;inset:0;display:grid;place-items:center;background:#000;
  }
  .frame{
    position:relative;inset:0;height:100%;width:100%;
    /* true live feel: fill screen, preserve subject, crop as needed */
    overflow:hidden;background:#000;border-radius:0;
  }
  .frame video{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

  /* Switcher bar (top) */
  .switcher{
    position:absolute;top:env(safe-area-inset-top);left:0;right:0;display:flex;justify-content:center;gap:.5rem;z-index:3;
    padding:.5rem .6rem
  }
  .seg{
    display:inline-flex;background:rgba(255,255,255,.08);border:1px solid var(--bd);border-radius:12px;overflow:hidden
  }
  .seg button{
    appearance:none;border:0;background:transparent;color:var(--ink);padding:.44rem .75rem;font-weight:800
  }
  .seg button.active{background:linear-gradient(180deg,#2a2f3a,#1a1d24)}

  /* HUD row (bottom) */
  .hud{
    position:absolute;left:0;right:0;bottom:calc(8px + env(safe-area-inset-bottom));z-index:3;
    display:flex;align-items:center;justify-content:space-between;padding:0 .6rem
  }
  .hud .stat{display:flex;align-items:center;gap:.4rem;background:rgba(255,255,255,.08);border:1px solid var(--bd);border-radius:10px;padding:.34rem .6rem;font-weight:800}
  .hud .stack{display:flex;gap:.5rem}
  .hud .fab{
    display:grid;place-items:center;width:44px;height:44px;border-radius:999px;background:linear-gradient(180deg,var(--accent),#2dd4bf);
    border:0;box-shadow:0 8px 30px rgba(45,212,191,.35)
  }
  .hud .fab svg{width:20px;height:20px;color:#0b0d12}

  /* Thumbnail rail (for quick swap) */
  .thumbs{
    position:absolute;right:.6rem;top:50%;transform:translateY(-50%);
    display:flex;flex-direction:column;gap:.4rem;z-index:3
  }
  .thumb{
    width:56px;height:100px;border-radius:10px;overflow:hidden;border:2px solid transparent;background:#0d0f15;cursor:pointer
  }
  .thumb.active{border-color:var(--accent2)}
  .thumb video{width:100%;height:100%;object-fit:cover;filter:brightness(.85)}

  /* Dock (slides up only when paused or editing) */
  .dock{
    position:absolute;left:0;right:0;bottom:0;z-index:4;
    transform:translateY(110%);transition:transform .25s ease;
    padding:.5rem .6rem .6rem calc(.6rem);padding-bottom:calc(.6rem + env(safe-area-inset-bottom));
    background:linear-gradient(180deg,transparent 0%, rgba(8,8,10,.7) 22%, rgba(8,8,10,.95) 60%);border-top:1px solid var(--bd)
  }
  .dock.open{transform:translateY(0)}
  .row{display:flex;flex-wrap:wrap;gap:.5rem;align-items:center}
  .dock .chip select{appearance:none;background:transparent;border:0;color:var(--ink);font-weight:800;outline:none}
  .dock .cta{margin-left:auto;display:flex;gap:.5rem}

  /* ===== Category chooser ===== */
  .chooser{position:fixed;inset:0;z-index:50;display:none;flex-direction:column;background:rgba(10,10,12,.98);backdrop-filter:blur(10px)}
  .chooser.open{display:flex}
  .chooser header{display:flex;align-items:center;gap:.6rem;padding:.8rem .9rem;border-bottom:1px solid var(--bd)}
  .chooser .body{flex:1;overflow:auto;padding:1rem;display:grid;gap:1rem}
  .grid{display:grid;gap:.6rem}
  .grid.cols2{grid-template-columns:1fr 1fr}
  .tile{display:flex;align-items:center;gap:.6rem;border:1px solid var(--bd);background:var(--glass);border-radius:14px;padding:.7rem .8rem}
  .tile input{margin:0}
  .pillOpt{display:inline-flex;align-items:center;gap:.45rem;border:1px solid var(--bd);background:#ffffff12;border-radius:999px;padding:.42rem .6rem;cursor:pointer}
  .pillOpt.selected{outline:2px solid #ffffff3a}
  .chooser footer{display:flex;gap:.6rem;justify-content:flex-end;padding:.8rem .9rem;border-top:1px solid var(--bd);background:rgba(16,16,18,.9)}

  /* ===== Composer (Edit Ad) ===== */
  .modal{position:fixed;inset:0;z-index:60;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.55)}
  .modal.open{display:flex}
  .sheet{width:100%;max-width:980px;max-height:90svh;overflow:auto;background:rgba(20,20,22,.98);border:1px solid var(--bd);border-radius:16px 16px 0 0;padding:1rem}
  .sheet header{position:sticky;top:0;background:inherit;padding-bottom:.5rem;margin-bottom:.6rem;display:flex;gap:.6rem;align-items:center}
  .field{display:flex;align-items:center;gap:.5rem;border:1px solid var(--bd);background:#ffffff12;border-radius:12px;padding:.55rem .65rem}
  .field input,.field select{border:0;background:transparent;color:var(--ink);font-weight:700;outline:none}
  .form{display:grid;gap:.6rem;grid-template-columns:1fr 1fr}
  @media(max-width:860px){ .form{grid-template-columns:1fr} }

  /* ===== Desktop: show both panels side-by-side ===== */
  @media(min-width: 1024px){
    .live{display:grid;grid-template-columns:1fr 1fr}
    .stage{position:relative}
    .thumbs{display:none}
    .switcher{top:.6rem;justify-content:flex-start;padding-left:.8rem}
  }
</style>
</head>
<body>
  <header class="topbar">
    <div class="logo">AD ARENA</div>
    <div id="chips" class="row" style="display:none;margin-left:.5rem">
      <div class="chip" id="chipCat"></div>
      <div class="chip" id="chipSub"></div>
    </div>
    <div class="spacer"></div>
    <button class="btn ghost" id="chooseCategory">
      <!-- grid icon -->
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="3" y="3" width="7" height="7" rx="1.5" stroke-width="2"/><rect x="14" y="3" width="7" height="7" rx="1.5" stroke-width="2"/><rect x="3" y="14" width="7" height="7" rx="1.5" stroke-width="2"/><rect x="14" y="14" width="7" height="7" rx="1.5" stroke-width="2"/></svg>
      Categories
    </button>
    <button class="btn gold" id="openComposerA">
      <!-- magic wand -->
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M15 4l-3 3m6 0l-3-3M5 19l5-5"/><rect x="2" y="17" width="7" height="5" rx="1.5" stroke-width="2"/></svg>
      Edit Ad
    </button>
  </header>

  <!-- ===== Live container ===== -->
  <section class="live" id="live">
    <!-- Switcher -->
    <div class="switcher">
      <div class="seg">
        <button id="segA" class="active">Panel A</button>
        <button id="segB">Panel B</button>
      </div>
    </div>

    <!-- Panel A (full-bleed by default) -->
    <div class="stage" id="stageA">
      <div class="frame"><video id="vidA" playsinline muted></video></div>
    </div>
    <!-- Panel B (hidden on mobile until toggled) -->
    <div class="stage" id="stageB" style="display:none">
      <div class="frame"><video id="vidB" playsinline muted></video></div>
    </div>

    <!-- Thumbs (tap to switch) -->
    <div class="thumbs">
      <div class="thumb active" id="thumbA"><video id="thA" muted playsinline loop></video></div>
      <div class="thumb" id="thumbB"><video id="thB" muted playsinline loop></video></div>
    </div>

    <!-- HUD bottom -->
    <div class="hud">
      <div class="stack">
        <div class="stat" id="roundStat">
          <!-- timer icon -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="13" r="7" stroke-width="2"/><path d="M12 13l3-2" stroke-width="2"/><path d="M9 3h6" stroke-width="2"/></svg>
          <span id="timer">00:30</span>
        </div>
        <div class="stat">
          <!-- trophy -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8 21h8" stroke-width="2"/><path d="M12 17v4" stroke-width="2"/><path d="M8 4h8v5a4 4 0 0 1-8 0V4z" stroke-width="2"/><path d="M4 6h4v2a4 4 0 0 1-4-4v2z" stroke-width="2"/><path d="M20 6h-4v2a4 4 0 0 0 4-4v2z" stroke-width="2"/></svg>
          <strong>A</strong>&nbsp;<span id="scoreA">0</span>&nbsp;|&nbsp;<strong>B</strong>&nbsp;<span id="scoreB">0</span>
        </div>
      </div>
      <div class="stack">
        <button class="fab" id="toggleDock" title="Show controls">
          <!-- sliders -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-width="2" d="M21 4H14M10 4H3M10 4v16M14 20V4M3 12h18"/></svg>
        </button>
      </div>
    </div>

    <!-- Dock controls (not overlaying center of video; slides up) -->
    <div class="dock" id="dock">
      <div class="row">
        <div class="chip">
          <!-- arrows -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M7 7h10M7 12h10M7 17h10" stroke-width="2"/></svg>
          Rounds
          <select id="roundsSel"><option>1</option><option selected>3</option><option>5</option></select>
        </div>
        <div class="chip">
          <!-- clock -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="9" stroke-width="2"/><path d="M12 7v5l3 2" stroke-width="2"/></svg>
          Turn
          <select id="turnSel"><option>15</option><option selected>30</option><option>45</option><option>60</option></select>
        </div>
        <button class="btn gold" id="startBattle">
          <!-- play -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M8 5v14l11-7z" stroke-width="2"/></svg>
          Start
        </button>
        <div class="spacer"></div>
        <div class="cta">
          <a class="btn ghost" id="ctaA" href="#" target="_blank" rel="noopener">CTA A</a>
          <a class="btn ghost" id="ctaB" href="#" target="_blank" rel="noopener">CTA B</a>
        </div>
      </div>
    </div>
  </section>

  <footer class="topbar" style="top:auto;bottom:0;border-top:1px solid var(--bd);border-bottom:none">
    <a class="btn ghost" href="#" title="Home">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 11l9-8 9 8v9H3z" stroke-width="2"/></svg> Home
    </a>
    <a class="btn ghost" href="#" title="Discover">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="11" cy="11" r="7" stroke-width="2"/><path d="M21 21l-4.3-4.3" stroke-width="2"/></svg> Discover
    </a>
    <a class="btn ghost" href="#" title="Inbox">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><path d="M7 10l5 5 5-5" stroke-width="2"/></svg> Inbox
    </a>
    <a class="btn ghost" href="#" title="Profile">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"><circle cx="12" cy="7" r="4" stroke-width="2"/><path d="M5.5 21a6.5 6.5 0 0 1 13 0" stroke-width="2"/></svg> Profile
    </a>
  </footer>

  <!-- ===== Category â†’ Subcategory chooser ===== -->
  <div class="chooser" id="chooser">
    <header>
      <div class="logo">Choose Category</div>
      <div class="spacer"></div>
      <button class="btn" id="closeChooser">Close</button>
    </header>
    <div class="body">
      <div>
        <div style="font-weight:800;opacity:.9;margin-bottom:.4rem">1) Category</div>
        <div class="grid cols2" id="catGrid"></div>
      </div>
      <div>
        <div style="font-weight:800;opacity:.9;margin-bottom:.4rem">2) Subcategory</div>
        <div id="subGrid" class="grid"></div>
      </div>
    </div>
    <footer>
      <button class="btn" id="clearSel">Clear</button>
      <button class="btn gold" id="confirmSel" disabled>Confirm</button>
    </footer>
  </div>

  <!-- ===== Edit Ad composer ===== -->
  <div class="modal" id="composer">
    <div class="sheet">
      <header>
        <button class="btn" id="closeComposer">Close</button>
        <div style="font-weight:800;margin-left:.5rem">Edit Ad</div>
        <div class="spacer"></div>
        <button class="btn gold" id="applyAd">Apply</button>
      </header>

      <div class="form">
        <div class="field"><label>Video</label><input id="videoFile" type="file" accept="video/*" capture="user"></div>
        <div class="field"><label>Music</label><input id="audioFile" type="file" accept="audio/*"></div>
        <div class="field"><label>Trim Start</label><input id="trimStart" type="number" min="0" value="0"></div>
        <div class="field"><label>Trim End</label><input id="trimEnd" type="number" min="1" value="30"></div>
        <div class="field"><label>Speed</label>
          <select id="speedSel"><option>0.5x</option><option selected>1x</option><option>1.5x</option><option>2x</option></select>
        </div>
        <div class="field"><label>Music Offset</label><input id="musicOffset" type="number" min="0" value="0"></div>
        <div class="field"><label>Video Vol</label><input id="volVideo" type="range" min="0" max="1" step="0.05" value="1"></div>
        <div class="field"><label>Music Vol</label><input id="volMusic" type="range" min="0" max="1" step="0.05" value="0.9"></div>
        <div class="field"><label>CTA</label><input id="ctaLink" placeholder="https://your-landingpage.com"></div>
      </div>
    </div>
  </div>

<script>
  const $ = s => document.querySelector(s);

  /* ===== Real mobile viewport (handles iOS toolbars) ===== */
  function setVH(){
    const vv = window.visualViewport;
    document.documentElement.style.setProperty('--vh', Math.round(vv?.height || window.innerHeight) + 'px');
  }
  ['load','resize','orientationchange','scroll'].forEach(ev=>addEventListener(ev, setVH, {passive:true}));
  setVH();

  /* ===== Category chooser logic ===== */
  const CATEGORY_MAP = {
    "Fashion":["Sneakers","Apparel","Accessories","Luxury","Streetwear","Watches & Jewelry"],
    "Food & Beverage":["Energy Drinks","Snacks","Quick Service","Coffee","Groceries"],
    "Tech":["Smartphones","Laptops","Audio","Smart Home","Apps","AI Tools"],
    "Gaming":["Consoles","PC","Esports","Mobile Games","Peripherals"],
    "Beauty":["Skincare","Makeup","Hair","Fragrance"],
    "Auto":["EV","SUV","Sedan","Charging","Aftermarket"],
    "Finance":["Banking","Investing","Insurance","Fintech","Crypto"],
    "Fitness":["Wearables","Gym","Nutrition","Yoga"],
    "Music":["Streaming","Artists","Instruments"],
    "Travel":["Airlines","Hotels","Experiences","Luggage"],
    "Entertainment":["Streaming","Movies","Events","Tickets"]
  };
  const chooser = $('#chooser'), chooseCategory=$('#chooseCategory'), closeChooser=$('#closeChooser'),
        catGrid=$('#catGrid'), subGrid=$('#subGrid'), clearSel=$('#clearSel'), confirmSel=$('#confirmSel'),
        chips=$('#chips'), chipCat=$('#chipCat'), chipSub=$('#chipSub');
  let chosenCat=null, chosenSub=null;

  function renderCats(){
    catGrid.innerHTML=''; Object.keys(CATEGORY_MAP).forEach(cat=>{
      const el=document.createElement('label'); el.className='tile';
      el.innerHTML=`<input type="radio" name="cat" value="${cat}"><strong>${cat}</strong>`;
      el.querySelector('input').addEventListener('change',()=>{ chosenCat=cat; chosenSub=null; renderSubs(cat); updateConfirm(); });
      catGrid.appendChild(el);
    });
  }
  function renderSubs(cat){
    subGrid.innerHTML=''; if(!cat) return;
    const row=document.createElement('div'); row.style.display='flex'; row.style.flexWrap='wrap'; row.style.gap='.5rem';
    CATEGORY_MAP[cat].forEach(s=>{
      const b=document.createElement('button'); b.type='button'; b.className='pillOpt'; b.textContent=s;
      b.addEventListener('click',()=>{ chosenSub=s; [...row.children].forEach(x=>x.classList.remove('selected')); b.classList.add('selected'); updateConfirm(); });
      row.appendChild(b);
    });
    subGrid.appendChild(row);
  }
  function updateConfirm(){ confirmSel.disabled = !(chosenCat && chosenSub); }

  chooseCategory.addEventListener('click',()=>{ chooser.classList.add('open'); renderCats(); renderSubs(null); updateConfirm(); });
  closeChooser.addEventListener('click',()=> chooser.classList.remove('open'));
  clearSel.addEventListener('click',()=>{ chosenCat=null; chosenSub=null; renderCats(); renderSubs(null); updateConfirm(); });
  confirmSel.addEventListener('click',()=>{
    chips.style.display='flex'; chipCat.textContent=chosenCat; chipSub.textContent=chosenSub;
    chooser.classList.remove('open');
  });

  /* ===== Live panels & switching ===== */
  const stageA=$('#stageA'), stageB=$('#stageB'), segA=$('#segA'), segB=$('#segB');
  const thumbA=$('#thumbA'), thumbB=$('#thumbB'), thA=$('#thA'), thB=$('#thB');
  const vidA=$('#vidA'), vidB=$('#vidB');
  let active='A';

  function showPanel(which){
    active=which;
    if(which==='A'){ stageA.style.display='grid'; stageB.style.display='none'; segA.classList.add('active'); segB.classList.remove('active'); thumbA.classList.add('active'); thumbB.classList.remove('active'); }
    else { stageA.style.display='none'; stageB.style.display='grid'; segB.classList.add('active'); segA.classList.remove('active'); thumbB.classList.add('active'); thumbA.classList.remove('active'); }
  }
  segA.addEventListener('click',()=>showPanel('A'));
  segB.addEventListener('click',()=>showPanel('B'));
  thumbA.addEventListener('click',()=>showPanel('A'));
  thumbB.addEventListener('click',()=>showPanel('B'));

  /* ===== Dock controls ===== */
  const dock=$('#dock'), toggleDock=$('#toggleDock');
  toggleDock.addEventListener('click',()=> dock.classList.toggle('open'));

  /* ===== Edit Ad composer ===== */
  const composer=$('#composer'), openComposerA=$('#openComposerA'), closeComposer=$('#closeComposer'), applyAd=$('#applyAd');
  const videoFile=$('#videoFile'), audioFile=$('#audioFile'), trimStart=$('#trimStart'), trimEnd=$('#trimEnd'), speedSel=$('#speedSel'), musicOffset=$('#musicOffset'), volVideo=$('#volVideo'), volMusic=$('#volMusic'), ctaLink=$('#ctaLink');
  let activePane='A';
  openComposerA.addEventListener('click',()=>{ activePane=active; composer.classList.add('open'); loadComposer(activePane); });
  closeComposer.addEventListener('click',()=>composer.classList.remove('open'));

  const audA=new Audio(), audB=new Audio();
  const state={
    A:{loaded:false,videoURL:null,audioURL:null,trimStart:0,trimEnd:30,speed:1,musicOffset:0,volVideo:1,volMusic:0.9,cta:'#'},
    B:{loaded:false,videoURL:null,audioURL:null,trimStart:0,trimEnd:30,speed:1,musicOffset:0,volVideo:1,volMusic:0.9,cta:'#'}
  };

  function loadComposer(p){
    const s=state[p];
    speedSel.value=(s.speed||1)+'x'; trimStart.value=s.trimStart||0; trimEnd.value=s.trimEnd||30;
    musicOffset.value=s.musicOffset||0; volVideo.value=s.volVideo??1; volMusic.value=s.volMusic??0.9; ctaLink.value=s.cta||'';
  }

  applyAd.addEventListener('click',()=>{
    const p=activePane, s=state[p], v=(p==='A'?vidA:vidB), a=(p==='A'?audA:audB);
    if(videoFile.files?.[0]){ s.videoURL=URL.createObjectURL(videoFile.files[0]); v.src=s.videoURL; thA.src=state.A.videoURL||''; thB.src=state.B.videoURL||''; }
    if(audioFile.files?.[0]){ s.audioURL=URL.createObjectURL(audioFile.files[0]); a.src=s.audioURL; }
    s.trimStart=+trimStart.value||0; s.trimEnd=+trimEnd.value||30; s.speed=parseFloat(speedSel.value)||1;
    s.musicOffset=+musicOffset.value||0; s.volVideo=+volVideo.value; s.volMusic=+volMusic.value; s.cta=ctaLink.value||'#';
    (p==='A'?$('#ctaA'):$('#ctaB')).href=s.cta;

    v.muted=(s.volVideo===0); v.loop=true; v.playbackRate=s.speed;
    try{ v.play(); }catch{}
    s.loaded=true;
    // update thumbs
    if(state.A.videoURL){ thA.src=state.A.videoURL; thA.play().catch(()=>{}); }
    if(state.B.videoURL){ thB.src=state.B.videoURL; thB.play().catch(()=>{}); }
    composer.classList.remove('open');
    videoFile.value=''; audioFile.value='';
  });

  /* ===== Battle logic ===== */
  const roundsSel=$('#roundsSel'), turnSel=$('#turnSel'), startBattle=$('#startBattle');
  const timer=$('#timer'), scoreA=$('#scoreA'), scoreB=$('#scoreB');
  let ticker=null, tLeft=30, roundNow=1, roundsTotal=3, current='A', aVotes=0, bVotes=0;

  function mmss(s){const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${ss}`;}

  function playPane(p){
    const s=state[p]; if(!s.loaded) return; const v=(p==='A'?vidA:vidB), a=(p==='A'?audA:audB);
    v.currentTime=s.trimStart||0; v.playbackRate=s.speed||1; v.loop=true; v.play().catch(()=>{});
    if(s.audioURL){ a.currentTime=s.musicOffset||0; a.volume=s.volMusic??0.9; a.loop=true; a.play().catch(()=>{}); }
  }
  function pausePane(p){ const v=(p==='A'?vidA:vidB), a=(p==='A'?audA:audB); try{v.pause();}catch{} try{a.pause();}catch{} }

  function start(){
    roundsTotal=+roundsSel.value||3; tLeft=+turnSel.value||30; roundNow=1; current='A';
    aVotes=0; bVotes=0; scoreA.textContent=aVotes; scoreB.textContent=bVotes; timer.textContent=mmss(tLeft);
    clearInterval(ticker); ticker=setInterval(tick,1000);
    showPanel('A'); playPane('A'); pausePane('B');
  }
  function tick(){ tLeft--; timer.textContent=mmss(tLeft); if(tLeft<=0) swap(); }
  function swap(){
    if(current==='A'){ current='B'; tLeft=+turnSel.value||30; showPanel('B'); playPane('B'); pausePane('A'); }
    else { if(roundNow<roundsTotal){ roundNow++; current='A'; tLeft=+turnSel.value||30; showPanel('A'); playPane('A'); pausePane('B'); } else { clearInterval(ticker); } }
  }
  startBattle.addEventListener('click', start);

  // Tap to vote (live feel)
  vidA.addEventListener('click',()=>{ if(ticker && current==='A'){ aVotes++; scoreA.textContent=aVotes; pulse('#scoreA'); }});
  vidB.addEventListener('click',()=>{ if(ticker && current==='B'){ bVotes++; scoreB.textContent=bVotes; pulse('#scoreB'); }});
  function pulse(sel){ const el=$(sel); el.style.color=varAccent(); setTimeout(()=>el.style.color='',180); }
  function varAccent(){ return getComputedStyle(document.documentElement).getPropertyValue('--accent'); }
</script>
</body>
</html>
