<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home • 3ATTL33ILLIONS</title>

  <!-- Virgo font (local) -->
  <style>
    @font-face{
      font-family:'Virgo';
      src:
        url('assets/fonts/Virgo.woff2') format('woff2'),
        url('assets/fonts/Virgo.ttf') format('truetype');
      font-display:swap;
    }
  </style>

  <style>
    :root{
      --bg:#000;
      --panel:#0e0e0f;
      --ink:#e9edf1;
      --ink-2:#cfd6dd;
      --ink-3:#9aa3ad;
      --stroke:rgba(255,255,255,.08);
      --ring:0 0 0 3px rgba(255,255,255,.12);
      --gold-1:#F5D76E; --gold-2:#F0B90B; --gold-3:#FFD15C;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:'Virgo', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      letter-spacing:.2px;
    }

    /* Page layout */
    .home-shell{
      max-width:1200px; margin:0 auto; padding:16px 12px calc(28px + var(--safe-bottom));
      display:grid; grid-template-columns: 1fr 340px; gap:16px;
    }

    /* Left main area (fill with your feed/hero later) */
    .home-main{
      min-height:60vh; border:1px solid var(--stroke); border-radius:16px;
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding:18px;
    }
    .home-main h1{margin:0 0 8px 0; font-size:18px}
    .home-main p{color:var(--ink-3); margin:0}

    /* Right sidebar */
    .home-sidebar{position:sticky; top:16px; display:flex; flex-direction:column; gap:12px}

    .card{
      border:1px solid var(--stroke); border-radius:16px; background:rgba(255,255,255,.04);
      backdrop-filter:blur(6px); box-shadow:0 10px 30px rgba(0,0,0,.35);
      padding:14px;
    }

    /* Profile header (avatar + display name) */
    .profile-mini{display:flex; gap:12px; align-items:center}
    .avatar{width:64px;height:64px;border-radius:16px;overflow:hidden;box-shadow:0 0 0 2px rgba(255,255,255,.06)}
    .avatar img{width:100%;height:100%;object-fit:cover;display:block}
    .display-name{font-size:18px; font-weight:900}

    /* Actions (open overlays) */
    .actions{display:flex; flex-direction:column; gap:10px; margin-top:10px}
    .action-btn{
      display:flex; align-items:center; gap:12px; width:100%;
      border:1px solid var(--stroke); border-radius:12px;
      background:rgba(255,255,255,.06); color:#fff; font-weight:800; font-size:13px;
      padding:12px; cursor:pointer; text-align:left;
      transition:transform .2s, background .2s, box-shadow .2s;
    }
    .action-btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.1)}
    .action-btn svg{width:18px;height:18px;stroke:#fff}

    .action-btn.rank{
      background:linear-gradient(90deg,#3a3a3a,var(--gold-2),#3a3a3a);
      background-size:200% 100%;
      color:#101; border-color:rgba(240,185,11,.55);
      box-shadow:0 0 16px 2px rgba(240,185,11,.25);
      animation:shimmer 5s linear infinite;
    }
    @keyframes shimmer{0%{background-position:0% 50%}100%{background-position:200% 50%}}

    .badge{
      margin-left:auto;
      padding:2px 8px; border-radius:999px; border:1px solid rgba(240,185,11,.55);
      background:linear-gradient(90deg,var(--gold-1),var(--gold-2),var(--gold-3));
      color:#101; font-weight:900; font-size:11px;
    }

    .divider{height:1px; background:var(--stroke); margin:10px 0}

    /* Stats */
    .stats{display:grid; grid-template-columns:repeat(3, 1fr); gap:8px}
    .stat{border:1px solid var(--stroke); border-radius:12px; background:var(--panel); padding:10px; text-align:center}
    .stat .num{font-size:18px; font-weight:900}
    .stat .lbl{font-size:10px; color:var(--ink-2); letter-spacing:.3px}

    /* Overlays (sub-pages) */
    .modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(0,0,0,.55); backdrop-filter:blur(6px); z-index:2000;
    }
    .modal.show{display:flex}
    .sheet{
      width:min(92vw, 720px); border-radius:16px; background:#0e0e0f;
      border:1px solid var(--stroke); box-shadow:0 10px 30px rgba(0,0,0,.45);
      overflow:hidden;
    }
    .sheet-head{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:12px 14px; border-bottom:1px solid var(--stroke);
      background:rgba(255,255,255,.04);
    }
    .sheet-title{font-weight:900}
    .closebtn{
      border:1px solid var(--stroke); border-radius:10px; background:rgba(255,255,255,.06); color:#fff;
      padding:8px 10px; cursor:pointer; font-weight:800; transition:background .2s, transform .2s;
    }
    .closebtn:hover{background:rgba(255,255,255,.1); transform:translateY(-1px)}
    .sheet-body{padding:14px}
    .muted{color:var(--ink-3); font-size:12px}

    /* Responsive */
    @media (max-width: 980px){
      .home-shell{grid-template-columns: 1fr}
      .home-sidebar{position:static}
    }
  </style>
</head>
<body>
  <!-- Inline icons (white strokes) -->
  <svg width="0" height="0" style="position:absolute;opacity:0;">
    <defs>
      <symbol id="ic-trophy" viewBox="0 0 24 24">
        <path d="M8 21h8M12 17v4M7 4h10v3a4 4 0 0 1-4 4h-2a4 4 0 0 1-4-4V4z" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M17 7h2a2 2 0 0 0 2-2V4h-4M7 7H5a2 2 0 0 1-2-2V4h4" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="ic-wallet" viewBox="0 0 24 24">
        <path d="M4 7h14a3 3 0 0 1 3 3v4a3 3 0 0 1-3 3H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2z" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M16 11h4v2h-4z" stroke-width="1.8"/>
        <path d="M4 7V5a2 2 0 0 1 2-2h10" stroke-width="1.8" stroke-linecap="round"/>
      </symbol>
      <symbol id="ic-edit" viewBox="0 0 24 24">
        <path d="M12 20h9" stroke-width="1.8" stroke-linecap="round"/>
        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
      <symbol id="ic-cog" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="3" stroke-width="1.8"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06A2 2 0 1 1 3.21 19l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H2a2 2 0 1 1 0-4h.09c.36 0 .71-.08 1.02-.23.62-.27 1-.86 1-1.51V7a1.65 1.65 0 0 0-.33-1.82l-.06-.06A2 2 0 1 1 5.04 3.21l.06.06c.5.5 1.19.65 1.82.33H7a1.65 1.65 0 0 0 1-1.51V2a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51c.63.32 1.32.17 1.82-.33l.06-.06A2 2 0 1 1 20.79 5l-.06.06c-.5.5-.65 1.19-.33 1.82V7" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
      </symbol>
    </defs>
  </svg>

  <div class="home-shell" data-app-fragment>
    <!-- Left (your feed/hero) -->
    <section class="home-main">
      <h1>Welcome back</h1>
      <p>Jump into a 3ATTLE, browse 3ILLIONS, or check your rank.</p>
      <!-- Add your content/cards here -->
    </section>

    <!-- Right Sidebar -->
    <aside class="home-sidebar">
      <!-- Profile Mini -->
      <div class="card">
        <div class="profile-mini">
          <div class="avatar"><img id="avatar" src="assets/img/user_me.jpg" alt="Your avatar"></div>
          <div class="display-name" id="displayName">Commander Nova</div>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button class="action-btn rank" data-open="rankModal">
            <svg><use href="#ic-trophy"/></svg>
            <span>Rank</span>
            <span class="badge" id="rankBadge">#27</span>
          </button>
          <button class="action-btn" data-open="walletModal">
            <svg><use href="#ic-wallet"/></svg>
            <span>Wallet</span>
          </button>
          <button class="action-btn" data-open="editModal">
            <svg><use href="#ic-edit"/></svg>
            <span>Edit</span>
          </button>
          <button class="action-btn" data-open="settingsModal">
            <svg><use href="#ic-cog"/></svg>
            <span>Settings</span>
          </button>
        </div>

        <div class="divider"></div>

        <!-- Stats -->
        <div class="stats">
          <div class="stat">
            <div class="num" id="statBattles">27</div>
            <div class="lbl">3ATTLES</div>
          </div>
          <div class="stat">
            <div class="num" id="statFollowers">12.8k</div>
            <div class="lbl">Followers</div>
          </div>
          <div class="stat">
            <div class="num" id="statFollowing">341</div>
            <div class="lbl">Following</div>
          </div>
        </div>
      </div>

      <!-- Optional CTA -->
      <div class="card">
        <div class="sheet-body">
          <div class="muted">Ready to jump back in?</div>
          <div style="height:8px"></div>
          <button class="action-btn" onclick="go('#/battle')">
            <!-- play icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
              <path d="M8 5v14l11-7z"/>
            </svg>
            Enter 3ATTLES
          </button>
        </div>
      </div>
    </aside>
  </div>

  <!-- ===== Overlays (sub-pages) ===== -->
  <!-- Rank -->
  <div class="modal" id="rankModal" aria-modal="true" role="dialog">
    <div class="sheet" role="document">
      <div class="sheet-head">
        <div class="sheet-title">Rank</div>
        <button class="closebtn" data-close="rankModal">Close</button>
      </div>
      <div class="sheet-body">
        <p>Your current global rank:</p>
        <h2 style="margin:6px 0 0 0; font-size:28px; font-weight:900;"><span id="rankBig">#27</span></h2>
        <p class="muted">Climb by winning more 3ATTLES and earning 3ILLIONS.</p>
      </div>
    </div>
  </div>

  <!-- Wallet -->
  <div class="modal" id="walletModal" aria-modal="true" role="dialog">
    <div class="sheet" role="document">
      <div class="sheet-head">
        <div class="sheet-title">Wallet</div>
        <button class="closebtn" data-close="walletModal">Close</button>
      </div>
      <div class="sheet-body">
        <p>Balance</p>
        <h2 style="margin:6px 0; font-size:24px; font-weight:900;"><span id="walletBalance">8,504</span> coins</h2>
        <p class="muted">Withdrawals, deposits, and rewards history will appear here.</p>
        <div style="height:10px"></div>
        <button class="action-btn" onclick="alert('Add funds flow coming soon')">
          <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M5 12h14"/></svg>
          Add Funds
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Profile -->
  <div class="modal" id="editModal" aria-modal="true" role="dialog">
    <div class="sheet" role="document">
      <div class="sheet-head">
        <div class="sheet-title">Edit Profile</div>
        <button class="closebtn" data-close="editModal">Close</button>
      </div>
      <div class="sheet-body">
        <div class="muted">Quick edit (demo). Wire to your backend later.</div>
        <div style="height:10px"></div>
        <label style="font-size:12px;color:var(--ink-2)">Display Name</label>
        <input id="nameInput" type="text" value="Commander Nova" style="width:100%;margin-top:6px;margin-bottom:10px;padding:10px;border-radius:10px;border:1px solid var(--stroke);background:#0b0b0c;color:#fff;font-family:inherit">
        <label style="font-size:12px;color:var(--ink-2)">Avatar URL</label>
        <input id="avatarInput" type="text" value="assets/img/user_me.jpg" style="width:100%;margin-top:6px;margin-bottom:14px;padding:10px;border-radius:10px;border:1px solid var(--stroke);background:#0b0b0c;color:#fff;font-family:inherit">
        <button class="action-btn" onclick="saveProfile()">
          <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6L9 17l-5-5"/></svg>
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- Settings -->
  <div class="modal" id="settingsModal" aria-modal="true" role="dialog">
    <div class="sheet" role="document">
      <div class="sheet-head">
        <div class="sheet-title">Settings</div>
        <button class="closebtn" data-close="settingsModal">Close</button>
      </div>
      <div class="sheet-body">
        <p class="muted">Fast toggles (demo).</p>
        <div style="height:8px"></div>
        <label style="display:flex;align-items:center;gap:8px;margin:8px 0;cursor:pointer">
          <input id="darkMode" type="checkbox" checked style="accent-color:#fff">
          <span>Dark mode</span>
        </label>
        <label style="display:flex;align-items:center;gap:8px;margin:8px 0;cursor:pointer">
          <input id="notifs" type="checkbox" checked style="accent-color:#fff">
          <span>Battle notifications</span>
        </label>
        <div style="height:10px"></div>
        <button class="action-btn" onclick="alert('More settings soon')">
          <svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2l4 4-4 4-4-4 4-4zM2 12l4 4-4 4-4-4 4-4zM22 12l-4 4 4 4 4-4-4-4zM12 22l-4-4 4-4 4 4-4 4z"/>
          </svg>
          Advanced
        </button>
      </div>
    </div>
  </div>

  <script>
    // SPA helper: open route in parent shell if embedded
    function go(hash){
      try{
        if (window.parent && window.parent !== window){ window.parent.location.hash = hash; }
        else { location.hash = hash; }
      }catch(e){ location.hash = hash; }
    }

    // Demo data (replace later)
    const user = {
      name: 'Commander Nova',
      avatar: 'assets/img/user_me.jpg',
      rank: 27,
      coins: 8504,
      battles: 27,
      followers: 12840,
      following: 341,
    };

    function fmt(n){ return n.toLocaleString(); }
    function kfmt(n){ return n>=1000 ? (Math.round(n/100)/10)+'k' : n.toString(); }

    // Hydration
    (function hydrate(){
      document.getElementById('displayName').textContent = user.name;
      document.getElementById('avatar').src = user.avatar;
      document.getElementById('rankBadge').textContent = '#'+user.rank;
      document.getElementById('rankBig').textContent = '#'+user.rank;
      document.getElementById('walletBalance').textContent = fmt(user.coins);
      document.getElementById('statBattles').textContent = fmt(user.battles);
      document.getElementById('statFollowers').textContent = kfmt(user.followers);
      document.getElementById('statFollowing').textContent = fmt(user.following);
    })();

    // Open/close overlay helpers
    function openModal(id){ document.getElementById(id).classList.add('show'); }
    function closeModal(id){ document.getElementById(id).classList.remove('show'); }

    // Wire buttons (data-open / data-close)
    document.addEventListener('click',(e)=>{
      const openBtn = e.target.closest('[data-open]');
      if(openBtn){
        const id = openBtn.getAttribute('data-open');
        openModal(id);
      }
      const closeBtn = e.target.closest('[data-close]');
      if(closeBtn){
        const id = closeBtn.getAttribute('data-close');
        closeModal(id);
        // clear hash if we used routes
        if (location.hash === '#/rank' || location.hash === '#/wallet' || location.hash === '#/edit-profile' || location.hash === '#/settings'){
          history.replaceState({}, '', '#/home');
        }
      }
      const modal = e.target.classList.contains('modal') ? e.target : null;
      if(modal){ modal.classList.remove('show'); history.replaceState({}, '', '#/home'); }
    });

    // Keyboard ESC closes any open sheet
    document.addEventListener('keydown',(e)=>{
      if(e.key==='Escape'){
        document.querySelectorAll('.modal.show').forEach(m=>m.classList.remove('show'));
        history.replaceState({}, '', '#/home');
      }
    });

    // Route → open overlay (works inside shell)
    function routeFromHash(){
      const h = (window.parent && window.parent !== window) ? window.parent.location.hash : location.hash;
      if(h==='#/rank') openModal('rankModal');
      if(h==='#/wallet') openModal('walletModal');
      if(h==='#/edit-profile') openModal('editModal');
      if(h==='#/settings') openModal('settingsModal');
    }
    window.addEventListener('hashchange', routeFromHash);
    // If loaded directly with a modal route
    routeFromHash();

    // Save (demo)
    function saveProfile(){
      const name = document.getElementById('nameInput').value.trim() || user.name;
      const avatar = document.getElementById('avatarInput').value.trim() || user.avatar;
      user.name = name; user.avatar = avatar;
      document.getElementById('displayName').textContent = user.name;
      document.getElementById('avatar').src = user.avatar;
      alert('Saved!');
      closeModal('editModal');
      history.replaceState({}, '', '#/home');
    }
  </script>
</body>
  </html>
